"use strict";(self.webpackChunkbqplot=self.webpackChunkbqplot||[]).push([[830],{830:(t,e,r)=>{function i(){return new n}r.r(e),r.d(e,{Constraint:()=>l,Expression:()=>c,Operator:()=>p,Solver:()=>v,Strength:()=>f,Variable:()=>s});var n=function(){function t(){this.index={},this.array=[]}return t.prototype.size=function(){return this.array.length},t.prototype.empty=function(){return 0===this.array.length},t.prototype.itemAt=function(t){return this.array[t]},t.prototype.contains=function(t){return void 0!==this.index[t.id()]},t.prototype.find=function(t){var e=this.index[t.id()];return void 0===e?void 0:this.array[e]},t.prototype.setDefault=function(t,e){var r=this.index[t.id()];if(void 0===r){var i=new o(t,e());return this.index[t.id()]=this.array.length,this.array.push(i),i}return this.array[r]},t.prototype.insert=function(t,e){var r=new o(t,e),i=this.index[t.id()];return void 0===i?(this.index[t.id()]=this.array.length,this.array.push(r)):this.array[i]=r,r},t.prototype.erase=function(t){var e=this.index[t.id()];if(void 0!==e){this.index[t.id()]=void 0;var r=this.array[e],i=this.array.pop();return r!==i&&(this.array[e]=i,this.index[i.first.id()]=e),r}},t.prototype.copy=function(){for(var e=new t,r=0;r<this.array.length;r++){var i=this.array[r].copy();e.array[r]=i,e.index[i.first.id()]=r}return e},t}(),o=function(){function t(t,e){this.first=t,this.second=e}return t.prototype.copy=function(){return new t(this.first,this.second)},t}(),s=function(){function t(t){void 0===t&&(t=""),this._value=0,this._context=null,this._id=a++,this._name=t}return t.prototype.id=function(){return this._id},t.prototype.name=function(){return this._name},t.prototype.setName=function(t){this._name=t},t.prototype.context=function(){return this._context},t.prototype.setContext=function(t){this._context=t},t.prototype.value=function(){return this._value},t.prototype.setValue=function(t){this._value=t},t.prototype.plus=function(t){return new c(this,t)},t.prototype.minus=function(t){return new c(this,"number"==typeof t?-t:[-1,t])},t.prototype.multiply=function(t){return new c([t,this])},t.prototype.divide=function(t){return new c([1/t,this])},t.prototype.toJSON=function(){return{name:this._name,value:this._value}},t.prototype.toString=function(){return this._context+"["+this._name+":"+this._value+"]"},t}(),a=0,c=function(){function t(){var t=u(arguments);this._terms=t.terms,this._constant=t.constant}return t.prototype.terms=function(){return this._terms},t.prototype.constant=function(){return this._constant},t.prototype.value=function(){for(var t=this._constant,e=0,r=this._terms.size();e<r;e++){var i=this._terms.itemAt(e);t+=i.first.value()*i.second}return t},t.prototype.plus=function(e){return new t(this,e)},t.prototype.minus=function(e){return new t(this,"number"==typeof e?-e:[-1,e])},t.prototype.multiply=function(e){return new t([e,this])},t.prototype.divide=function(e){return new t([1/e,this])},t.prototype.isConstant=function(){return 0==this._terms.size()},t.prototype.toString=function(){var t=this._terms.array.map((function(t){return t.second+"*"+t.first.toString()})).join(" + ");return this.isConstant()||0===this._constant||(t+=" + "),t+this._constant},t}();function u(t){for(var e=0,r=function(){return 0},n=i(),o=0,a=t.length;o<a;++o){var u=t[o];if("number"==typeof u)e+=u;else if(u instanceof s)n.setDefault(u,r).second+=1;else if(u instanceof c){e+=u.constant();for(var p=0,f=(v=u.terms()).size();p<f;p++){var h=v.itemAt(p);n.setDefault(h.first,r).second+=h.second}}else{if(!(u instanceof Array))throw new Error("invalid Expression argument: "+u);if(2!==u.length)throw new Error("array must have length 2");var l=u[0],d=u[1];if("number"!=typeof l)throw new Error("array item 0 must be a number");if(d instanceof s)n.setDefault(d,r).second+=l;else{if(!(d instanceof c))throw new Error("array item 1 must be a variable or expression");var v;for(e+=d.constant()*l,p=0,f=(v=d.terms()).size();p<f;p++)h=v.itemAt(p),n.setDefault(h.first,r).second+=h.second*l}}}return{terms:n,constant:e}}var p,f=function(){function t(){}return t.create=function(t,e,r,i){void 0===i&&(i=1);var n=0;return n+=1e6*Math.max(0,Math.min(1e3,t*i)),(n+=1e3*Math.max(0,Math.min(1e3,e*i)))+Math.max(0,Math.min(1e3,r*i))},t.clip=function(e){return Math.max(0,Math.min(t.required,e))},t.required=t.create(1e3,1e3,1e3),t.strong=t.create(1,0,0),t.medium=t.create(0,1,0),t.weak=t.create(0,0,1),t}();!function(t){t[t.Le=0]="Le",t[t.Ge=1]="Ge",t[t.Eq=2]="Eq"}(p||(p={}));var h,l=function(){function t(t,e,r,i){void 0===i&&(i=f.required),this._id=d++,this._operator=e,this._strength=f.clip(i),this._expression=void 0===r&&t instanceof c?t:t.minus(r)}return t.prototype.id=function(){return this._id},t.prototype.expression=function(){return this._expression},t.prototype.op=function(){return this._operator},t.prototype.strength=function(){return this._strength},t.prototype.toString=function(){return this._expression.toString()+" "+["<=",">=","="][this._operator]+" 0 ("+this._strength.toString()+")"},t}(),d=0,v=function(){function t(){this._cnMap=i(),this._rowMap=i(),this._varMap=i(),this._editMap=i(),this._infeasibleRows=[],this._objective=new b,this._artificial=null,this._idTick=0}return t.prototype.createConstraint=function(t,e,r,i){void 0===i&&(i=f.required);var n=new l(t,e,r,i);return this.addConstraint(n),n},t.prototype.addConstraint=function(t){if(void 0!==this._cnMap.find(t))throw new Error("duplicate constraint");var e=this._createRow(t),r=e.row,i=e.tag,n=this._chooseSubject(r,i);if(n.type()===h.Invalid&&r.allDummies()){if(!y(r.constant()))throw new Error("unsatisfiable constraint");n=i.marker}if(n.type()===h.Invalid){if(!this._addWithArtificialVariable(r))throw new Error("unsatisfiable constraint")}else r.solveFor(n),this._substitute(n,r),this._rowMap.insert(n,r);this._cnMap.insert(t,i),this._optimize(this._objective)},t.prototype.removeConstraint=function(t){var e=this._cnMap.erase(t);if(void 0===e)throw new Error("unknown constraint");this._removeConstraintEffects(t,e.second);var r=e.second.marker,i=this._rowMap.erase(r);if(void 0===i){var n=this._getMarkerLeavingSymbol(r);if(n.type()===h.Invalid)throw new Error("failed to find leaving row");(i=this._rowMap.erase(n)).second.solveForEx(n,r),this._substitute(r,i.second)}this._optimize(this._objective)},t.prototype.hasConstraint=function(t){return this._cnMap.contains(t)},t.prototype.addEditVariable=function(t,e){if(void 0!==this._editMap.find(t))throw new Error("duplicate edit variable");if((e=f.clip(e))===f.required)throw new Error("bad required strength");var r=new c(t),i=new l(r,p.Eq,void 0,e);this.addConstraint(i);var n={tag:this._cnMap.find(i).second,constraint:i,constant:0};this._editMap.insert(t,n)},t.prototype.removeEditVariable=function(t){var e=this._editMap.erase(t);if(void 0===e)throw new Error("unknown edit variable");this.removeConstraint(e.second.constraint)},t.prototype.hasEditVariable=function(t){return this._editMap.contains(t)},t.prototype.suggestValue=function(t,e){var r=this._editMap.find(t);if(void 0===r)throw new Error("unknown edit variable");var i=this._rowMap,n=r.second,o=e-n.constant;n.constant=e;var s=n.tag.marker,a=i.find(s);if(void 0!==a)return a.second.add(-o)<0&&this._infeasibleRows.push(s),void this._dualOptimize();var c=n.tag.other;if(void 0!==(a=i.find(c)))return a.second.add(o)<0&&this._infeasibleRows.push(c),void this._dualOptimize();for(var u=0,p=i.size();u<p;++u){var f=i.itemAt(u),l=f.second,d=l.coefficientFor(s);0!==d&&l.add(o*d)<0&&f.first.type()!==h.External&&this._infeasibleRows.push(f.first)}this._dualOptimize()},t.prototype.updateVariables=function(){for(var t=this._varMap,e=this._rowMap,r=0,i=t.size();r<i;++r){var n=t.itemAt(r),o=e.find(n.second);void 0!==o?n.first.setValue(o.second.constant()):n.first.setValue(0)}},t.prototype._getVarSymbol=function(t){var e=this;return this._varMap.setDefault(t,(function(){return e._makeSymbol(h.External)})).second},t.prototype._createRow=function(t){for(var e=t.expression(),r=new b(e.constant()),i=e.terms(),n=0,o=i.size();n<o;++n){var s=i.itemAt(n);if(!y(s.second)){var a=this._getVarSymbol(s.first),c=this._rowMap.find(a);void 0!==c?r.insertRow(c.second,s.second):r.insertSymbol(a,s.second)}}var u=this._objective,l=t.strength(),d={marker:m,other:m};switch(t.op()){case p.Le:case p.Ge:var v=t.op()===p.Le?1:-1,_=this._makeSymbol(h.Slack);if(d.marker=_,r.insertSymbol(_,v),l<f.required){var w=this._makeSymbol(h.Error);d.other=w,r.insertSymbol(w,-v),u.insertSymbol(w,l)}break;case p.Eq:if(l<f.required){var M=this._makeSymbol(h.Error),E=this._makeSymbol(h.Error);d.marker=M,d.other=E,r.insertSymbol(M,-1),r.insertSymbol(E,1),u.insertSymbol(M,l),u.insertSymbol(E,l)}else{var S=this._makeSymbol(h.Dummy);d.marker=S,r.insertSymbol(S)}}return r.constant()<0&&r.reverseSign(),{row:r,tag:d}},t.prototype._chooseSubject=function(t,e){for(var r=t.cells(),i=0,n=r.size();i<n;++i){var o=r.itemAt(i);if(o.first.type()===h.External)return o.first}var s=e.marker.type();return(s===h.Slack||s===h.Error)&&t.coefficientFor(e.marker)<0?e.marker:((s=e.other.type())===h.Slack||s===h.Error)&&t.coefficientFor(e.other)<0?e.other:m},t.prototype._addWithArtificialVariable=function(t){var e=this._makeSymbol(h.Slack);this._rowMap.insert(e,t.copy()),this._artificial=t.copy(),this._optimize(this._artificial);var r=y(this._artificial.constant());this._artificial=null;var i=this._rowMap.erase(e);if(void 0!==i){var n=i.second;if(n.isConstant())return r;var o=this._anyPivotableSymbol(n);if(o.type()===h.Invalid)return!1;n.solveForEx(e,o),this._substitute(o,n),this._rowMap.insert(o,n)}for(var s=this._rowMap,a=0,c=s.size();a<c;++a)s.itemAt(a).second.removeSymbol(e);return this._objective.removeSymbol(e),r},t.prototype._substitute=function(t,e){for(var r=this._rowMap,i=0,n=r.size();i<n;++i){var o=r.itemAt(i);o.second.substitute(t,e),o.second.constant()<0&&o.first.type()!==h.External&&this._infeasibleRows.push(o.first)}this._objective.substitute(t,e),this._artificial&&this._artificial.substitute(t,e)},t.prototype._optimize=function(t){for(;;){var e=this._getEnteringSymbol(t);if(e.type()===h.Invalid)return;var r=this._getLeavingSymbol(e);if(r.type()===h.Invalid)throw new Error("the objective is unbounded");var i=this._rowMap.erase(r).second;i.solveForEx(r,e),this._substitute(e,i),this._rowMap.insert(e,i)}},t.prototype._dualOptimize=function(){for(var t=this._rowMap,e=this._infeasibleRows;0!==e.length;){var r=e.pop(),i=t.find(r);if(void 0!==i&&i.second.constant()<0){var n=this._getDualEnteringSymbol(i.second);if(n.type()===h.Invalid)throw new Error("dual optimize failed");var o=i.second;t.erase(r),o.solveForEx(r,n),this._substitute(n,o),t.insert(n,o)}}},t.prototype._getEnteringSymbol=function(t){for(var e=t.cells(),r=0,i=e.size();r<i;++r){var n=e.itemAt(r),o=n.first;if(n.second<0&&o.type()!==h.Dummy)return o}return m},t.prototype._getDualEnteringSymbol=function(t){for(var e=Number.MAX_VALUE,r=m,i=t.cells(),n=0,o=i.size();n<o;++n){var s=i.itemAt(n),a=s.first,c=s.second;if(c>0&&a.type()!==h.Dummy){var u=this._objective.coefficientFor(a)/c;u<e&&(e=u,r=a)}}return r},t.prototype._getLeavingSymbol=function(t){for(var e=Number.MAX_VALUE,r=m,i=this._rowMap,n=0,o=i.size();n<o;++n){var s=i.itemAt(n),a=s.first;if(a.type()!==h.External){var c=s.second,u=c.coefficientFor(t);if(u<0){var p=-c.constant()/u;p<e&&(e=p,r=a)}}}return r},t.prototype._getMarkerLeavingSymbol=function(t){for(var e=Number.MAX_VALUE,r=e,i=e,n=m,o=n,s=n,a=n,c=this._rowMap,u=0,p=c.size();u<p;++u){var f=c.itemAt(u),l=f.second,d=l.coefficientFor(t);if(0!==d){var v=f.first;if(v.type()===h.External)a=v;else if(d<0)(y=-l.constant()/d)<r&&(r=y,o=v);else{var y;(y=l.constant()/d)<i&&(i=y,s=v)}}}return o!==n?o:s!==n?s:a},t.prototype._removeConstraintEffects=function(t,e){e.marker.type()===h.Error&&this._removeMarkerEffects(e.marker,t.strength()),e.other.type()===h.Error&&this._removeMarkerEffects(e.other,t.strength())},t.prototype._removeMarkerEffects=function(t,e){var r=this._rowMap.find(t);void 0!==r?this._objective.insertRow(r.second,-e):this._objective.insertSymbol(t,-e)},t.prototype._anyPivotableSymbol=function(t){for(var e=t.cells(),r=0,i=e.size();r<i;++r){var n=e.itemAt(r),o=n.first.type();if(o===h.Slack||o===h.Error)return n.first}return m},t.prototype._makeSymbol=function(t){return new _(t,this._idTick++)},t}();function y(t){return t<0?-t<1e-8:t<1e-8}!function(t){t[t.Invalid=0]="Invalid",t[t.External=1]="External",t[t.Slack=2]="Slack",t[t.Error=3]="Error",t[t.Dummy=4]="Dummy"}(h||(h={}));var _=function(){function t(t,e){this._id=e,this._type=t}return t.prototype.id=function(){return this._id},t.prototype.type=function(){return this._type},t}(),m=new _(h.Invalid,-1),b=function(){function t(t){void 0===t&&(t=0),this._cellMap=i(),this._constant=t}return t.prototype.cells=function(){return this._cellMap},t.prototype.constant=function(){return this._constant},t.prototype.isConstant=function(){return this._cellMap.empty()},t.prototype.allDummies=function(){for(var t=this._cellMap,e=0,r=t.size();e<r;++e)if(t.itemAt(e).first.type()!==h.Dummy)return!1;return!0},t.prototype.copy=function(){var e=new t(this._constant);return e._cellMap=this._cellMap.copy(),e},t.prototype.add=function(t){return this._constant+=t},t.prototype.insertSymbol=function(t,e){void 0===e&&(e=1),y(this._cellMap.setDefault(t,(function(){return 0})).second+=e)&&this._cellMap.erase(t)},t.prototype.insertRow=function(t,e){void 0===e&&(e=1),this._constant+=t._constant*e;for(var r=t._cellMap,i=0,n=r.size();i<n;++i){var o=r.itemAt(i);this.insertSymbol(o.first,o.second*e)}},t.prototype.removeSymbol=function(t){this._cellMap.erase(t)},t.prototype.reverseSign=function(){this._constant=-this._constant;for(var t=this._cellMap,e=0,r=t.size();e<r;++e){var i=t.itemAt(e);i.second=-i.second}},t.prototype.solveFor=function(t){var e=this._cellMap,r=-1/e.erase(t).second;this._constant*=r;for(var i=0,n=e.size();i<n;++i)e.itemAt(i).second*=r},t.prototype.solveForEx=function(t,e){this.insertSymbol(t,-1),this.solveFor(e)},t.prototype.coefficientFor=function(t){var e=this._cellMap.find(t);return void 0!==e?e.second:0},t.prototype.substitute=function(t,e){var r=this._cellMap.erase(t);void 0!==r&&this.insertRow(e,r.second)},t}()}}]);