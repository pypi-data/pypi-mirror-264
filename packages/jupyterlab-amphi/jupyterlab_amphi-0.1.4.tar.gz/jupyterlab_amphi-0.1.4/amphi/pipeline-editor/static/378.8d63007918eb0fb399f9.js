"use strict";(self.webpackChunk_amphi_pipeline_editor=self.webpackChunk_amphi_pipeline_editor||[]).push([[378],{934:(e,n,t)=>{t.d(n,{A:()=>s});var o=t(758),r=t.n(o),a=t(935),i=t.n(a)()(r());i.push([e.id,"/* this gets exported as style.css and can be used for the default theming */\n/* these are the necessary styles for React Flow, they get used by base.css and style.css */\n.react-flow__container {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  top: 0;\n  left: 0;\n}\n.react-flow__pane {\n  z-index: 1;\n  cursor: -webkit-grab;\n  cursor: grab;\n}\n.react-flow__pane.selection {\n    cursor: pointer;\n  }\n.react-flow__pane.dragging {\n    cursor: -webkit-grabbing;\n    cursor: grabbing;\n  }\n.react-flow__viewport {\n  transform-origin: 0 0;\n  z-index: 2;\n  pointer-events: none;\n}\n.react-flow__renderer {\n  z-index: 4;\n}\n.react-flow__selection {\n  z-index: 6;\n}\n.react-flow__nodesselection-rect:focus,\n.react-flow__nodesselection-rect:focus-visible {\n  outline: none;\n}\n.react-flow .react-flow__edges {\n  pointer-events: none;\n  overflow: visible;\n}\n.react-flow__edge-path,\n.react-flow__connection-path {\n  stroke: #b1b1b7;\n  stroke-width: 1;\n  fill: none;\n}\n.react-flow__edge {\n  pointer-events: visibleStroke;\n  cursor: pointer;\n}\n.react-flow__edge.animated path {\n    stroke-dasharray: 5;\n    -webkit-animation: dashdraw 0.5s linear infinite;\n            animation: dashdraw 0.5s linear infinite;\n  }\n.react-flow__edge.animated path.react-flow__edge-interaction {\n    stroke-dasharray: none;\n    -webkit-animation: none;\n            animation: none;\n  }\n.react-flow__edge.inactive {\n    pointer-events: none;\n  }\n.react-flow__edge.selected,\n  .react-flow__edge:focus,\n  .react-flow__edge:focus-visible {\n    outline: none;\n  }\n.react-flow__edge.selected .react-flow__edge-path,\n  .react-flow__edge:focus .react-flow__edge-path,\n  .react-flow__edge:focus-visible .react-flow__edge-path {\n    stroke: #555;\n  }\n.react-flow__edge-textwrapper {\n    pointer-events: all;\n  }\n.react-flow__edge-textbg {\n    fill: white;\n  }\n.react-flow__edge .react-flow__edge-text {\n    pointer-events: none;\n    -webkit-user-select: none;\n       -moz-user-select: none;\n            user-select: none;\n  }\n.react-flow__connection {\n  pointer-events: none;\n}\n.react-flow__connection .animated {\n    stroke-dasharray: 5;\n    -webkit-animation: dashdraw 0.5s linear infinite;\n            animation: dashdraw 0.5s linear infinite;\n  }\n.react-flow__connectionline {\n  z-index: 1001;\n}\n.react-flow__nodes {\n  pointer-events: none;\n  transform-origin: 0 0;\n}\n.react-flow__node {\n  position: absolute;\n  -webkit-user-select: none;\n     -moz-user-select: none;\n          user-select: none;\n  pointer-events: all;\n  transform-origin: 0 0;\n  box-sizing: border-box;\n  cursor: -webkit-grab;\n  cursor: grab;\n}\n.react-flow__node.dragging {\n    cursor: -webkit-grabbing;\n    cursor: grabbing;\n  }\n.react-flow__nodesselection {\n  z-index: 3;\n  transform-origin: left top;\n  pointer-events: none;\n}\n.react-flow__nodesselection-rect {\n    position: absolute;\n    pointer-events: all;\n    cursor: -webkit-grab;\n    cursor: grab;\n  }\n.react-flow__handle {\n  position: absolute;\n  pointer-events: none;\n  min-width: 5px;\n  min-height: 5px;\n  width: 6px;\n  height: 6px;\n  background: #1a192b;\n  border: 1px solid white;\n  border-radius: 100%;\n}\n.react-flow__handle.connectionindicator {\n    pointer-events: all;\n    cursor: crosshair;\n  }\n.react-flow__handle-bottom {\n    top: auto;\n    left: 50%;\n    bottom: -4px;\n    transform: translate(-50%, 0);\n  }\n.react-flow__handle-top {\n    left: 50%;\n    top: -4px;\n    transform: translate(-50%, 0);\n  }\n.react-flow__handle-left {\n    top: 50%;\n    left: -4px;\n    transform: translate(0, -50%);\n  }\n.react-flow__handle-right {\n    right: -4px;\n    top: 50%;\n    transform: translate(0, -50%);\n  }\n.react-flow__edgeupdater {\n  cursor: move;\n  pointer-events: all;\n}\n.react-flow__panel {\n  position: absolute;\n  z-index: 5;\n  margin: 15px;\n}\n.react-flow__panel.top {\n    top: 0;\n  }\n.react-flow__panel.bottom {\n    bottom: 0;\n  }\n.react-flow__panel.left {\n    left: 0;\n  }\n.react-flow__panel.right {\n    right: 0;\n  }\n.react-flow__panel.center {\n    left: 50%;\n    transform: translateX(-50%);\n  }\n.react-flow__attribution {\n  font-size: 10px;\n  background: rgba(255, 255, 255, 0.5);\n  padding: 2px 3px;\n  margin: 0;\n}\n.react-flow__attribution a {\n    text-decoration: none;\n    color: #999;\n  }\n@-webkit-keyframes dashdraw {\n  from {\n    stroke-dashoffset: 10;\n  }\n}\n@keyframes dashdraw {\n  from {\n    stroke-dashoffset: 10;\n  }\n}\n.react-flow__edgelabel-renderer {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  pointer-events: none;\n  -webkit-user-select: none;\n     -moz-user-select: none;\n          user-select: none;\n}\n.react-flow__edge.updating .react-flow__edge-path {\n      stroke: #777;\n    }\n.react-flow__edge-text {\n    font-size: 10px;\n  }\n.react-flow__node.selectable:focus,\n  .react-flow__node.selectable:focus-visible {\n    outline: none;\n  }\n.react-flow__node-default,\n.react-flow__node-input,\n.react-flow__node-output,\n.react-flow__node-group {\n  padding: 10px;\n  border-radius: 3px;\n  width: 150px;\n  font-size: 12px;\n  color: #222;\n  text-align: center;\n  border-width: 1px;\n  border-style: solid;\n  border-color: #1a192b;\n  background-color: white;\n}\n.react-flow__node-default.selectable:hover, .react-flow__node-input.selectable:hover, .react-flow__node-output.selectable:hover, .react-flow__node-group.selectable:hover {\n      box-shadow: 0 1px 4px 1px rgba(0, 0, 0, 0.08);\n    }\n.react-flow__node-default.selectable.selected,\n    .react-flow__node-default.selectable:focus,\n    .react-flow__node-default.selectable:focus-visible,\n    .react-flow__node-input.selectable.selected,\n    .react-flow__node-input.selectable:focus,\n    .react-flow__node-input.selectable:focus-visible,\n    .react-flow__node-output.selectable.selected,\n    .react-flow__node-output.selectable:focus,\n    .react-flow__node-output.selectable:focus-visible,\n    .react-flow__node-group.selectable.selected,\n    .react-flow__node-group.selectable:focus,\n    .react-flow__node-group.selectable:focus-visible {\n      box-shadow: 0 0 0 0.5px #1a192b;\n    }\n.react-flow__node-group {\n  background-color: rgba(240, 240, 240, 0.25);\n}\n.react-flow__nodesselection-rect,\n.react-flow__selection {\n  background: rgba(0, 89, 220, 0.08);\n  border: 1px dotted rgba(0, 89, 220, 0.8);\n}\n.react-flow__nodesselection-rect:focus,\n  .react-flow__nodesselection-rect:focus-visible,\n  .react-flow__selection:focus,\n  .react-flow__selection:focus-visible {\n    outline: none;\n  }\n.react-flow__controls {\n  box-shadow: 0 0 2px 1px rgba(0, 0, 0, 0.08);\n}\n.react-flow__controls-button {\n    border: none;\n    background: #fefefe;\n    border-bottom: 1px solid #eee;\n    box-sizing: content-box;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    width: 16px;\n    height: 16px;\n    cursor: pointer;\n    -webkit-user-select: none;\n       -moz-user-select: none;\n            user-select: none;\n    padding: 5px;\n  }\n.react-flow__controls-button:hover {\n      background: #f4f4f4;\n    }\n.react-flow__controls-button svg {\n      width: 100%;\n      max-width: 12px;\n      max-height: 12px;\n    }\n.react-flow__controls-button:disabled {\n      pointer-events: none;\n    }\n.react-flow__controls-button:disabled svg {\n        fill-opacity: 0.4;\n      }\n.react-flow__minimap {\n  background-color: #fff;\n}\n.react-flow__resize-control {\n  position: absolute;\n}\n.react-flow__resize-control.left,\n.react-flow__resize-control.right {\n  cursor: ew-resize;\n}\n.react-flow__resize-control.top,\n.react-flow__resize-control.bottom {\n  cursor: ns-resize;\n}\n.react-flow__resize-control.top.left,\n.react-flow__resize-control.bottom.right {\n  cursor: nwse-resize;\n}\n.react-flow__resize-control.bottom.left,\n.react-flow__resize-control.top.right {\n  cursor: nesw-resize;\n}\n/* handle styles */\n.react-flow__resize-control.handle {\n  width: 4px;\n  height: 4px;\n  border: 1px solid #fff;\n  border-radius: 1px;\n  background-color: #3367d9;\n  transform: translate(-50%, -50%);\n}\n.react-flow__resize-control.handle.left {\n  left: 0;\n  top: 50%;\n}\n.react-flow__resize-control.handle.right {\n  left: 100%;\n  top: 50%;\n}\n.react-flow__resize-control.handle.top {\n  left: 50%;\n  top: 0;\n}\n.react-flow__resize-control.handle.bottom {\n  left: 50%;\n  top: 100%;\n}\n.react-flow__resize-control.handle.top.left {\n  left: 0;\n}\n.react-flow__resize-control.handle.bottom.left {\n  left: 0;\n}\n.react-flow__resize-control.handle.top.right {\n  left: 100%;\n}\n.react-flow__resize-control.handle.bottom.right {\n  left: 100%;\n}\n/* line styles */\n.react-flow__resize-control.line {\n  border-color: #3367d9;\n  border-width: 0;\n  border-style: solid;\n}\n.react-flow__resize-control.line.left,\n.react-flow__resize-control.line.right {\n  width: 1px;\n  transform: translate(-50%, 0);\n  top: 0;\n  height: 100%;\n}\n.react-flow__resize-control.line.left {\n  left: 0;\n  border-left-width: 1px;\n}\n.react-flow__resize-control.line.right {\n  left: 100%;\n  border-right-width: 1px;\n}\n.react-flow__resize-control.line.top,\n.react-flow__resize-control.line.bottom {\n  height: 1px;\n  transform: translate(0, -50%);\n  left: 0;\n  width: 100%;\n}\n.react-flow__resize-control.line.top {\n  top: 0;\n  border-top-width: 1px;\n}\n.react-flow__resize-control.line.bottom {\n  border-bottom-width: 1px;\n  top: 100%;\n}\n",""]);const s=i},378:(e,n,t)=>{t.r(n),t.d(n,{IPipelineTracker:()=>X,default:()=>Y});var o=t(976),r=t(707),a=t(852),i=t(743),s=t(102),l=t(700),c=t(406),d=t(107),p=t(262),u=t(254),g=t(153);const m='<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg\n   width="16"\n   height="16"\n   fill="none"\n   viewBox="0 0 16 16"\n   version="1.1"\n   id="svg1"\n   sodipodi:docname="pipeline-brand-16.svg"\n   inkscape:version="1.3 (0e150ed, 2023-07-21)"\n   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"\n   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"\n   xmlns="http://www.w3.org/2000/svg"\n   xmlns:svg="http://www.w3.org/2000/svg">\n  <defs\n     id="defs1" />\n  <sodipodi:namedview\n     id="namedview1"\n     pagecolor="#505050"\n     bordercolor="#eeeeee"\n     borderopacity="1"\n     inkscape:showpageshadow="0"\n     inkscape:pageopacity="0"\n     inkscape:pagecheckerboard="0"\n     inkscape:deskcolor="#505050"\n     inkscape:zoom="14.75"\n     inkscape:cx="8"\n     inkscape:cy="7.9661017"\n     inkscape:window-width="1512"\n     inkscape:window-height="874"\n     inkscape:window-x="0"\n     inkscape:window-y="32"\n     inkscape:window-maximized="1"\n     inkscape:current-layer="svg1" />\n  <path\n     fill="currentColor"\n     fill-rule="evenodd"\n     d="M2.75 2.5A1.75 1.75 0 001 4.25v1C1 6.216 1.784 7 2.75 7h1a1.75 1.75 0 001.732-1.5H6.5a.75.75 0 01.75.75v3.5A2.25 2.25 0 009.5 12h1.018c.121.848.85 1.5 1.732 1.5h1A1.75 1.75 0 0015 11.75v-1A1.75 1.75 0 0013.25 9h-1a1.75 1.75 0 00-1.732 1.5H9.5a.75.75 0 01-.75-.75v-3.5A2.25 2.25 0 006.5 4H5.482A1.75 1.75 0 003.75 2.5h-1zM2.5 4.25A.25.25 0 012.75 4h1a.25.25 0 01.25.25v1a.25.25 0 01-.25.25h-1a.25.25 0 01-.25-.25v-1zm9.75 6.25a.25.25 0 00-.25.25v1c0 .138.112.25.25.25h1a.25.25 0 00.25-.25v-1a.25.25 0 00-.25-.25h-1z"\n     clip-rule="evenodd"\n     id="path1"\n     style="fill:#5a8f7b;fill-opacity:1" />\n</svg>\n',f=(new g.LabIcon({name:"amphi:file-text-icon",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><g fill="currentColor"><path d="M7.75 12a.75.75 0 000 1.5h8a.75.75 0 000-1.5h-8zM7 16.75a.75.75 0 01.75-.75h6a.75.75 0 010 1.5h-6a.75.75 0 01-.75-.75zM7.75 8a.75.75 0 000 1.5h2a.75.75 0 000-1.5h-2z"/><path fill-rule="evenodd" d="M3 3.75A2.75 2.75 0 015.75 1h7.586c.464 0 .909.184 1.237.513l5.914 5.914c.329.328.513.773.513 1.237V20.25A2.75 2.75 0 0118.25 23H5.75A2.75 2.75 0 013 20.25V3.75zM5.75 2.5c-.69 0-1.25.56-1.25 1.25v16.5c0 .69.56 1.25 1.25 1.25h12.5c.69 0 1.25-.56 1.25-1.25V9h-5.75a.75.75 0 01-.75-.75V2.5H5.75zm8.75 1.06l3.94 3.94H14.5V3.56z" clip-rule="evenodd"/></g></svg>'}),new g.LabIcon({name:"amphi:file-plus-icon",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><g fill="currentColor"><path d="M11.75 10.75a.75.75 0 01.75.75V14H15a.75.75 0 010 1.5h-2.5V18a.75.75 0 01-1.5 0v-2.5H8.5a.75.75 0 010-1.5H11v-2.5a.75.75 0 01.75-.75z"/><path fill-rule="evenodd" d="M5.75 1A2.75 2.75 0 003 3.75v16.5A2.75 2.75 0 005.75 23h12.5A2.75 2.75 0 0021 20.25V8.664c0-.464-.184-.909-.513-1.237l-5.914-5.914A1.75 1.75 0 0013.336 1H5.75zM4.5 3.75c0-.69.56-1.25 1.25-1.25H13v5.75c0 .414.336.75.75.75h5.75v11.25c0 .69-.56 1.25-1.25 1.25H5.75c-.69 0-1.25-.56-1.25-1.25V3.75zM18.44 7.5L14.5 3.56V7.5h3.94z" clip-rule="evenodd"/></g></svg>'}),new g.LabIcon({name:"amphi:monitor-icon",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M1 4.75A2.75 2.75 0 013.75 2h16.5A2.75 2.75 0 0123 4.75v10.5A2.75 2.75 0 0120.25 18H12.5v2.5H16a.75.75 0 010 1.5H8a.75.75 0 010-1.5h3V18H3.75A2.75 2.75 0 011 15.25V4.75zM20.25 16.5c.69 0 1.25-.56 1.25-1.25V4.75c0-.69-.56-1.25-1.25-1.25H3.75c-.69 0-1.25.56-1.25 1.25v10.5c0 .69.56 1.25 1.25 1.25h16.5z" clip-rule="evenodd"/></svg>'}),new g.LabIcon({name:"amphi:api-icon",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M2 5a3 3 0 115.585 1.524l1.79 1.79.68-.68a2.75 2.75 0 013.89 0l.68.68 1.79-1.79a3 3 0 111.06 1.06l-1.79 1.791.681.68a2.75 2.75 0 010 3.89l-.68.68 1.79 1.79a3 3 0 11-1.06 1.06l-1.791-1.79-.68.681a2.75 2.75 0 01-3.89 0l-.68-.68-1.79 1.79a3 3 0 11-1.06-1.06l1.79-1.791-.681-.68a2.75 2.75 0 010-3.89l.68-.68-1.79-1.79A3 3 0 012 5zm3-1.5a1.5 1.5 0 100 3 1.5 1.5 0 000-3zm0 14a1.5 1.5 0 100 3 1.5 1.5 0 000-3zM17.5 19a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0zM19 3.5a1.5 1.5 0 100 3 1.5 1.5 0 000-3zm-7.884 5.195a1.25 1.25 0 011.768 0l2.421 2.421a1.25 1.25 0 010 1.768l-2.421 2.421a1.25 1.25 0 01-1.768 0l-2.421-2.421a1.25 1.25 0 010-1.768l2.421-2.421z" clip-rule="evenodd"/></svg>'}),new g.LabIcon({name:"amphi:pipeline-icon",svgstr:m})),h=new g.LabIcon({name:"amphi:pipelinenegative-icon",svgstr:m}),w=new g.LabIcon({name:"amphi:pipelineCategory-icon",svgstr:'<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg\n   width="24"\n   height="24"\n   fill="none"\n   viewBox="0 0 24 24"\n   version="1.1"\n   id="svg1"\n   sodipodi:docname="pipeline-brand-24.svg"\n   inkscape:version="1.3 (0e150ed, 2023-07-21)"\n   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"\n   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"\n   xmlns="http://www.w3.org/2000/svg"\n   xmlns:svg="http://www.w3.org/2000/svg">\n  <defs\n     id="defs1" />\n  <sodipodi:namedview\n     id="namedview1"\n     pagecolor="#505050"\n     bordercolor="#eeeeee"\n     borderopacity="1"\n     inkscape:showpageshadow="0"\n     inkscape:pageopacity="0"\n     inkscape:pagecheckerboard="0"\n     inkscape:deskcolor="#505050"\n     inkscape:zoom="9.8333333"\n     inkscape:cx="12"\n     inkscape:cy="11.949153"\n     inkscape:window-width="1512"\n     inkscape:window-height="874"\n     inkscape:window-x="0"\n     inkscape:window-y="32"\n     inkscape:window-maximized="1"\n     inkscape:current-layer="svg1" />\n  <path\n     fill="currentColor"\n     fill-rule="evenodd"\n     d="M4.75 4.5A2.25 2.25 0 002.5 6.75v1A2.25 2.25 0 004.75 10h1a2.25 2.25 0 002.236-2H9.82c.967 0 1.75.784 1.75 1.75v4.5a3.25 3.25 0 003.25 3.25h1.195a2.25 2.25 0 002.236 2h1a2.25 2.25 0 002.25-2.25v-1A2.25 2.25 0 0019.25 14h-1a2.25 2.25 0 00-2.236 2h-1.195a1.75 1.75 0 01-1.75-1.75v-4.5A3.25 3.25 0 009.82 6.5H7.986a2.25 2.25 0 00-2.236-2h-1zM4 6.75A.75.75 0 014.75 6h1a.75.75 0 01.75.75v1a.75.75 0 01-.75.75h-1A.75.75 0 014 7.75v-1zm14.25 8.75a.75.75 0 00-.75.75v1c0 .414.336.75.75.75h1a.75.75 0 00.75-.75v-1a.75.75 0 00-.75-.75h-1z"\n     clip-rule="evenodd"\n     id="path1"\n     style="fill:#5a8f7b;fill-opacity:1" />\n</svg>\n'});var _=t(208),b=t(345),v=t.n(b),x=t(613),y=t.n(x),k=t(228);class C{static filterPipeline(e){const n=JSON.parse(e).pipelines[0].flow;return{nodes:n.nodes.map((({id:e,type:n,data:t})=>({id:e,type:n,data:t}))),edges:n.edges.map((({id:e,source:n,target:t,data:o})=>({id:e,source:n,target:t,data:o})))}}static extractPackageNames(e){const n=new Set(["json","pandas"]);return e.map((e=>{let t="";return t=e.startsWith("import ")?e.split(" ")[1].split(" as ")[0]:e.startsWith("from ")?e.split(" ")[1]:e,n.has(t)?"":t})).filter(((e,n,t)=>e&&t.indexOf(e)===n))}static getInstallCommandsFromPackageNames(e){return e.map((e=>`!pip install ${e} -q -q`))}static extractPythonImportPackages(e){return(e.match(/^(import .+|from .+? import .+)/gm)||[]).map((e=>e.startsWith("from")?e.split(" ")[1].split(".")[0]:e.split(" ")[1]))}static getPipelineRelativeNodePath(e,n){return k.PathExt.relative(k.PathExt.dirname(e),n)}static getComponentIdForFileExtension(e,n){const t=e.name.split(".").pop();if(!t)return{id:null,default:null};const o=n.getComponents();for(const e of o)if(e._fileDrop&&e._fileDrop.includes(t.toLowerCase()))return{id:e._id,default:e._default||null};return{id:null,default:null}}}C.findStartNode=e=>{const n=new Set;e.edges.forEach((e=>n.add(e.target)));for(const t of e.nodes)if(!n.has(t.id))return t.id;return null},C.findPreviousNodeId=(e,n)=>{let t="";return e.edges.forEach((e=>{e.target===n&&(t=e.source)})),t},C.findTwoPreviousNodeIds=(e,n)=>{let t=[];if(e.edges.forEach((e=>{e.target===n&&t.push(e.source)})),2!==t.length)throw new Error("Exactly two previous nodes are not found.");return t};class E{static generateCode(e,n,t){return this.generateCodeForNodes(C.filterPipeline(e),t,"none")}static generateCodeUntil(e,n,t,o){return this.generateCodeForNodes(C.filterPipeline(e),t,o)}}function z({id:e,sourceX:n,sourceY:t,targetX:o,targetY:r,sourcePosition:a,targetPosition:i,style:s={},markerEnd:l}){const{setEdges:c}=(0,x.useReactFlow)(),[d,p,u]=(0,x.getBezierPath)({sourceX:n,sourceY:t,sourcePosition:a,targetX:o,targetY:r,targetPosition:i});return v().createElement(v().Fragment,null,v().createElement(x.BaseEdge,{path:d,markerEnd:l,style:s}),v().createElement(x.EdgeLabelRenderer,null,v().createElement("div",{style:{position:"absolute",transform:`translate(-50%, -50%) translate(${p}px,${u}px)`,fontSize:12,pointerEvents:"all"},className:"nodrag nopan"},v().createElement("button",{className:"edgebutton",onClick:()=>{c((n=>n.filter((n=>n.id!==e))))}},"×"))))}E.generateCodeForNodes=(e,n,t)=>{let o="",a=new Map;const i=new Map,s=new Set,l=new Map,c=new Set,d=new Set;function p(e){const n=a.get(e)||0;a.set(e,n+1)}e.nodes.forEach((e=>{"annotation"!==e.type&&i.set(e.id,e)}));const u=r=>{if(s.has(r)||!((e,n,t)=>{if(!n||"none"===n)return!0;let o=!1;const r=e=>{e!==n?t.edges.forEach((n=>{n.source!==e||o||r(n.target)})):o=!0};return r(e),o})(r,t,e))return;s.add(r);const g=i.get(r);if(!g)return void console.error(`Node with id ${r} not found.`);let m=g.data;const f=n.getComponent(g.type);"function"==typeof(null==f?void 0:f.provideDependencies)&&f.provideDependencies({config:m}).forEach((e=>d.add(e))),f.provideImports({config:m}).forEach((e=>c.add(e)));let h="",w="";const _=n.getComponent(g.type)._type,b=n.getComponent(g.type)._id;switch(_){case"pandas_df_processor":p(b),h=l.get(C.findPreviousNodeId(e,g.id)),w=`${g.type}${a.get(b)}`,l.set(g.id,w),o+=n.getComponent(g.type).generateComponentCode({config:m,inputName:h,outputName:w});break;case"pandas_df_input":p(b),w=`${g.type}${a.get(b)}`,l.set(g.id,w),o+=n.getComponent(g.type).generateComponentCode({config:m,outputName:w});break;case"pandas_df_output":p(b),h=l.get(C.findPreviousNodeId(e,g.id)),o+=n.getComponent(g.type).generateComponentCode({config:m,inputName:h});break;default:console.error("Error generating code.")}r!==t?e.edges.forEach((e=>{e.source===r&&u(e.target)})):o+="\n"+l.get(r)},g=C.findStartNode(e);g?u(g):r.Notification.error("Code cannot be generated because no input components have been found.",{autoClose:8e3});const m=new Date;return`# Source code generated by Amphi\n# Date: ${m.getFullYear()}-${(m.getMonth()+1).toString().padStart(2,"0")}-${m.getDate().toString().padStart(2,"0")} ${m.getHours().toString().padStart(2,"0")}:${m.getMinutes().toString().padStart(2,"0")}:${m.getSeconds().toString().padStart(2,"0")}\n# Additional imports: ${Array.from(d).join(", ")}\n${Array.from(c).join("\n")}\n${o}`};var S=t(591),P=t.n(S),I=t(740),N=t.n(I),A=t(128),F=t.n(A),R=t(855),D=t.n(R),M=t(51),T=t.n(M),$=t(656),B=t.n($),L=t(934),H={};H.styleTagTransform=B(),H.setAttributes=D(),H.insert=F().bind(null,"head"),H.domAPI=N(),H.insertStyleElement=T(),P()(L.A,H),L.A&&L.A.locals&&L.A.locals,t(550);const O=({children:e,...n})=>{const{getRootProps:t}=(e=>{const n=(0,b.useRef)(null),t=(0,b.useCallback)((n=>{var t,o,r,a;switch(n.preventDefault(),n.stopPropagation(),n.type){case"lm-dragenter":null===(t=e.onDragEnter)||void 0===t||t.call(e,n);break;case"lm-dragleave":null===(o=e.onDragLeave)||void 0===o||o.call(e,n);break;case"lm-dragover":n.dropAction=n.proposedAction,null===(r=e.onDragOver)||void 0===r||r.call(e,n);break;case"lm-drop":null===(a=e.onDrop)||void 0===a||a.call(e,n)}}),[e]);return(0,b.useEffect)((()=>{const e=n.current;return null==e||e.addEventListener("lm-dragenter",t),null==e||e.addEventListener("lm-dragleave",t),null==e||e.addEventListener("lm-dragover",t),null==e||e.addEventListener("lm-drop",t),()=>{null==e||e.removeEventListener("lm-dragenter",t),null==e||e.removeEventListener("lm-dragleave",t),null==e||e.removeEventListener("lm-dragover",t),null==e||e.removeEventListener("lm-drop",t)}}),[t]),{getRootProps:()=>({ref:n})}})(n);return v().createElement("div",{style:{height:"100%"},...t()},e)};class V extends r.ReactWidget{constructor(e){super(),this.browserFactory=e.browserFactory,this.defaultFileBrowser=e.defaultFileBrowser,this.shell=e.shell,this.toolbarRegistry=e.toolbarRegistry,this.commands=e.commands,this.context=e.context,this.settings=e.settings,this.componentService=e.componentService;let n=null===this.context.model.toJSON();this.context.model.contentChanged.connect((()=>{n&&(n=!1,this.update())}))}render(){var e;return null===this.context.model.toJSON()?v().createElement("div",{className:"amphi-loader"}):v().createElement(W,{context:this.context,browserFactory:this.browserFactory,defaultFileBrowser:this.defaultFileBrowser,shell:this.shell,toolbarRegistry:this.toolbarRegistry,commands:this.commands,widgetId:null===(e=this.parent)||void 0===e?void 0:e.id,settings:this.settings,componentService:this.componentService})}}const W=({context:e,browserFactory:n,defaultFileBrowser:t,shell:o,toolbarRegistry:a,commands:i,settings:s,widgetId:l,componentService:c})=>{const d=t.model.manager,p={"custom-edge":z},u=c.getComponents().reduce(((n,t)=>{const o=t._id,r=n=>v().createElement(t.UIComponent,{context:e,manager:d,commands:i,...n});return n[o]=n=>v().createElement(r,{context:e,manager:d,commands:i,...n}),n}),{}),m=()=>"node_"+ +new Date;return v().createElement("div",{className:"palette",id:"pipeline-panel"},v().createElement(x.ReactFlowProvider,null,v().createElement((function(e){const n=(0,b.useRef)(null),[a,i]=(0,b.useState)(e.context.model.toJSON()),s=a.id,d=a.pipelines[0].flow.nodes,g=a.pipelines[0].flow.edges,[f,h,w]=(0,x.useNodesState)(d),[_,k,E]=(0,x.useEdgesState)(g),[z,S]=(0,b.useState)([]),[P,I]=(0,b.useState)(null),{setViewport:N}=(0,x.useReactFlow)(),A=a;A.pipelines[0].flow.nodes=f,A.pipelines[0].flow.edges=_,e.context.model.fromJSON(A);const F=(0,b.useCallback)((e=>k((n=>(0,x.addEdge)({...e,type:"custom-edge"},n)))),[k]),R=(0,b.useCallback)((e=>{k(e.reduce(((e,n)=>{const t=(0,x.getIncomers)(n,f,_),o=(0,x.getOutgoers)(n,f,_),r=(0,x.getConnectedEdges)([n],_);return[...e.filter((e=>!r.includes(e))),...t.flatMap((({id:e})=>o.map((({id:n})=>({id:`${e}->${n}`,source:e,target:n})))))]}),_))}),[f,_]),[D,M]=(0,b.useState)(10),T=(0,b.useCallback)((e=>{var a;const i=t;if((null===(a=o.currentWidget)||void 0===a?void 0:a.id)===l&&P&&e){const t=n.current.getBoundingClientRect(),o=P.project({x:e.x-t.left,y:e.y-t.top});Array.from(i.selectedItems()).forEach((e=>{const n=e.path,{id:t,default:a}=C.getComponentIdForFileExtension(e,c);if(t){const e={id:m(),type:t,position:o,data:{filePath:n,...a||{}}};h((n=>n.concat(e)))}else(0,r.showDialog)({title:"Unsupported File(s)",body:"Only supported files (CSV, JSON, PDF, HTML, etc...) can be added to a pipeline.",buttons:[r.Dialog.okButton()]})}))}}),[t,D,o,l,P]),$=(0,b.useCallback)((e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"}),[]),B=(0,b.useCallback)((e=>{e.preventDefault();const t=n.current.getBoundingClientRect(),o=e.dataTransfer.getData("application/reactflow"),r=e.dataTransfer.getData("additionalData");if(void 0===o||!o)return;const a=P.project({x:e.clientX-t.left,y:e.clientY-t.top}),i={id:m(),type:o,position:a,data:r};h((e=>e.concat(i)))}),[P]);return v().createElement("div",{className:"reactflow-wrapper",ref:n},v().createElement(O,{onDrop:async e=>{T({x:e.offsetX,y:e.offsetY})}},v().createElement(y(),{id:s,nodes:f,edges:_,onNodesChange:w,onNodesDelete:R,onEdgesChange:E,onConnect:F,onDrop:B,onDragOver:$,onInit:I,edgeTypes:p,nodeTypes:u,snapToGrid:!0,snapGrid:[15,15],fitViewOptions:{minZoom:.5,maxZoom:1.2},fitView:!0,defaultViewport:{x:0,y:0,zoom:1}},v().createElement(x.Panel,{position:"top-right"}),v().createElement(x.Controls,null),v().createElement(x.Background,{color:"#aaa",gap:15}))))}),{context:e}),v().createElement((function(){const[e,n]=(0,b.useState)(!1),t=e?"":"open",o={input:[],output:[],transform:[],other:[]};return c.getComponents().forEach((e=>{(o[e._category]||o.other).push(e)})),v().createElement("aside",{className:t,title:"Components"},v().createElement("div",{className:"description"},v().createElement(g.extensionIcon.react,{tag:"span",width:"24px",float:"left",marginRight:"8px"}),"Drag and drop components."),v().createElement("ul",{className:"mt-6 space-y-1"},Object.keys(o).map(((e,n)=>v().createElement("li",{key:e},v().createElement("details",{className:"group [&_summary::-webkit-details-marker]:hidden",open:0===n||1===n||2===n},v().createElement("summary",{className:"flex cursor-pointer items-center justify-between rounded-lg px-4 py-2 text-gray-500 hover:bg-grey-100 hover:text-gray-700"},v().createElement("span",{className:"text-sm font-medium"}," ",e.charAt(0).toUpperCase()+e.slice(1)),v().createElement("span",{className:"shrink-0 transition duration-300 group-open:-rotate-180"},v().createElement("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},v().createElement("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})))),v().createElement("ul",{className:"mt-2 space-y-1 px-4"},o[e].map((e=>v().createElement("li",{key:e._id},v().createElement("div",{key:e._id,className:"draggable_component",onDragStart:n=>((e,n,t)=>{e.dataTransfer.setData("application/reactflow",n),e.dataTransfer.setData("additionalData",t),e.dataTransfer.effectAllowed="move"})(n,e._id,e.getDefaultConfig?e.getDefaultConfig():""),draggable:!0},v().createElement(e._icon.react,{height:"16px",strokeWidth:"1px",marginRight:"8px",margin:"0px",padding:"0px",width:"16px;",color:"var(--cds-brand-01)"})," ",e._name)))))))))))}),null)))};class j extends _.ABCWidgetFactory{constructor(e){super(e),this.browserFactory=e.browserFactory,this.defaultFileBrowser=e.defaultFileBrowser,this.shell=e.shell,this.toolbarRegistry=e.toolbarRegistry,this.commands=e.commands,this.settings=e.settings,this.componentService=e.componentService}createNewWidget(e){const n={shell:this.shell,toolbarRegistry:this.toolbarRegistry,commands:this.commands,browserFactory:this.browserFactory,defaultFileBrowser:this.defaultFileBrowser,context:e,settings:this.settings,componentService:this.componentService},t=new V(n),o=new _.DocumentWidget({content:t,context:e}),a=new r.ToolbarButton({label:"Save Pipeline",icon:g.saveIcon,onClick:()=>{this.commands.execute("docmanager:save")}});o.toolbar.addItem("save",a);const i=new r.ToolbarButton({label:"Export to Python code",iconLabel:"Export to Python code",icon:g.buildIcon,onClick:async()=>{const n=E.generateCode(e.model.toString(),this.commands,this.componentService),t=await this.commands.execute("docmanager:new-untitled",{path:"/",type:"file",ext:".py"});(await this.commands.execute("docmanager:open",{path:t.path})).context.model.fromString(n)}});o.toolbar.addItem("generateCode",i);const s=new r.ToolbarButton({label:"Run Pipeline",iconLabel:"Run Pipeline",icon:g.runIcon,onClick:async()=>{this.commands.execute("docmanager:save");const n=await E.generateCode(e.model.toString(),this.commands,this.componentService);this.commands.execute("pipeline-editor:run-pipeline",{code:n}).catch((e=>{console.error(`An error occurred during the execution of 'pipeline-editor:run-pipeline'.\n${e}`)}))}});o.toolbar.addItem("runPipeline",s);const l=new r.ToolbarButton({label:"Metadata Panel",iconLabel:"Metadata Panel",icon:g.inspectorIcon,onClick:async()=>{const e="metadatapanel:open";this.commands.execute(e,{}).catch((n=>{console.error(`An error occurred during the execution of ${e}.\n${n}`)}))}});o.toolbar.addItem("openPreviewPanel",l);const c=new r.ToolbarButton({label:"Console",iconLabel:"Console",icon:g.listIcon,onClick:async()=>{const e="pipeline-console:open";this.commands.execute(e,{}).catch((n=>{console.error(`An error occurred during the execution of ${e}.\n${n}`)}))}});o.toolbar.addItem("openlogconsole",c);const d=r.Toolbar.createKernelNameItem(n.context.sessionContext),p=g.Toolbar.createSpacerItem();return o.toolbar.addItem("spacer",p),o.toolbar.addItem("kernelName",d),o.addClass("amphi-PipelineEditor"),o.title.icon=f,o}}var J;!function(e){e.create="pipeline-editor:create-new",e.restartPipelineKernel="pipeline-editor:restart-kernel",e.runPipeline="pipeline-editor:run-pipeline",e.runPipelineUntil="pipeline-editor:run-pipeline-until"}(J||(J={}));const U="Pipeline Editor",K="amphi-pipeline",X=new p.Token("pipeline-editor-tracker"),Y=[{id:"@amphi/pipeline-editor:plugin",autoStart:!0,requires:[r.ICommandPalette,c.IRenderMimeRegistry,s.ILauncher,l.IFileBrowserFactory,l.IDefaultFileBrowser,d.IStatusBar,o.ILayoutRestorer,a.IMainMenu,i.ISettingRegistry,r.IToolbarWidgetRegistry,r.ISessionContextDialogs,u.ComponentManager],provides:X,activate:(e,n,t,o,a,i,s,l,c,d,u,g,m)=>{console.log("Amphi Pipeline Extension activation...");const{commands:f}=e,_=J.create,b=new r.WidgetTracker({namespace:"amphi-pipeline-editor"}),v=d.load("@amphi/pipeline-editor:extension").catch((e=>console.log(e)));l&&l.restore(b,{command:"docmanager:open",args:e=>({path:e.context.path,factory:U}),name:e=>e.context.path});const x=new j({name:U,fileTypes:[K],defaultFor:[K],canStartKernel:!0,preferKernel:!0,shutdownOnClose:!0,shell:e.shell,toolbarRegistry:u,commands:e.commands,browserFactory:a,defaultFileBrowser:i,serviceManager:e.serviceManager,settings:v,componentService:m});function y(n){const t=b.currentWidget;return!1!==n.activate&&t&&e.shell.activateById(t.id),null!=t?t:null}function k(){return null!==b.currentWidget&&b.currentWidget===e.shell.currentWidget}return x.widgetCreated.connect(((e,n)=>{b.add(n),n.context.pathChanged.connect((()=>{b.save(n)}))})),e.docRegistry.addFileType({name:"amphi-pipeline",displayName:"pipeline",extensions:[".ampln"],icon:h,fileFormat:"text"},[U,"JSON"]),e.docRegistry.addWidgetFactory(x),f.addCommand(_,{label:e=>(e.isPalette||e.isContextMenu,"New Pipeline"),caption:"Create a new pipeline",icon:e=>e.isPalette?null:w,execute:async n=>f.execute("docmanager:new-untitled",{type:"file",path:i.model.path,ext:".ampln"}).then((async n=>{const t={doc_type:"Amphi Pipeline",version:"1",json_schema:"http://docs.amphi.ai/schemas/pipeline-v1-schema.json",id:"pipeline_"+ +new Date,pipelines:[{id:"primary",flow:{nodes:[],edges:[],viewport:{x:86,y:38,zoom:.5}},app_data:{ui_data:{comments:[]},version:1,runtime_type:"LOCAL"},runtime_ref:"python"}]},o=await e.commands.execute("docmanager:open",{path:n.path,factory:U});o.context.ready.then((()=>{o.context.model.fromJSON(t),e.commands.execute("docmanager:save",{path:n.path})}))}))}),f.addCommand(J.restartPipelineKernel,{label:"Restart Runtime…",execute:async e=>{const n=y({activate:!1,...e});if(n){console.log(n.context.sessionContext);try{await n.context.sessionContext.restartKernel()}catch(e){console.error("Failed to restart runtime: ",e)}}},isEnabled:k}),f.addCommand(J.runPipeline,{label:"Run Pipeline",execute:e=>{const n="pipeline-metadata-panel:delete-all";if(f.execute(n,{}).catch((e=>{console.error(`An error occurred during the execution of ${n}.\n${e}`)})),e.datapanel){const e="metadatapanel:open";f.execute(e,{}).catch((n=>{console.error(`An error occurred during the execution of ${e}.\n${n}`)}))}else f.execute("pipeline-console:open",{}).catch((e=>{console.error(`An error occurred during the execution of ${n}.\n${e}`)}));const t=y(e);t&&(t.context.sessionContext.session?t.context.sessionContext.hasNoKernel?r.Notification.error("The pipeline cannot be run because no processing engine can be found.",{actions:[{label:"Try to reload the application and run again.",callback:()=>location.reload()}],autoClose:6e3}):t.context.sessionContext?(t.context.sessionContext.ready.then((async()=>{const n=e.code.toString();let o;const r=C.extractPythonImportPackages(n);o=C.extractPackageNames(r);const a=n.split(/\r?\n/)[2],i=a.startsWith("# Additional imports: ")?a.split(": ")[1].split(",").map((e=>e.trim())):[];if(o=[...o,...i],o.length>0&&null!=o[0]&&""!==o[0]){const e=C.getInstallCommandsFromPackageNames(o).join("\n");try{const n=t.context.sessionContext.session.kernel.requestExecute({code:e});n.onReply=e=>{"ok"==e.content.status?console.log("Dependencies installed successfully"):("error"==e.content.status||e.content.status,console.log("Error when installing dependencies"))},await n.done}catch(e){console.error(e)}}})),t.context.sessionContext.ready.then((async()=>{try{const n=new p.PromiseDelegate,o=performance.now();r.Notification.promise(n.promise,{pending:{message:"Running...",options:{autoClose:!1}},success:{message:e=>`Pipeline execution successful after ${e.delayInSeconds} seconds.`,options:{autoClose:3e3}},error:{message:()=>"Pipeline execution failed. Check error messages in the Log Console.",options:{actions:[{label:"Log Console",callback:()=>{const e="pipeline-console:open";f.execute(e,{}).catch((n=>{console.error(`An error occurred during the execution of ${e}.\n${n}`)}))}}],autoClose:5e3}}});const a=t.context.sessionContext.session.kernel.requestExecute({code:e.code});a.onReply=e=>{const t=((performance.now()-o)/1e3).toFixed(1);"ok"==e.content.status?n.resolve({delayInSeconds:t}):("error"==e.content.status||e.content.status,n.reject({delayInSeconds:t}))},a.onIOPub=e=>{if("stream"===e.header.msg_type);else if("error"===e.header.msg_type){const n=e.content;console.error(`Received error: ${n.ename}: ${n.evalue}`)}},await a.done}catch(e){console.error(e)}}))):r.Notification.error("The pipeline cannot be run because the local Python engine cannot be found.",{actions:[{label:"Try to reload the application and run again.",callback:()=>location.reload()}],autoClose:6e3}):r.Notification.error("The pipeline cannot be run because the local Python engine cannot be found.",{actions:[{label:"Try to reload the application and run again.",callback:()=>location.reload()}],autoClose:6e3}))},isEnabled:k}),f.addCommand("pipeline-editor:run-pipeline-until",{label:"Run pipeline until ...",execute:async e=>{const n=y(e);if(!n)return;const t=e.nodeId.toString(),o=E.generateCodeUntil(n.context.model.toString(),f,m,t);f.execute("pipeline-editor:run-pipeline",{code:o}).catch((e=>{console.error(`An error occurred during the execution of 'pipeline-editor:run-pipeline'.\n${e}`)}))}}),e.contextMenu.addItem({command:J.create,selector:".jp-DirListing-content",rank:100}),n.addItem({command:J.create,category:"Pipeline",args:{isPalette:!0}}),o&&o.add({command:J.create,category:"Amphi",rank:3}),b}}]}}]);