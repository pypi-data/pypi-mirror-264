"use strict";(self.webpackChunkskillsnetwork_authoring_extension=self.webpackChunkskillsnetwork_authoring_extension||[]).push([[509],{5154:(t,e,o)=>{o.a(t,(async(t,n)=>{try{o.d(e,{A:()=>v});var a=o(2615),i=o(9604),r=o(454),l=o(1290),s=o(8474),c=o(4089),u=o(5729),d=o(7887),h=o(9677),p=o.n(h),w=o(7271),b=o(8225),y=t([d,c,s,b]);[d,c,s,b]=y.then?(await y)():y;const g={activate:k,id:"skillsnetwork-authoring-extension:plugin",autoStart:!0,requires:[l.IMainMenu,w.INotebookTracker,a.IDocumentManager]};class f{createNew(t,e){if(d.RV.SHOW_PUBLISH_BUTTON_FOR!==e.path)return new r.DisposableDelegate((()=>{}));{const o=async()=>{const o=e.path.split("/").pop()||"",n=d.RV.TOKENS.get(o);if(void 0===n)return console.log("No atlas or awb token found for id",t.id),void await(0,i.showDialog)({title:"Publishing Restricted",body:`Only the lab '${d.RV.TOKENS.keys().next().value}' can be published during this editing session.`,buttons:[i.Dialog.okButton({label:"Dismiss"})]});"version_id"in p()(n)?(0,c.$w)((0,c.P0)(n),t,e,n):(0,c.Xu)((0,c.zU)(n),t,e)},n=async()=>{const o=await(0,s.FH)(t,e),n=new Blob([o],{type:"application/x-ipynb+json"}),a=URL.createObjectURL(n),i=document.createElement("a");i.setAttribute("download",e.path),i.setAttribute("href",a),document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(a)},a=new i.ToolbarButton({className:"download-lab-button",label:"Download Notebook",onClick:n,tooltip:"Download the current notebook ipynb file to your local system"}),l=new i.ToolbarButton({className:"publish-lab-button",label:"Publish on SN",onClick:o,tooltip:"Publish Lab"}),u=new i.ToolbarButton({className:"sn-file-library-button",label:"SN File Library",onClick:()=>new b.C(e.path).launch(),tooltip:"Skills Network File Library"});return t.toolbar.insertItem(8,"download",a),t.toolbar.insertItem(9,"sn-file-library",u),t.toolbar.insertItem(10,"publish",l),new r.DisposableDelegate((()=>{a.dispose(),l.dispose(),u.dispose()}))}}}async function m(t,e){e.forEach((t=>{t.dispose()}))}async function k(t,e,o,n){if(console.log("Activating skillsnetwork-authoring-extension button plugin!"),"learn"==await(0,d.g)())return;const a=await(0,d.oK)(),r=await(0,d.RJ)(),l=await(0,d.By)();console.log("Using default kernel: ",d.RV.PY_KERNEL_NAME),t.docRegistry.addWidgetExtension("Notebook",new f),await t.serviceManager.ready,t.restored.then((async()=>{if(await m(0,o),"NO_TOKEN"!==a&&"local"!==l)try{await(0,s.oh)(a,n,t.serviceManager.contents)}catch(t){i.Dialog.flush(),(0,u.ep)(),console.log(t)}else if("NO_TOKEN"!==r&&"local"!==l)try{await(0,s.qu)(r,n,t.serviceManager.contents)}catch(t){i.Dialog.flush(),(0,u.ep)(),console.log(t)}})),console.log("Activated skillsnetwork-authoring-extension button plugin!")}const v=g;n()}catch(_){n(_)}}))},7887:(t,e,o)=>{o.a(t,(async(t,n)=>{try{o.d(e,{By:()=>u,GX:()=>i,RJ:()=>c,RV:()=>h,g:()=>l,oK:()=>s,p_:()=>r});var a=o(6603);const t=t=>{let e=t.baseUrl;return e.endsWith("/")||(e+="/"),e},i=await(async()=>{const e=window.location.href,o=new URL(e).searchParams.get("atlas_base_url");if(null===o){const e={method:"GET"},o=a.ServerConnection.makeSettings(),n=t(o)+"skillsnetwork-authoring-extension/config",i=await a.ServerConnection.makeRequest(n,e,o);return(await i.json()).ATLAS_BASE_URL}return decodeURIComponent(o)})(),r=await(async()=>{const e=window.location.href,o=new URL(e).searchParams.get("awb_base_url");if(null===o){const e={method:"GET"},o=a.ServerConnection.makeSettings(),n=t(o)+"skillsnetwork-authoring-extension/config",i=await a.ServerConnection.makeRequest(n,e,o);return(await i.json()).AWB_BASE_URL}return decodeURIComponent(o)})(),l=(await(async()=>{const e=window.location.href,o=new URL(e).searchParams.get("sn_file_library_url");if(null===o){const e={method:"GET"},o=a.ServerConnection.makeSettings(),n=t(o)+"skillsnetwork-authoring-extension/config",i=await a.ServerConnection.makeRequest(n,e,o);return(await i.json()).SN_FILE_LIBRARY_URL}return decodeURIComponent(o)})(),async()=>{const t=window.location.href;let e=new URL(t).searchParams.get("mode");return"learn"==e?e:"author"}),s=async()=>{const t=window.location.href,e=new URL(t).searchParams.get("atlas_token");return null!==e?e:"NO_TOKEN"},c=async()=>{const t=window.location.href,e=new URL(t).searchParams.get("awb_token");return null!==e?e:"NO_TOKEN"},u=async()=>{const t=window.location.href;let e=new URL(t).searchParams.get("env_type");return"jupyterlab"!==e&&"jupyterlite"!==e&&(e="local"),console.log("Env type: ",e),"jupyterlab"===e||"local"===e?(h.PY_KERNEL_NAME=await d(),h.DEFAULT_LAB_NAME="lab.ipynb"):"jupyterlite"===e&&(h.PY_KERNEL_NAME="python",h.DEFAULT_LAB_NAME="lab.jupyterlite.ipynb"),e},d=async()=>{let t=await(await a.KernelSpecAPI.getSpecs()).kernelspecs,e=Object.keys(t).filter((function(t){return t.includes("python")})).sort();return e[e.length-1]};class h{}h.TOKENS=new Map,h.SHOW_PUBLISH_BUTTON_FOR=void 0,h.PREV_PUB_HASH="prev_pub_hash",h.BACKUP_EXT=".backup",n()}catch(t){n(t)}}),1)},5729:(t,e,o)=>{o.d(e,{Kx:()=>r,VQ:()=>u,ep:()=>d,ms:()=>l,oY:()=>c,t5:()=>s});var n=o(4112),a=o(9604);class i extends n.Widget{constructor(){const t=document.createElement("div"),e=new a.Spinner;t.appendChild(e.node),t.style.padding="15px",super({node:t})}}const r=t=>{const e=new i;(0,a.showDialog)({title:t,body:e,buttons:[a.Dialog.cancelButton()]})},l=t=>{const e=new i;return(0,a.showDialog)({title:t,body:e,buttons:[]})},s=t=>(0,a.showDialog)({title:t,body:"Are you sure you want to publish? This action is not reversible",buttons:[a.Dialog.okButton(),a.Dialog.cancelButton()]}).then((t=>{if(!t.button.accept)throw new Error("Operation cancelled by the user.")})),c=()=>{(0,a.showDialog)({title:"Success!",body:"This lab has been successfully published!",buttons:[a.Dialog.okButton()]}).then((t=>{})).catch((t=>{}))},u=()=>{(0,a.showDialog)({title:"Failed to Publish",body:"This lab failed to publish.",buttons:[a.Dialog.okButton()]}).then((t=>{})).catch((t=>{}))},d=()=>{(0,a.showDialog)({title:"Failed to Load Lab",body:"This lab failed to load.",buttons:[a.Dialog.okButton()]}).then((t=>{})).catch((t=>{}))}},4089:(t,e,o)=>{o.a(t,(async(t,n)=>{try{o.d(e,{$w:()=>f,BD:()=>m,P0:()=>y,Xu:()=>k,zO:()=>g,zU:()=>b});var a=o(9645),i=o.n(a),r=o(5729),l=o(9604),s=o(7887),c=o(8474),u=o(5674),d=o.n(u),h=o(9677),p=o.n(h),w=t([s,c]);[s,c]=w.then?(await w)():w;const b=t=>d().create({baseURL:s.GX,headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json","Access-Control-Allow-Origin":"*",Accept:"application/json"}}),y=t=>d().create({baseURL:s.p_,headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json","Access-Control-Allow-Origin":"*",Accept:"application/json"}}),g=async(t,e)=>{try{const o=p()(e),n=o.version_id,a=o.lab_id,i=`${o.lab_name}.ipynb`,r=await t.get(`api/v1/labs/${a}/lab_versions/${n}/download`).then((t=>t.data));return l.Dialog.flush(),{labFilename:i,body:r}}catch(t){throw console.log(t),"Failed to fetch notebook"}},f=async(t,e,o,n)=>{if(!await(0,r.t5)("Publishing your lab onto Skills Network...").then((t=>!0)).catch((t=>!1)))return;(0,r.ms)("Publishing your changes...");const a=p()(n),s=a.version_id,u=a.lab_id;await(0,c.rA)(e,o);const d=await(0,c.FH)(e,o),h=new(i());return h.append("publish","true"),h.append("draft[changelog]","updated notebook"),h.append("file",d),new Promise((async(e,o)=>{await t.post(`api/v1/labs/${u}/lab_versions/${s}/drafts`,h).then((t=>{console.log("SUCCESSFULLY PUSHED",t),l.Dialog.flush(),(0,r.oY)()})).catch((t=>{console.log(t),l.Dialog.flush(),(0,r.VQ)()}))}))},m=t=>t.get("v1/labs").then((t=>(l.Dialog.flush(),t.data))).catch((t=>{throw console.log(t),"Failed to fetch notebook"})),k=async(t,e,o)=>{if(!await(0,r.t5)("Publishing your lab onto Skills Network...").then((t=>!0)).catch((t=>!1)))return;(0,r.ms)("Publishing your changes..."),await(0,c.rA)(e,o);const n=await(0,c.FH)(e,o);return new Promise((async(e,o)=>{await t.post("v1/labs",{body:n}).then((t=>{console.log("SUCCESSFULLY PUSHED",t),l.Dialog.flush(),(0,r.oY)()})).catch((t=>{console.log(t),l.Dialog.flush(),(0,r.VQ)()}))}))};n()}catch(t){n(t)}}))},8509:(t,e,o)=>{o.a(t,(async(t,n)=>{try{o.r(e),o.d(e,{default:()=>l});var a=o(7809),i=o(5154),r=t([i,a]);[i,a]=r.then?(await r)():r;const l=[i.A,a.M];n()}catch(t){n(t)}}))},7809:(t,e,o)=>{o.a(t,(async(t,n)=>{try{o.d(e,{M:()=>b});var a=o(1290),i=o(4112),r=o(9604),l=o(7271),s=o(2615),c=o(5729),u=o(7887),d=o(8474),h=o(9677),p=o.n(h),w=t([u,d]);[u,d]=w.then?(await w)():w;const b={id:"skillsnetwork-authoring-extension:menu",autoStart:!0,requires:[a.IMainMenu,l.INotebookTracker,s.IDocumentManager],activate:async(t,e,o,n)=>{if(console.log("Activating skillsnetwork-authoring-extension menu plugin!"),"learn"==await(0,u.g)())return;const a="edit-lab-from-token";t.commands.addCommand(a,{label:"Edit a Lab",execute:()=>y(0,n,t.serviceManager.contents)});const{commands:r}=t,l=new i.Menu({commands:r});l.title.label="Skills Network",e.addMenu(l,{rank:80}),l.addItem({command:a,args:{}}),console.log("Activated skillsnetwork-authoring-extension menu plugin!")}};function y(t,e,o){let n=document.createElement("div"),a=document.createElement("label");a.textContent="Enter your authorization token";let l=document.createElement("input");l.className="jp-mod-styled",n.appendChild(a),n.appendChild(l),(0,r.showDialog)({title:"Edit a Lab",body:new i.Widget({node:n}),buttons:[r.Dialog.cancelButton(),r.Dialog.okButton()]}).then((async t=>{if(t.button.accept){(0,c.Kx)("Loading up your lab...");const t=l.value;"version_id"in p()(t)?await(0,d.qu)(t,e,o):await(0,d.oh)(t,e,o)}})).catch((t=>{r.Dialog.flush(),(0,c.ep)(),console.log(t)}))}n()}catch(g){n(g)}}))},8225:(t,e,o)=>{o.a(t,(async(t,n)=>{try{o.d(e,{C:()=>h});var a=o(4112),i=o(9604),r=o(7887),l=o(9677),s=o.n(l),c=t([r]);r=(c.then?(await c)():c)[0];var u;class d extends a.Widget{constructor(t){function e(t,e){const o=document.createElement("li"),n=document.createElement("a");return n.textContent=t,n.style.color="brown",n.href=e,n.style.textDecoration="underline",n.style.cursor="pointer",o.appendChild(n),o}const o=document.createElement("div"),n=document.createElement("h2");n.textContent="File Library is not available for JupyterLab Classic.",o.appendChild(n);const a=document.createElement("p");a.style.textAlign="left",a.textContent="Try opening the File Library from Author Workbench or upgrade your JupyterLab Classic to JupyterLab Current.";const i=document.createElement("ul");i.style.textAlign="left",i.appendChild(e("How to access File Library from Author Workbench","https://author.skills.network/docs/labs/jupyterlab-filelibrary")),i.appendChild(e("How to upgrade to JupyterLab Current","https://author.skills.network/docs/labs/upgrade-jupyterlab")),o.appendChild(a),o.appendChild(i),o.style.padding="20px",o.style.margin="10px",o.style.textAlign="center",super({node:o})}}class h{constructor(t){u.set(this,void 0),function(t,e,o){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");e.set(t,o)}(this,u,t)}launch(){const t=r.RV.TOKENS.get(function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}(this,u).split("/").pop()||""),e=t?s()(t):{},o=r.p_+"/labs/"+e.lab_id+"?show=content",n=new i.Dialog({title:"Skills Network File Library",body:new d(o),hasClose:!0,buttons:[i.Dialog.cancelButton()]}),a=n.node.querySelector(".jp-Dialog-content");a&&a.classList.add("sn-file-library-dialog"),n.launch()}}u=new WeakMap,n()}catch(t){n(t)}}))},8474:(t,e,o)=>{o.a(t,(async(t,n)=>{try{o.d(e,{FH:()=>u,oh:()=>y,qu:()=>b,rA:()=>d});var a=o(9604),i=o(7887),r=o(4089),l=t([i,r]);[i,r]=l.then?(await l)():l;const s=t=>({cell_type:t.model.type,id:t.model.id,metadata:{},outputs:[],source:[t.model.value.text]}),c=t=>({cell_type:t.model.type,id:"",metadata:{},outputs:[],source:[t.model.value.text]}),u=(t,e)=>{const o=[];t.content.widgets.forEach((t=>{const e=s(t);o.push(e)}));const n=e.model.metadata.toJSON(),a=e.model.nbformat,i=e.model.nbformatMinor,r={cells:o,metadata:n,nbformat:a,nbformat_minor:i};return JSON.stringify(r,null,2)};async function d(t,e){const o=await w(t,e),n=await R(o);await e.ready,e.model.metadata.set(i.RV.PREV_PUB_HASH,n),e.save().then((()=>{console.log("Notebook saved with updated metadata.")})).catch((t=>{console.error("Failed to save notebook:",t)}))}function h(t){var e,o,n,a,r,l,s;return"string"==typeof t&&(t=JSON.parse(t)),"object"!=typeof t||null===t||!("metadata"in t)&&!("content"in t)?(console.error("Lab content is of unknown type: ",typeof t,"\n Value: \n",t),""):null!==(s=null!==(n=null===(o=null===(e=t.metadata)||void 0===e?void 0:e[i.RV.PREV_PUB_HASH])||void 0===o?void 0:o.toString())&&void 0!==n?n:null===(l=null===(r=null===(a=t.content)||void 0===a?void 0:a.metadata)||void 0===r?void 0:r[i.RV.PREV_PUB_HASH])||void 0===l?void 0:l.toString())&&void 0!==s?s:""}function p(t){var e;if("string"==typeof t)try{t=JSON.parse(t)}catch(t){return console.error("Error parsing lab content string: ",t),!1}if("object"!=typeof t||null===t||!("cells"in t)&&(!t.content||!("cells"in t.content)))return console.error("Lab content is of unknown type or missing 'cells': ",typeof t,"\n Value: \n",t),!1;const o=t.cells||(null===(e=t.content)||void 0===e?void 0:e.cells);return 0===o.length||1===o.length&&0===o[0].source.length}const w=(t,e)=>{const o=[];return t.content.widgets.forEach((t=>{const e=c(t);o.push(e)})),JSON.stringify(o,null,2)},b=async(t,e,o)=>{let n,{labFilename:a,body:l}=await(0,r.zO)((0,r.P0)(t),t);if(a=a.replace(/^.*[\\\/]/,""),await f(a,o,e),await g(a,l,o,e),i.RV.SHOW_PUBLISH_BUTTON_FOR=a,i.RV.TOKENS.set(a,t),await v(`./${a}`,o))n=e.openOrReveal(a);else{if(n=e.createNew(a,"notebook",{name:i.RV.PY_KERNEL_NAME}),void 0===n)throw Error("Error loading lab");await m(n,l)}return n},y=async(t,e,o)=>{let{instructions_file_path:n,body:a}=await(0,r.BD)((0,r.zU)(t));const l=k(n);let s;if(await f(l,o,e),await g(l,a,o,e),i.RV.SHOW_PUBLISH_BUTTON_FOR=l,i.RV.TOKENS.set(l,t),await v(`./${l}`,o))s=e.openOrReveal(l);else{if(s=e.createNew(l,"notebook",{name:i.RV.PY_KERNEL_NAME}),void 0===s)throw Error("Error loading lab");await m(s,JSON.parse(a))}return s};async function g(t,e,o,n){const r=`./${t}`,l=await v(r,o);if(l&&h(e)!==h(l))try{await S(l,o,n),await(0,a.showDialog)({title:"Your Lab was Updated",body:`The newest published version of "${t}" is loaded. Your previous version has been backed up under "${t}${i.RV.BACKUP_EXT}.ipynb"`,buttons:[a.Dialog.okButton({label:"Dismiss"})]})}catch(e){await(0,a.showDialog)({title:"Error with Previous File",body:`While trying to load your lab: "${t}", we found that you have another file named "${t}" that already exists in this folder, please delete it or rename it so we can load your published version"`,buttons:[a.Dialog.okButton({label:"Dismiss"})]})}}async function f(t,e,o){const n=`./${t}`,a=await v(n,e);a&&(await E(n,o),p(a)&&await e.delete(n))}const m=async(t,e,o)=>{if(await t.context.ready,"local"!==o)if(t.context&&t.context.model){t.context.model.fromJSON(e);try{await t.context.save()}catch(t){console.error("Error saving notebook:",t)}}else console.error("Notebook model is not initialized.")},k=t=>(null!=t?t:i.RV.DEFAULT_LAB_NAME).replace(/^.*[\\\/]/,"");async function v(t,e){try{return await e.get(t)}catch(t){if(t instanceof Error){const e=t;if(e.response&&404!==e.response.status)throw console.error("Error checking for existent backup file: ",t),t;return null}throw console.error("Unexpected error occured: ",t),t}}async function _(t,e){const o=e.findWidget(t);if(o){try{o.context.model.dirty&&await o.context.save()}catch(t){console.error("Error saving widget content:",t)}o.close()}}async function E(t,e){const o=e.findWidget(t);if(o)try{const t=e.contextForWidget(o);t&&t.model&&(t.model.dirty=!1),o.close()}catch(t){console.error("Error closing widget:",t)}}async function S(t,e,o){const n=t.path,a=n.split(".").pop(),r=`${n.replace(/\.[^/.]+$/,"")}${i.RV.BACKUP_EXT}.${a}`;if(await v(r,e))try{await e.delete(r)}catch(t){console.error("Unexpected error occured: ",t)}try{await _(n,o),await e.rename(n,r)}catch(t){console.error("Unexpected error occured: ",t)}}async function R(t){const e=(new TextEncoder).encode(t),o=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(o)).map((t=>t.toString(16).padStart(2,"0"))).join("")}n()}catch(N){n(N)}}))}}]);