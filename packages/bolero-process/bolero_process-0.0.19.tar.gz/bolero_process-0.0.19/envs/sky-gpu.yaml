# jupyter.yaml

resources:
  cloud: gcp
  instance_type: n1-highmem-16
  region: us-central1
  disk_size: 128
  accelerators: T4:1
  image_id: projects/hms-dev-greenberg-4923/global/images/hanqing-py310cuda118torch220

file_mounts:
  /data:
    source: gs://hms-hanqing-analysis
    mode: MOUNT
  /ref:
    source: gs://hms-hanqing-reference
    mode: MOUNT
  /wmb:
    source: gs://hms-hanqing-wmb
    mode: MOUNT
  /tempdata:
    source: gs://hms-hanqing-temp
    mode: MOUNT

setup: |
  if [ -f /tmp/SKIPSETUP ]
  then
    echo "Skip setup"
  else
    mamba install -y "pandas<2.1" bedtools transformers
    pip install -U numexpr
    pip install allcools wmb
    pip install -e /ref/pkg/bolero-process
    pip install -e /ref/pkg/bolero
    touch /tmp/SKIPSETUP
  fi

run: |
  pip install -U numexpr
  nohup jupyter-lab --LabApp.token='' --no-browser --port 8000 > ~/jupyter.log 2>&1 &
