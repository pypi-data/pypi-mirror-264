name: astro
nebula-version: 1.0.0

build: null

push: null

pull:
- nebula.deployments.steps.git_clone:
    repository: https://github.com/kozmoai/astro.git
- nebula.deployments.steps.run_shell_script:
    script: pip install git+https://github.com/kozmoai/astro.git nebula-gcp

deployments:
- name: github-repo-digest
  tags: ['internal-tools', 'LLM']
  description: Summarize a repo's activity over a given time period
  schedule:
    cron: '0 18 * * 1-5'
    timezone: America/Chicago
  entrypoint: cookbook/flows/github_digest/repo_activity.py:daily_github_digest
  parameters:
    post_story_to_slack: true
  work_pool:
    name: kubernetes-prd-internal-tools
    job_variables:
      env:
        OPENAI_API_KEY: '{{ nebula.blocks.secret.openai-api-key }}'

- name: label-issues
  tags: ['internal-tools', 'LLM']
  description: Label issues based on their content
  triggers:
    - enabled: true
      expect:
        - astro.issue.opened
        - astro.issue.reopened
      parameters:
        event_body_json: "{{ event.payload.body }}"
  entrypoint: cookbook/flows/label_issues.py:label_issues
  work_pool:
    name: kubernetes-prd-internal-tools
    job_variables:
      env:
        OPENAI_API_KEY: '{{ nebula.blocks.secret.openai-api-key }}'
        GH_UTIL_TOKEN: '{{ nebula.blocks.secret.gh-token }}'
        EXTRA_PIP_PACKAGES: 'gh-util'