var Tt=Object.defineProperty;var Ut=(s,t,e)=>t in s?Tt(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var Q=(s,t,e)=>(Ut(s,typeof t!="symbol"?t+"":t,e),e);import{d as L,f as A,B as y,C as pe,D as Y,E as m,o as fe,G as At,H as n,c as D,I as T,w as te,a as w,F as j,J as ee,z as P,K as V,L as R,M as E,N as dt,O as B,P as Mt,Q as Lt,R as ne,S as ae,U as ht,V as pt,W as ue,X as N,Y as je,Z as J,_ as Ke,$ as ze,a0 as Ie,a1 as Ve,a2 as Bt,n as Rt,a3 as Et,a4 as qt,a5 as at,a6 as st,a7 as Ot}from"./@vue-BC7wygdO.js";import{d as Ee,c as Ft}from"./pinia-JuONmuTa.js";import{u as ge,a as ft,c as zt,b as Ht}from"./vue-router-BNRov78Z.js";import{M as Nt}from"./async-mutex-CSJywVGb.js";import{f as Wt}from"./fast-xml-parser-CJG3bOwu.js";import{P as He}from"./plotly.js-dist-xw8c5UHU.js";import{E as jt,M as Kt}from"./md-editor-v3-DY1iTu2S.js";import{M as Vt}from"./markdown-it-DI8MEbma.js";import"./strnum-u8jQhLSb.js";import"./copy-to-clipboard-CupmGcto.js";import"./toggle-selection-BHUZwh74.js";import"./@vavt-B4fzJ49s.js";import"./@codemirror-BDhkIXHx.js";import"./@lezer-9ZEEcu4s.js";import"./style-mod-Bc2inJdb.js";import"./w3c-keyname-Vcq4gwWv.js";import"./medium-zoom-CHfgT04g.js";import"./markdown-it-image-figures-BD49Kf-b.js";import"./markdown-it-task-lists-BxuSizwB.js";import"./markdown-it-xss-DwZvMPOe.js";import"./xss-DnjGkJ2-.js";import"./cssfilter-BjxKUPhv.js";import"./mdurl-k9Sl0PQj.js";import"./uc.micro-kMc2yuuw.js";import"./entities-C20TfXL6.js";import"./linkify-it-DmNjr4Kv.js";import"./punycode.js-Dj65hjkv.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function e(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(i){if(i.ep)return;i.ep=!0;const o=e(i);fetch(i.href,o)}})();const Zt=L({__name:"Popup",props:{styleType:{default:"info"},position:{default:"top-center"}},setup(s){const t=s,e=A(()=>t.styleType==="alert"||t.styleType==="error"?{backgroundColor:"rgba(180, 0, 20, 0.9)",color:"rgba(255, 255, 255, 1)"}:t.styleType==="warning"?{backgroundColor:"rgba(210, 150, 0, 0.9)",color:"rgba(255, 255, 255, 1)"}:t.styleType==="info"?{backgroundColor:"rgba(0, 0, 0, 0.75)",color:"rgba(255, 255, 255, 1)"}:t.styleType==="success"?{backgroundColor:"rgba(0, 180, 0, 0.9)",color:"rgba(255, 255, 255, 1)"}:{backgroundColor:"rgba(0, 0, 0, 0.5)",color:"var(--color-text)"}),a=A(()=>{if(t.position==="top-center")return{top:"30px",left:"50%",transform:"translate(-50%, 0)"};if(t.position==="center")return{top:"50%",left:"50%",transform:"translate(-50%, -50%)"};throw Error("Incorrect style.")});return(i,o)=>(m(),y("div",{id:"popup",style:Y({...e.value,...a.value})},[pe(i.$slots,"default",{},void 0,!0)],4))}}),q=(s,t)=>{const e=s.__vccOpts||s;for(const[a,i]of t)e[a]=i;return e},ot=q(Zt,[["__scopeId","data-v-e0ba6b84"]]),le="->";class O extends Set{static removeSpaces(t){const e=t.split(le);for(let a=0;a<e.length;a++)e[a]=e[a].trim();return t=e.join(le),t}constructor(t=null){t===null&&(t=[]);const e=t instanceof Set?t:new Set(t);e.forEach(a=>O.removeSpaces(a)),super(e)}copy(){return new O(this)}add(t){return super.add(O.removeSpaces(t))}has(t){return super.has(O.removeSpaces(t))}union(t){const e=new O(this);return e.union_(t),e}union_(t){return t.forEach(e=>this.add(e)),this}pop(t){const e=new O(this);return e.pop_(t),e}pop_(t){return t.forEach(e=>this.delete(e)),this}pop_ifcontains_(t){return t.forEach(e=>{this.has(e)&&this.delete(e)}),this}issubset(t){return Se.isSubset(this,t)}withParents(){const t=new O(this);return this.forEach(e=>t.union_(Se.allParentsOf(e))),t}withChildsFrom(t){const e=new O(this);return this.forEach(a=>e.union_(Se.allChildsOf(a,t))),e}allParents(){const t=new O;return this.forEach(e=>t.union_(Se.allParentsOf(e))),t}toArray(){return Array.from(this)}}class Se{static allParentsOf(t){const e=t.split(le);if(e.length===1)return new O([]);const a=[],i=[];for(let o=0;o<e.length-1;o++)a.push(e[o]),i.push(a.join(le));return new O(i)}static allChildsOf(t,e){const a=new O;for(const i of e)i.startsWith(t)&&i.length>t.length+le.length&&i.substring(t.length,t.length+le.length)===`${le}`&&a.add(i);return a}static tagHierarchy(t){const e=le;function a(r,l){const d=r.split(l);return d.length===1?[r]:[d[0],d.slice(1).join(l)]}function i(r,l=e){const d={},g=r.map(p=>a(p,l));for(const p of g)p[0]in d||(d[p[0]]=[]),p.length===2&&d[p[0]].push(p[1]);const u={};for(const p in d)u[p]=i(d[p],l);return u}function o(r,l=e){for(const d in r){const g=r[d];for(const u in g){const p=[d,u].join(e);g[p]=g[u],delete g[u]}o(g,l)}return r}return o(i(Array.from(t)))}static isSubset(t,e){let a=!0;for(const i of t)if(!e.has(i)){a=!1;break}return a}}class De{constructor(t,e){Q(this,"summary");Q(this,"supp");Q(this,"conn");this.summary=e,this.supp={note:null,abstract:null},this.conn=t}get backendUrl(){return this.conn.baseURL}get tags(){return new O(this.summary.tags)}get uid(){return this.summary.uuid}get title(){return this.summary.title}get authors(){return this.summary.authors}get year(){return this.summary.year}get publication(){return this.summary.publication}get url(){return this.summary.url}get bibtex(){return this.summary.bibtex}toString(){return`${this.summary.title} - ${this.authorAbbr()} (${this.summary.year}) [uid: ${this.summary.uuid}]`}fetchAbstract(){return new Promise((t,e)=>{this.conn.reqDatapointAbstract(this.summary.uuid).then(a=>{this.supp.abstract=a,t(a)}).catch(a=>{e(a)})})}uploadAbstract(t){return new Promise((e,a)=>{if(t===this.supp.abstract||t===null){e(!0);return}this.conn.updateDatapointAbstract(this.summary.uuid,t).then(i=>{this.supp.abstract=t,e(i)}).catch(i=>{a(i)})})}fetchNote(){return new Promise((t,e)=>{this.conn.reqDatapointNote(this.summary.uuid).then(a=>{this.supp.note=a,t(a)}).catch(a=>{e(a)})})}uploadNote(t){return t===null?Promise.reject("Note is null"):new Promise((e,a)=>{this.conn.updateDatapointNote(this.summary.uuid,t).then(i=>{this.supp.note=t,this.summary.note_linecount=t.split(`
`).map(o=>o.trim()==""?0:1).reduce((o,r)=>o+r,0),e(i)}).catch(i=>{a(i)})})}deleteMiscFile(t){return this.conn.deleteMiscFile(this.summary.uuid,t)}renameMiscFile(t,e){return this.conn.renameMiscFile(this.summary.uuid,t,e)}listMiscFiles(){const t=this.conn.listMiscFiles(this.summary.uuid),e=`${this.backendUrl}/misc/${this.summary.uuid}`;return t.then(a=>a.map(i=>{const o=new URLSearchParams;return o.append("fname",i),o.append("_u",K().user.id.toString()),{fname:i,rpath:`./misc/${i}`,url:`${e.toString()}?${o.toString()}`}}))}uploadMisc(t){return new Promise((e,a)=>{this.conn.uploadMiscFiles(this.summary.uuid,t).then(i=>{e(i.map(o=>`./misc/${o}`))},i=>{a(i)})})}uploadDocument(t){return this.conn.uploadDocument(this.summary.uuid,t)}freeDocument(){return this.conn.freeDocument(this.summary.uuid)}update(t=null){if(t!==null)return this.summary=t,Promise.resolve(t);const e=this.conn.reqDatapointSummary(this.summary.uuid);return e.then(a=>{this.summary=a}),e}destory(){this.summary=Re}authorAbbr(){let t="";return this.summary.authors.length>1&&(t=" et al."),this.summary.authors[0]+t}authorYear(){return`${this.authorAbbr()} ${this.summary.year}`}yearAuthor(t=" "){return`${this.summary.year}${t}${this.authorAbbr()}`}isDummy(){return this.summary.uuid===Re.uuid}getRawDocURL(){const t=this.summary.uuid;return this.summary.has_file?`${this.backendUrl}/doc/${t}?_u=${K().user.id}`:!this.summary.has_file&&this.url?this.url:"about:blank"}getOpenDocURL({extraPDFViewerParams:t={},urlHashMark:e=""}={}){const a=`${this.backendUrl}/pdfjs/web/viewer.html`;function i(l,d=a){const g=new URLSearchParams;d===a&&g.append("key",H().encKey),g.append("file",`${l}`);for(const u in t)g.append(u,t[u]);return`${d}?${g.toString()}`}function o(l){return e?(new URL(l).hash&&(l=l.slice(0,l.indexOf("#"))),`${l}#${e}`):l}let r="about:blank";if(this.isDummy()&&(r="about:blank"),this.summary.has_file&&this.summary.file_type==".pdf"){const l=this.getRawDocURL();r=i(o(l))}if(this.summary.has_file&&this.summary.file_type==".html"){const l=this.getRawDocURL();r=o(l)}return!this.summary.has_file&&this.summary.url&&(r=o(this.summary.url)),console.log("Open doc url: ",r),r}docType(){return this.summary.has_file&&this.summary.file_type==".pdf"?"pdf":this.summary.has_file&&this.summary.file_type==".html"?"html":!this.summary.has_file&&this.summary.url?"url":!this.summary.has_file&&!this.summary.url?"":"unknown"}}const Re={has_file:!1,file_type:"",year:"0000",title:" ",author:" ",authors:[" "],publication:null,tags:[],uuid:" ",url:"about:blank",time_added:0,time_modified:0,bibtex:"",doc_size:0,note_linecount:0,has_abstract:!1};class Gt{constructor(t){Q(this,"cache");Q(this,"tags");Q(this,"uids");Q(this,"dataInfoAcquireMutex",new Nt);Q(this,"conn");Q(this,"_initliazed");this.cache={},this.uids=new Array,this.tags=new O,this._initliazed=!1,this.conn=t}get initialized(){return this._initliazed}async init(){await this.updateKeyCache(),await this.updateTagCache(),this._initliazed=!0,console.log("Get init data of size: ",((JSON.stringify(this.uids)+JSON.stringify(this.tags)).length*2/1024/1024).toPrecision(2),"MB")}allTags(){return this.tags}allKeys(){return this.uids}async updateKeyCache(){this.uids=await this.conn.reqAllKeys()}async updateTagCache(){this.tags=new O(await this.conn.reqAllTags())}async update(t,e=!0){let a;return t.uuid in this.cache?(this.cache[t.uuid].update(t),a=this.cache[t.uuid].tags):(this.cache[t.uuid]=new De(this.conn,t),a=new O),this.uids.includes(t.uuid)||this.uids.unshift(t.uuid),e&&(o=>{const r=new O;for(const l in this.cache)r.union_(this.cache[l].tags);return this.tags.union_(r),!o.issubset(r)})(a)&&await this.updateTagCache(),this.cache[t.uuid]}clear(){this.cache={},this.uids=new Array,this.tags=new O([]),this._initliazed=!1}async delete(t,e=!0){let a;t in this.cache?(a=this.cache[t].tags,delete this.cache[t]):a=null,this.uids.includes(t)&&(this.uids=this.uids.filter(o=>o!==t)),e&&(o=>{if(o===null)return!0;const r=new O;for(const l in this.cache)r.union_(this.cache[l].tags);return!o.issubset(r)})(a)&&await this.updateTagCache()}hasCache(t){return t in this.cache}getDummy(){return new De(this.conn,Re)}async aget(t){if(!(t in this.cache))try{const e=await this.conn.reqDatapointSummary(t);this.cache[t]=new De(this.conn,e)}catch(e){return console.warn("Caught error in aget: ",e),new De(this.conn,Re)}return this.cache[t]}async agetMany(t,e=!0,a=!0){const i=async()=>{this.dataInfoAcquireMutex.acquire();try{const l=Object.keys(this.cache),d=t.filter(p=>!l.includes(p));if(d.length===0)return t.map(p=>this.cache[p]);const g=await this.conn.reqDatapointSummaries(d);console.log("DEBUG: get data points of size: ",g.length),g.map(p=>new De(this.conn,p)).forEach(p=>{this.cache[p.uid]=p})}catch(l){throw l}finally{this.dataInfoAcquireMutex.release()}return t.map(l=>this.cache[l])},o=async()=>await Promise.all(t.map(l=>this.aget(l)));if(e)try{return await i()}catch(r){if(a)return console.warn("Caught error in agetMany: ",r),await o();throw r}return await o()}async agetByAuthor(t){const e=await this.conn.filter({searchBy:"author",searchContent:t});return await this.agetMany(e.uids)}getCacheByTags(t){t=new O(t);const e=[];for(const a in this.cache){const i=this.cache[a],o=new O(i.summary.tags);t.issubset(o.withParents())&&e.push(i)}return e}}class it{constructor(t,e){Q(this,"conn");Q(this,"info");this.conn=t,this.info=e}get baseURL(){return this.conn.baseURL}avatarURL(t=128,e=-1){let a;return e===null?a="":e<0?a=`&t=${Date.now()}`:a=`&t=${e}`,`${this.baseURL}/user-avatar/${this.info.username}?size=${t}${a}`}}class Jt{constructor(t){Q(this,"conn");this.conn=t}async list(){return(await this.conn.reqUserList()).map(e=>new it(this.conn,e))}async get(t){let e=await this.conn.reqUserInfo(t);return new it(this.conn,e)}}var he=function s(t){function e(se,de){return se>>>de|se<<32-de}for(var a=Math.pow,i=a(2,32),o="length",r,l,d="",g=[],u=t[o]*8,p=s.h=s.h||[],h=s.k=s.k||[],v=h[o],f={},x=2;v<64;x++)if(!f[x]){for(r=0;r<313;r+=x)f[r]=x;p[v]=a(x,.5)*i|0,h[v++]=a(x,1/3)*i|0}for(t+="";t[o]%64-56;)t+="\0";for(r=0;r<t[o];r++){if(l=t.charCodeAt(r),l>>8)throw new Error("ASCII check failed");g[r>>2]|=l<<(3-r)%4*8}for(g[g[o]]=u/i|0,g[g[o]]=u,l=0;l<g[o];){var $=g.slice(l,l+=16),S=p;for(p=p.slice(0,8),r=0;r<64;r++){var c=$[r-15],_=$[r-2],C=p[0],k=p[4],b=p[7]+(e(k,6)^e(k,11)^e(k,25))+(k&p[5]^~k&p[6])+h[r]+($[r]=r<16?$[r]:$[r-16]+(e(c,7)^e(c,18)^c>>>3)+$[r-7]+(e(_,17)^e(_,19)^_>>>10)|0),I=(e(C,2)^e(C,13)^e(C,22))+(C&p[1]^C&p[2]^p[1]&p[2]);p=[b+I|0].concat(p),p[4]=p[4]+b|0}for(r=0;r<8;r++)p[r]=p[r]+S[r]|0}for(r=0;r<8;r++)for(l=3;l+1;l--){var W=p[r]>>l*8&255;d+=(W<16?0:"")+W.toString(16)}return d};class Qt{constructor({baseUrlGetter:t=()=>"",tokenGetter:e=()=>"",sessionIDGetter:a=()=>""}){this._baseUrlGetter=t,this._tokenGetter=e,this._sessionIDGetter=a}get baseUrl(){return this._baseUrlGetter()}get token(){return this._tokenGetter()}get sessionID(){return this._sessionIDGetter()}async get(t,e={}){const a=new URL(`${this._baseUrlGetter()}${t}`);return Object.keys(e).forEach(i=>a.searchParams.append(i,e[i])),await this._fetch(a.toString(),{method:"GET"})}async post(t,e={}){const a=new FormData;for(const i in e){let o=e[i];o instanceof Array&&(o=JSON.stringify(o)),a.append(i,o)}return await this._fetch(`${this._baseUrlGetter()}${t}`,{method:"POST",body:a})}async put(t,e){const a=new FormData;return a.append("key",this._tokenGetter()),a.append("file",e),await this._fetch(`${this._baseUrlGetter()}${t}`,{method:"PUT",body:a})}async delete(t,e={}){const a=new FormData;for(const i in e){let o=e[i];o instanceof Array&&(o=JSON.stringify(o)),a.append(i,o)}return a.append("key",this._tokenGetter()),await this._fetch(`${this._baseUrlGetter()}${t}`,{method:"DELETE",body:a})}async _fetch(t,e){if((e==null?void 0:e.method)==="GET"){const i=new URL(t);i.searchParams.append("key",this._tokenGetter()),i.searchParams.append("session_id",this._sessionIDGetter()),t=i.toString()}if((e==null?void 0:e.method)==="POST"||(e==null?void 0:e.method)==="PUT"||(e==null?void 0:e.method)==="DELETE")if(e.body===void 0)e.body=JSON.stringify({key:this._tokenGetter()});else if(typeof e.body=="string")e.body=JSON.stringify({key:this._tokenGetter(),session_id:this._sessionIDGetter(),...JSON.parse(e.body)});else if(e.body instanceof FormData)e.body.has("key")||e.body.append("key",this._tokenGetter()),e.body.has("session_id")||e.body.append("session_id",this._sessionIDGetter());else throw new Error("Not implemented body type");const a=await fetch(t,e);if(!a.ok)throw new Error(`Request failed with status ${a.status}`);return a}}class Yt{constructor(t,e,a){this.fetcher=new Qt({baseUrlGetter:t,tokenGetter:e,sessionIDGetter:a})}get baseURL(){return this.fetcher.baseUrl}async authUsr(t){return await this.fetcher.post("/api/auth",{key:t}).then(e=>e.json())}async status(){return await this.fetcher.get("/api/status").then(t=>t.json())}async reqAllKeys(){return await this.fetcher.get("/api/database/keys").then(t=>t.json())}async reqAllTags(){return await this.fetcher.get("/api/database/tags").then(t=>t.json())}async reqDatabaseFeatureTSNE(t="doc_feature",e=3,a=10){return await this.fetcher.get(`/api/datafeat/tsne/${t}`,{n_component:e.toString(),perplexity:a.toString()}).then(i=>i.json())}async reqDatabaseUsage(){return await this.fetcher.get("/api/database/usage").then(t=>t.json())}async reqDatapointSummary(t){return await this.fetcher.get(`/api/datainfo/${t}`).then(e=>e.json())}async reqDatapointSummaries(t){return await this.fetcher.post("/api/datainfo-list",{uids:JSON.stringify(t)}).then(e=>e.json())}async reqDatapointAbstract(t){return await this.fetcher.get(`/api/datainfo-supp/abstract/${t}`).then(e=>e.text())}async updateDatapointAbstract(t,e){return await this.fetcher.post(`/api/datainfo-supp/abstract-update/${t}`,{content:e}).then(a=>!0)}async reqDatapointNote(t){return await this.fetcher.get(`/api/datainfo-supp/note/${t}`).then(e=>e.text())}async updateDatapointNote(t,e){return await this.fetcher.post(`/api/datainfo-supp/note-update/${t}`,{content:e}).then(a=>!0)}async search(t,e){return console.warn("ServerConn.search will be deprecated in the future, use ServerConn.filter instead"),await this.fetcher.post("/api/search",{method:t,kwargs:JSON.stringify(e)}).then(a=>a.json())}async filter({tags:t=[],searchBy:e="title",searchContent:a="",max_results:i=9999}={}){return await this.fetcher.post("/api/filter/basic",{tags:t,search_by:e,search_content:a,top_k:i}).then(o=>o.json())}async featurize(t,e=!1){return await this.fetcher.post("/api/iserver/textFeature",{text:t,require_cache:e}).then(a=>a.json())}reqAISummary(t,e,a=()=>{},i=!0,o="DEFAULT"){this.fetcher.post("/api/summary",{force:i,uuid:t,model:o}).then(r=>{if(!r.ok)throw e("(Error: "+r.status+")"),new Error("HTTP error "+r.status);const l=r.body.getReader(),d=({value:g,done:u})=>{if(u){a();return}let p=new TextDecoder().decode(g);return e(p),l.read().then(d)};return l.read().then(d)})}async deleteDatapoint(t){return await this.fetcher.post("/api/dataman/delete",{uuid:t}).then(()=>!0)}async updateDatapoint(t,e=null,a=null,i=null){if(!t&&(e===null||a===null||i===null))throw new Error("uid is null, other fields should be complete");const o={};return t!==null&&(o.uuid=JSON.stringify(t)),e!==null&&(o.bibtex=e),a!==null&&(o.tags=JSON.stringify(a)),i!==null&&(o.url=i),await this.fetcher.post("/api/dataman/update",o).then(r=>r.json())}async listMiscFiles(t){return await this.fetcher.get(`/api/misc-list/${t}`).then(e=>e.json())}async deleteMiscFile(t,e){return await this.fetcher.delete(`/misc/${t}`,{fname:e}).then(()=>!0)}async renameMiscFile(t,e,a){return await this.fetcher.post(`/misc/${t}`,{fname:e,dst_fname:a}).then(()=>!0)}async uploadMiscFiles(t,e){return(await Promise.all(e.map(i=>new Promise((o,r)=>{this.fetcher.put(`/misc/${t}`,i).then(l=>l.json()).then(o).catch(r)})))).map(i=>i.file_name)}async uploadDocument(t,e){return await this.fetcher.put(`/doc/${t}`,e).then(a=>a.json())}async freeDocument(t){return await this.fetcher.delete(`/doc/${t}`).then(e=>e.json())}async renameTag(t,e){return await this.fetcher.post("/api/dataman/tag-rename",{oldTag:t,newTag:e}).then(()=>!0)}async deleteTag(t){return await this.fetcher.post("/api/dataman/tag-delete",{tag:t}).then(()=>!0)}async reqUserInfo(t){return await this.fetcher.post(`/api/user/info/${t}`).then(e=>e.json())}async updateUserNickname(t){return await this.fetcher.post("/api/user/info-update",{name:t}).then(e=>e.json())}async updateUserPassword(t){return await this.fetcher.post("/api/user/info-update",{password:he(t)}).then(e=>e.json())}async reqUserList(){return await this.fetcher.post("/api/user/list",{}).then(t=>t.json())}async uploadUserAvatar(t,e){return await this.fetcher.put(`/user-avatar/${t}`,e).then(a=>a.json())}async setUserAccess(t,e,a,i){const o={};return o.username=t,e!==null&&(o.is_admin=e.toString()),a!==null&&(o.mandatory_tags=JSON.stringify(a)),i!==null&&(o.max_storage=i),await this.fetcher.post("/api/userman/modify",o).then(r=>r.json())}async createUser(t,e,a,i,o,r){return await this.fetcher.post("/api/userman/create",{username:t,name:e,password:he(a),is_admin:i.toString(),mandatory_tags:JSON.stringify(o),max_storage:r}).then(l=>l.json())}async deleteUser(t){return await this.fetcher.post("/api/userman/delete",{username:t}).then(()=>!0)}async fetchFeedList(t=10,e="arxiv"){return await this.fetcher.post("/api/feed",{max_results:t,category:e}).then(a=>a.json())}async changelog(){return await this.fetcher.get("/api/info/changelog").then(t=>t.json())}}const ce={};window.g_eventHooks=ce;function ie(s,t){if(Array.isArray(s)){for(const e of s)ie(e,t);return}ce[s]===void 0&&(ce[s]=[]),ce[s].includes(t)||ce[s].push(t)}function mt(s,t){if(Array.isArray(s)){for(const e of s)mt(e,t);return}ce[s]!==void 0&&(ce[s]=ce[s].filter(e=>e!==t))}function Xt(s,t){fe(()=>{ie(s,t),console.log(`registered event callback [${s}]`,t.name)}),At(()=>{mt(s,t),console.log(`unregistered event callback [${s}]`,t.name)})}class en{constructor(t,e){Q(this,"resetRemainingRetries",()=>{this.__remainingRetries=10});Q(this,"decreaseRemainingRetries",()=>{this.__remainingRetries-=1});Q(this,"isOpen",()=>this.ws?this.ws.readyState===WebSocket.OPEN:!1);Q(this,"willTryReconnect",()=>this.__remainingRetries>0);this.__baseUrlGetter=t,this.__tokenGetter=e,this.resetRemainingRetries(),this.sessionID=he(Date.now().toString()).slice(0,16),this.__eventCallback_records={onopenCallback:()=>{},onmessageCallback:a=>{},oncloseCallback:()=>{},onfailedToConnectCallback:()=>{}}}connect({onopenCallback:t=()=>{},onmessageCallback:e=o=>{},oncloseCallback:a=()=>{},onfailedToConnectCallback:i=()=>{}}={}){this.__eventCallback_records={onopenCallback:t,onmessageCallback:e,oncloseCallback:a,onfailedToConnectCallback:i};const o=new URLSearchParams(window.location.search);o.append("key",this.__tokenGetter()),o.append("session_id",this.sessionID);const r=this.__baseUrlGetter().replace("https://","wss://").replace("http://","ws://")+"/ws?"+o.toString();return console.log("connecting to server websocket at: ",r),this.ws=new WebSocket(r),this.ws.onmessage=l=>{console.log(l);const d=JSON.parse(l.data);if(d.type==="event"){const g=d.content;if(console.log(g),Object.keys(ce).includes(g.type))for(const u of ce[g.type])u(g)}e(l)},this.ws.onopen=()=>{console.log("connected to server websocket"),t(),this.resetRemainingRetries()},this.ws.onclose=()=>{console.log("server websocket closed, will try to reconnect in 1 second"),a(),this.willTryReconnect()?(this.decreaseRemainingRetries(),new Promise(l=>setTimeout(l,1e3)).then(()=>{this.ws.readyState===WebSocket.CLOSED&&this.connect({onopenCallback:t,onmessageCallback:e,oncloseCallback:a,onfailedToConnectCallback:i})})):i()},this}send(t){this.ws.readyState===WebSocket.OPEN?this.ws.send(JSON.stringify(t)):console.log("server websocket not ready, cannot send data")}resetReconnect(){this.ws&&this.ws.readyState===WebSocket.OPEN&&this.ws.close(),this.resetRemainingRetries(),this.connect(this.__eventCallback_records)}close(){this.ws&&this.ws.readyState===WebSocket.OPEN?(this.__remainingRetries=0,this.ws.close()):console.log("server websocket not ready, cannot close")}}async function Ze(s){if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(s),!0;{const t=document.createElement("textarea");t.value=s,t.style.position="absolute",t.style.left="-99999999px",document.body.prepend(t),t.select();let e=!1;try{document.execCommand("copy")}catch(a){console.log(a),e=!0}finally{t.remove()}return!e}}function tn(s){window.open(s,"_blank")}function vt(s,t){let e=null;return function(...a){e&&window.clearTimeout(e),e=window.setTimeout(()=>{s(...a),e=null},t)}}function rt(s,t,e=null){let a="";if(e){let i=new Date;i.setTime(i.getTime()+e*24*60*60*1e3),a=`expires=${i.toUTCString()}; `}document.cookie=`${s}=${t}; ${a} path=/; sameSite=Lax`}function nn(s){return decodeURIComponent(document.cookie).split("; ").forEach(a=>{if(a.startsWith(`${s}=`)&&a.includes("expires"))return!0}),!1}function an(s){const e=decodeURIComponent(document.cookie).split("; ");let a="";return e.forEach(i=>{i.indexOf(s)===0&&(a=i.substring(`${s}=`.length))}),a}const F=Ee("uiStatus",{state:()=>({tagStatus:{checked:new O,all:new O,unfolded:new O},shownDataUIDs:[],shownDataScores:[],searchState:{searchBy:"",content:""},unfoldedDataUIDs:[],recentlyReadDataUIDs:[],preferredReaderLeftPanelWidthPerc:.65,showMiscPanel:!1,popupValues:{},databaseLoadingStatus:{nCurrent:0,nTotal:-1},dataEditorOpened:!1}),getters:{databaseLoadingProgress(){return this.databaseLoadingStatus.nTotal===-1?this.databaseLoadingStatus.nCurrent===0?0:1:this.databaseLoadingStatus.nCurrent/this.databaseLoadingStatus.nTotal}},actions:{updateShownData(){const s=K();this.tagStatus.all=s.allTags,console.log("DEBUG: updateShownData() is called."),G().conn.filter({tags:Array.from(this.tagStatus.checked),searchBy:this.searchState.searchBy,searchContent:this.searchState.content}).then(t=>{this.shownDataUIDs=t.uids,this.shownDataScores=t.scores})},addRecentlyReadDataUID(s){this.recentlyReadDataUIDs.includes(s)&&this.recentlyReadDataUIDs.splice(this.recentlyReadDataUIDs.indexOf(s),1),this.recentlyReadDataUIDs.unshift(s),this.recentlyReadDataUIDs.length>5&&this.recentlyReadDataUIDs.pop()},showPopup(s,t="info",e=3e3){const a=Math.random().toString();this.popupValues[a]={content:s,styleType:t},setTimeout(()=>{delete this.popupValues[a]},e)},reloadDatabase(){K().reload(()=>{this.databaseLoadingStatus.nCurrent=0,K().database.clear(),this.updateShownData()},()=>{F().databaseLoadingStatus.nTotal=-1,F().tagStatus.all=K().database.allTags(),this.updateShownData()},()=>{this.showPopup(`Failed to load database from: ${G().conn.baseURL}`,"alert"),F().databaseLoadingStatus.nTotal=-1})}}}),G=Ee("connection",{state:()=>{const s=new en(H().backend,()=>H().encKey);return{conn:new Yt(H().backend,()=>H().encKey,()=>s.sessionID),wsConn:s}}}),K=Ee("data",{state:()=>({database:new Gt(G().conn),userPool:new Jt(G().conn),user:{id:-1,username:"",enc_key:"",name:"",is_admin:!1,mandatory_tags:[],has_avatar:!1,max_storage:0}}),getters:{allTags(){return this.database.allTags()}},actions:{clearUserInfo(){this.user={id:0,username:"",enc_key:"",name:"",is_admin:!1,mandatory_tags:[],has_avatar:!1,max_storage:0}},reload(s=()=>{this.database.clear()},t=()=>{},e=()=>{}){s();function a(i){i.database.init().then(o=>{t()},o=>{e(o)})}a(this)}}}),H=Ee("settings",{state:()=>({__encKey:(()=>{const s=localStorage.getItem("encKey");return s?(localStorage.removeItem("encKey"),rt("encKey",s,1),s):an("encKey")})(),__showTagPanel:(localStorage.getItem("showTagPanel")||"true")==="true",__show3DScatterPlot:(localStorage.getItem("show3DScatterPlot")||"false")==="true",__readerLayoutType:localStorage.getItem("readerLayoutType")||"2",__numItemsPerPage:localStorage.getItem("numItemsPerPage")||"50",__backendHost:sessionStorage.getItem("backendUrl")||sn(),__backendPort:sessionStorage.getItem("backendPort")||on(),loggedIn:!1}),getters:{encKey(){return this.__encKey},backendHost(){return this.__backendHost},backendPort(){return this.__backendPort},showTagPanel(){return this.__showTagPanel},show3DScatterPlot(){return this.__show3DScatterPlot},readerLayoutType(){return parseInt(this.__readerLayoutType)},numItemsPerPage(){return parseInt(this.__numItemsPerPage)}},actions:{setEncKey(s,t=void 0){t===void 0&&(t=nn("encKey")),this.__encKey=s,rt("encKey",s,t?7:null)},setBackendHost(s){this.__backendHost=s,sessionStorage.setItem("backendUrl",s)},setBackendPort(s){this.__backendPort=s,sessionStorage.setItem("backendPort",s)},setShowTagPanel(s){this.__showTagPanel=s,localStorage.setItem("showTagPanel",s.toString())},setShow3DScatterPlot(s){this.__show3DScatterPlot=s,localStorage.setItem("show3DScatterPlot",s.toString())},setReaderLayoutType(s){this.__readerLayoutType=s.toString(),localStorage.setItem("readerLayoutType",s.toString())},setNumItemsPerPage(s){this.__numItemsPerPage=s.toString(),localStorage.setItem("numItemsPerPage",s.toString())},backend(){return`${this.backendHost}:${this.backendPort}`}}});function sn(){let s=window.location.protocol,t=window.location.hostname;return`${s}//${t}`}function on(){const s=window.location.port;return s==="1420"?"8080":s}function Ge(s,t,e){H().setEncKey(s,e),t!==null?K().user=t:K().clearUserInfo(),t?H().loggedIn=!0:H().loggedIn=!1}function rn(){Ge("",null,!0)}async function ln(){const s=G().conn,t=H().encKey;try{const e=await s.authUsr(t);return Ge(t,e,!0),e}catch(e){return console.log("settingsAuthentication failed: ",e),null}}function un(s,t){return he(s+he(t))}const cn={class:"loading-widget"},dn=L({__name:"LoadingWidget",props:{size:{default:"40px"},border_width:{default:"5px"}},setup(s){const t=s,e=A(()=>({width:t.size,height:t.size,border:t.border_width+" solid var(--color-border)",borderTopColor:"var(--color-primary)"}));return(a,i)=>(m(),y("div",cn,[n("div",{class:"loading-widget__spinner",style:Y(e.value)},null,4)]))}}),qe=q(dn,[["__scopeId","data-v-1d6933bb"]]),hn={class:"loading-popout"},pn=L({__name:"LoadingPopout",props:{text:{default:"loading"}},setup(s){const t=s;return(e,a)=>(m(),y("div",hn,[D(qe,{size:"25px"}),n("label",null,T(t.text),1)]))}}),gt=q(pn,[["__scopeId","data-v-95a13423"]]),Ne=[];class Z{static registerThemeChangeCallback(t){Ne.indexOf(t)===-1&&Ne.push(t)}static toggleDarkMode(){document.documentElement.classList.contains("light")?Z.setDarkMode(!0):document.documentElement.classList.contains("dark")?Z.setDarkMode(!1):(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,Z.setDarkMode(!0))}static isDefaultDarkMode(){return!!(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches)}static isDarkMode(){return document.documentElement.classList.contains("light")?!1:!!document.documentElement.classList.contains("dark")}static setDefaultDarkMode(){const t=localStorage.getItem("themeMode");t==="dark"?Z.setDarkMode(!0):t=="light"?Z.setDarkMode(!1):Z.isDefaultDarkMode()&&!Z.isDarkMode()&&this.setDarkMode(!0,!1)}static setDarkMode(t,e=!0){t?(document.documentElement.classList.remove("light"),document.documentElement.classList.add("dark")):(document.documentElement.classList.remove("dark"),document.documentElement.classList.add("light"));for(let a of Ne)a(t);if(e){const a=t?"dark":"light";localStorage.getItem("themeMode")!==a&&localStorage.setItem("themeMode",t?"dark":"light")}}static getThemeMode(){const t=localStorage.getItem("themeMode");return t==="dark"?"dark":t==="light"?"light":"auto"}static clear(){document.documentElement.classList.remove("dark"),document.documentElement.classList.remove("light"),this.setDefaultDarkMode(),localStorage.removeItem("themeMode")}}function lt(s,t){let e=s.parentNode;for(;e!=null;){if(e==t)return!0;e=e.parentNode}return!1}function Pe(s){if(s===null||typeof s!="object")return s;let t=Array.isArray(s)?[]:{};for(let e in s)t[e]=Pe(s[e]);return t}function _t(s,t,e=!1){if(s.length!==t.length)throw new Error("arr.length !== scores.length");const a=new Array;for(let l=0;l<s.length;l++)a.push([s[l],t[l]]);let i;e?i=a.sort((l,d)=>l[1]-d[1]):i=a.sort((l,d)=>d[1]-l[1]);const o=new Array,r=new Array;for(const l of i)o.push(l[0]),r.push(l[1]);return[o,r]}const fn=s=>(ne("data-v-719a0f48"),s=s(),ae(),s),mn={id:"popups"},vn=fn(()=>n("div",null,[n("div",{style:{"font-size":"2em","font-weight":"bold",color:"var(--color-red)"}},"Failed to connect to server"),n("div",{style:{color:"gray"}},"Maximum retry exceeded")],-1)),gn={id:"app"},_n=L({__name:"App",setup(s){const t=ge(),e=F(),a=H();t.isReady().then(()=>{if(t.currentRoute.value.query.backendPort&&H().setBackendPort(t.currentRoute.value.query.backendPort),t.currentRoute.value.query.backendHost&&H().setBackendHost(t.currentRoute.value.query.backendHost),t.currentRoute.value.query.credential&&H().setEncKey(t.currentRoute.value.query.credential,!1),window.location.hash.split("?")[0]!=="#/login"){console.log("Authenticating...");const f=()=>{a.loggedIn?a.loggedIn=!1:i()};ln().then(x=>{x||f()},()=>{f()})}});function i(){K().$reset(),F().$reset(),o.close(),t.push({path:"/login",query:{from:t.currentRoute.value.fullPath}})}te(()=>a.loggedIn,(f,x)=>{f?h():i()});const o=G().wsConn,r=w(!1),l=w(!1),d=w(window.location.hash.split("?")[0]==="#/login");t.afterEach((f,x)=>{d.value=f.path==="/login"});const g=A(()=>!r.value&&!d.value&&!l.value),u=A(()=>l.value&&!d.value);function p(){o.connect({onopenCallback:()=>{r.value=!0,l.value=!1},oncloseCallback:()=>r.value=!1,onfailedToConnectCallback:()=>l.value=!0})}setInterval(()=>{!o.isOpen()&&r.value&&!d.value&&!l.value&&(r.value=!1,p())},5e3);function h(){p(),e.reloadDatabase()}ie("add_entry",f=>{const x=K(),$=f.datapoint_summary;x.database.update($).then(()=>{console.log("DEBUG: add entry update UI"),e.updateShownData()})}),ie(["update_entry","update_note"],f=>{const x=K(),$=f.datapoint_summary;x.database.update($).then(()=>{console.log("DEBUG: update entry update UI"),e.updateShownData()})}),ie("delete_entry",f=>{const x=K(),$=f.uuid;x.database.delete($).then(()=>{console.log("DEBUG: delete entry update UI"),e.updateShownData()})}),ie(["delete_tag","update_tag"],f=>{const x=new O([f.src_tag]),$=K();(async function(){await $.database.updateTagCache();const c=$.database.getCacheByTags(x);await Promise.all(c.map(_=>_.update())),e.updateShownData(),console.log("DEBUG: update tag update UI")})()}),ie("update_user",f=>{if(f.username===K().user.username){if(f.user_info===null)throw new Error("assertion failed: User info is null");for(const x of Object.keys(K().user))x!=="enc_key"&&(K().user[x]=f.user_info[x])}});const v=()=>{window.location.reload()};return fe(()=>{Z.setDefaultDarkMode()}),(f,x)=>{const $=dt("router-view");return m(),y(j,null,[n("div",mn,[(m(!0),y(j,null,ee(Object.keys(P(e).popupValues),(S,c)=>(m(),V(ot,{key:c,styleType:P(e).popupValues[S].styleType,style:Y({transform:`translate(-50%, ${-50+110*c}%) scale(0.9)`})},{default:E(()=>[B(T(P(e).popupValues[S].content),1)]),_:2},1032,["styleType","style"]))),128))]),g.value?(m(),V(gt,{key:0,text:"connecting..."})):R("",!0),u.value?(m(),V(ot,{key:1,styleType:"info",position:"center"},{default:E(()=>[n("div",{style:{display:"flex","flex-direction":"column","align-items":"center",margin:"10px"}},[vn,n("div",{style:{"font-size":"1.2em","margin-top":"10px"}},[B(" Please check if the server is running, make sure your network is working properly, and try to "),n("a",{style:{"text-decoration":"underline",cursor:"pointer"},onClick:v},"reload the page"),B(". ")])])]),_:1})):R("",!0),n("div",gn,[D($,null,{default:E(({Component:S})=>[(m(),V(Lt,{exclude:"Reader"},[(m(),V(Mt(S)))],1024))]),_:1})])],64)}}}),yn=q(_n,[["__scopeId","data-v-719a0f48"]]),wn={for:"chk"},bn={id:"checkCircle"},kn={key:0,id:"checkStatus"},$n=L({__name:"Toggle",props:{checked:{type:Boolean},identifier:{default:""}},emits:["onCheck"],setup(s,{emit:t}){const e=t,a=s;function i(o){e("onCheck",a.identifier)}return(o,r)=>(m(),y("div",{class:"toggle",onClick:i},[n("label",wn,[pe(o.$slots,"default",{},void 0,!0)]),n("div",bn,[o.checked?(m(),y("div",kn)):R("",!0)])]))}}),ye=q($n,[["__scopeId","data-v-582ee950"]]),Sn={class:"toggleText"},xn={class:"children slideInDown"},Cn=L({__name:"TagCollapsibleToggle",props:{tagStatus:{},identifier:{default:""},children:{}},emits:["update:tagStatus"],setup(s,{emit:t}){const e=s,a=t,i=A({get:()=>e.tagStatus,set:f=>a("update:tagStatus",f)}),o=A(()=>{let f="collapseButton";return Object.keys(e.children).length!==0&&(f+=" collapsible"),f}),r=w(null),l=A(()=>!e.tagStatus.unfolded.has(e.identifier)),d=A(()=>l.value?"triangle-right":"triangle-down rotate90in");function g(f){let x=i.value.unfolded;x.has(e.identifier)?x.delete(e.identifier):x.add(e.identifier)}const u=A(()=>e.tagStatus.checked.has(e.identifier));function p(f){if(f===void 0)return;let x=i.value.checked;x.has(f)?x.delete(f):x.add(f)}const h=w(null),v=f=>{f.button===2&&(g(),f.preventDefault())};return ht(()=>{var f;(f=h.value)==null||f.addEventListener("contextmenu",v)}),pt(()=>{var f;(f=h.value)==null||f.removeEventListener("contextmenu",v)}),(f,x)=>(m(),y(j,null,[n("div",{class:"row",ref_key:"rowDiv",ref:h},[n("div",{id:"button",class:ue(o.value),ref_key:"button",ref:r,onClick:g},[Object.keys(e.children).length!==0?(m(),y("div",{key:0,class:ue(d.value)},null,2)):R("",!0)],2),n("div",Sn,[D(ye,{checked:u.value,identifier:e.identifier,onOnCheck:p},{default:E(()=>[pe(f.$slots,"default",{},void 0,!0)]),_:3},8,["checked","identifier"])])],512),N(n("div",xn,[(m(!0),y(j,null,ee(f.children,($,S)=>(m(),V(yt,{identifier:String(S),children:$,"tag-status":i.value,"onUpdate:tagStatus":x[0]||(x[0]=c=>i.value=c)},{default:E(()=>[B(T(String(S).split(P(le)).slice(-1)[0]),1)]),_:2},1032,["identifier","children","tag-status"]))),256))],512),[[je,!l.value]])],64))}}),yt=q(Cn,[["__scopeId","data-v-505f8e28"]]),Dn={id:"tagSelector-main",class:"hover-scrollable"},Pn=L({__name:"TagSelector",props:{tagStatus:{}},emits:["update:tagStatus"],setup(s,{emit:t}){const e=s,a=t,i=A(()=>Se.tagHierarchy(e.tagStatus.all)),o=A(()=>Object.keys(i.value).sort()),r=A({get:()=>e.tagStatus,set:l=>a("update:tagStatus",l)});return(l,d)=>(m(),y("div",Dn,[(m(!0),y(j,null,ee(o.value,g=>(m(),V(yt,{identifier:String(g),children:i.value[g],tagStatus:r.value,"onUpdate:tagStatus":d[0]||(d[0]=u=>r.value=u)},{default:E(()=>[B(T(String(g).split(P(le)).slice(-1)[0]),1)]),_:2},1032,["identifier","children","tagStatus"]))),256))]))}}),wt=q(Pn,[["__scopeId","data-v-5557e59e"]]),In={key:0,class:"prefix"},Tn=L({__name:"TagBubble",props:{tag:{},tStyle:{default:""}},emits:["click"],setup(s,{emit:t}){const e=s,a=t,i=A(()=>{const o=e.tag.split(le);return o.length==1?["",o[0]]:[o.slice(0,o.length-1).join("·"),o[o.length-1]]});return(o,r)=>(m(),y("div",{class:ue(`bubble${o.tStyle?" "+o.tStyle:""}`),onClick:r[0]||(r[0]=()=>a("click"))},[i.value[0]?(m(),y("div",In,T(i.value[0]),1)):R("",!0),B(" "+T(i.value[1]),1)],2))}}),Un=q(Tn,[["__scopeId","data-v-f454bc70"]]),An=L({__name:"TagBubbleContainer",props:{tags:{},highlightTags:{default:null},mutedTags:{default:null},maxWidth:{default:null},middleAlign:{type:Boolean,default:!1}},emits:["clickOnBubble"],setup(s,{emit:t}){const e=s,a=t,i=A(()=>{const o={};for(const r of e.tags)e.highlightTags&&e.highlightTags.has(r)?o[r]="highlight":e.mutedTags&&e.mutedTags.has(r)?o[r]="muted":o[r]="";return o});return(o,r)=>(m(),y("div",{id:"bubbleContainer",style:Y({maxWidth:`${(e.maxWidth?e.maxWidth:999)-10}px`,justifyContent:e.middleAlign?"center":"flex-start"})},[(m(!0),y(j,null,ee(e.tags,l=>(m(),V(Un,{onClick:()=>a("clickOnBubble",l),tag:l,"t-style":i.value[l]},null,8,["onClick","tag","t-style"]))),256))],4))}}),bt=q(An,[["__scopeId","data-v-62e107cd"]]),Je=s=>(ne("data-v-86105994"),s=s(),ae(),s),Mn=Je(()=>n("h3",{class:"green"},"Tags",-1)),Ln=Je(()=>n("hr",null,null,-1)),Bn=Je(()=>n("hr",null,null,-1)),Rn=L({__name:"FileTags",emits:["onCheck"],setup(s,{emit:t}){const e=t,a=F(),i=K(),o=w(null),r=w(null);te(()=>a.unfoldedDataUIDs,()=>{a.unfoldedDataUIDs.length==0?r.value=null:a.shownDataUIDs.includes(a.unfoldedDataUIDs[0])&&i.database.aget(a.unfoldedDataUIDs[0]).then(h=>{r.value=h})});const l=A(()=>r.value==null?null:a.tagStatus.checked.withChildsFrom(r.value.tags)),d=A(()=>{const h=a.tagStatus.checked.copy();return r.value!==null&&h.pop_ifcontains_(r.value.tags),h});function g(){a.tagStatus.checked=new O,a.updateShownData()}te(a.tagStatus,()=>e("onCheck",a.tagStatus),{deep:!0});function u(){const h=prompt("Old tag");if(h&&i.database.allTags().has(h)){const v=prompt("New tag");v&&G().conn.renameTag(h,v).then(()=>{a.showPopup("Tag renamed","success")},()=>{a.showPopup("Failed to rename tag","error")})}else a.showPopup("Invalid tag","warning")}function p(){const h=prompt("Tag to delete");if(h&&i.database.allTags().has(h)){if(!confirm(`Are you sure to delete tag "${h}"?`))return;G().conn.deleteTag(h).then(()=>{a.showPopup("Tag deleted","success")},()=>{a.showPopup("Failed to delete tag","error")})}else a.showPopup("Invalid tag","warning")}return(h,v)=>(m(),y("div",{id:"file-tags-main",ref_key:"ftPanel",ref:o},[n("div",{class:"title"},[n("div",{id:"title-title"},[Mn,n("div",{id:"title-buttons"},[n("div",{class:"button",onClick:u},"rename"),n("div",{class:"button",onClick:p},"delete")])]),Ln]),D(wt,{onOnCheck:v[0]||(v[0]=f=>e("onCheck",f)),tagStatus:P(a).tagStatus,"onUpdate:tagStatus":v[1]||(v[1]=f=>P(a).tagStatus=f)},null,8,["tagStatus"]),Bn,D(bt,{onClickOnBubble:v[2]||(v[2]=f=>{P(a).tagStatus.checked.has(f)?P(a).tagStatus.checked.delete(f):P(a).tagStatus.checked.add(f),P(a).updateShownData()}),tags:r.value?r.value.tags:P(a).tagStatus.checked,"highlight-tags":l.value,"muted-tags":d.value,"max-width":o.value?o.value.clientWidth:null},null,8,["tags","highlight-tags","muted-tags","max-width"]),n("div",{class:"buttons"},[n("button",{id:"btnClear",class:"green",onClick:g},"CLEAR SELECTION")])],512))}}),En=q(Rn,[["__scopeId","data-v-86105994"]]),qn="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M240-80q-50%200-85-35t-35-85v-120h120v-560h600v680q0%2050-35%2085t-85%2035H240Zm480-80q17%200%2028.5-11.5T760-200v-600H320v480h360v120q0%2017%2011.5%2028.5T720-160ZM360-600v-80h360v80H360Zm0%20120v-80h360v80H360ZM240-160h360v-80H200v40q0%2017%2011.5%2028.5T240-160Zm0%200h-40%20400-360Z'/%3e%3c/svg%3e",Qe="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M480%20856q-115%200-197.5-82.5T200%20576q0-115%2082.5-197.5T480%20296q115%200%20197.5%2082.5T760%20576q0%20115-82.5%20197.5T480%20856Z'/%3e%3c/svg%3e",On="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M331%20625h37v-83h48q15.725%200%2026.362-10.638Q453%20520.725%20453%20505v-48q0-15.725-10.638-26.362Q431.725%20420%20416%20420h-85v205Zm37-120v-48h48v48h-48Zm129%20120h84q15%200%2026-10.638%2011-10.637%2011-26.362V457q0-15.725-11-26.362Q596%20420%20581%20420h-84v205Zm37-37V457h47v131h-47Zm133%2037h37v-83h50v-37h-50v-48h50v-37h-87v205ZM260%20856q-24%200-42-18t-18-42V236q0-24%2018-42t42-18h560q24%200%2042%2018t18%2042v560q0%2024-18%2042t-42%2018H260ZM140%20976q-24%200-42-18t-18-42V296h60v620h620v60H140Z'/%3e%3c/svg%3e",Fn="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M251%20896q-88%200-149.5-61.5T40%20685q0-78%2050-137t127-71q20-97%2094-158.5T482%20257q112%200%20189%2081.5T748%20534v24q72-2%20122%2046.5T920%20727q0%2069-50%20119t-119%2050H251Z'/%3e%3c/svg%3e",zn="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M251%20896q-88%200-149.5-61.5T40%20685q0-78%2050-137t127-71q20-97%2094-158.5T482%20257q112%200%20189%2081.5T748%20534v24q72-2%20122%2046.5T920%20727q0%2069-50%20119t-119%2050H251Zm0-60h500q45%200%2077-32t32-77q0-45-32-77t-77-32h-63v-84q0-91-61-154t-149-63q-88%200-149.5%2063T267%20534h-19q-62%200-105%2043.5T100%20685q0%2063%2044%20107t107%2044Zm229-260Z'/%3e%3c/svg%3e",Hn="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M220%20976q-24%200-42-18t-18-42V236q0-24%2018-42t42-18h361l219%20219v521q0%2024-18%2042t-42%2018H220Zm331-554h189L551%20236v186Z'/%3e%3c/svg%3e",Nn="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M220%20976q-24%200-42-18t-18-42V236q0-24%2018-42t42-18h361l219%20219v521q0%2024-18%2042t-42%2018H220Zm331-554V236H220v680h520V422H551ZM220%20236v186-186%20680-680Z'/%3e%3c/svg%3e",Wn=s=>(ne("data-v-c6dbcdc2"),s=s(),ae(),s),jn={key:0,id:"window"},Kn={class:"header"},Vn=Wn(()=>n("span",{class:"close-icon"},"✕",-1)),Zn=[Vn],Gn=L({__name:"FloatingWindow",props:{title:{default:"_"},show:{type:Boolean},closeKey:{default:"Escape"},compact:{type:Boolean,default:!1},zIndex:{default:100}},emits:["close","onClose","update:show"],setup(s,{emit:t}){const e=s,a=t,i=A({get:()=>e.show,set:l=>{a("update:show",l)}});function o(){i.value=!1,a("onClose"),a("close")}function r(l){l.target===l.currentTarget&&o()}return window.addEventListener("keydown",l=>{l.key===e.closeKey&&(o(),l.preventDefault())}),(l,d)=>i.value?(m(),y("div",jn,[n("div",{id:"blocker",onClick:r,style:Y({"z-index":l.zIndex-1})},[n("div",{class:"floating-window",style:Y({"z-index":l.zIndex})},[n("div",Kn,[n("label",null,T(e.title),1),n("button",{class:"close-button",onClick:o},Zn)]),n("div",{class:"window-content scrollable",style:Y({margin:e.compact?"0px":"15px",marginTop:e.compact?"0px":"5px"})},[pe(l.$slots,"default",{},void 0,!0)],4)],4)],4)])):R("",!0)}}),xe=q(Gn,[["__scopeId","data-v-c6dbcdc2"]]),Jn={id:"query-dialog-main"},Qn={class:"content"},Yn={id:"buttons"},Xn=L({__name:"QueryDialog",props:{show:{type:Boolean},title:{default:"Query"},showCancel:{type:Boolean,default:!0},zIndex:{default:99}},emits:["update:show","onClose","onAccept","onCancel"],setup(s,{emit:t}){const e=s,a=t,i=A({get:()=>e.show,set:o=>{a("update:show",o)}});return(o,r)=>(m(),V(xe,{show:i.value,"onUpdate:show":r[2]||(r[2]=l=>i.value=l),title:o.title,compact:!0,"z-index":o.zIndex,onOnClose:r[3]||(r[3]=()=>a("onClose"))},{default:E(()=>[n("div",Jn,[n("div",Qn,[pe(o.$slots,"default",{},void 0,!0)]),n("div",Yn,[n("div",{class:"button ok-button",onClick:r[0]||(r[0]=()=>a("onAccept"))},"OK"),o.showCancel?(m(),y("div",{key:0,class:"button cancel-button last-button",onClick:r[1]||(r[1]=()=>a("onCancel"))},"Cancel")):R("",!0)])])]),_:3},8,["show","title","z-index"]))}}),we=q(Xn,[["__scopeId","data-v-81948a9f"]]),ea=s=>(ne("data-v-8779a0ab"),s=s(),ae(),s),ta={id:"tag-selector-with-entry-main"},na={style:{textAlign:"left"}},aa=ea(()=>n("label",{for:"tagSelector"},"Tags",-1)),sa={id:"tagSelector",class:"scrollable"},oa={class:"entry"},ia=L({__name:"TagSelectorWithEntry",props:{tagStatus:{},tagInputValue:{default:""}},emits:["update:tagStatus","update:tagInputValue"],setup(s,{emit:t}){const e=s,a=t,i=A({get:()=>e.tagStatus,set:d=>a("update:tagStatus",d)}),o=w(e.tagInputValue);te(()=>e.tagInputValue,d=>{o.value=d});const r=A({get:()=>o.value,set:d=>{a("update:tagInputValue",d),o.value=d}}),l=()=>{const d=r.value.trim();d!==""&&(i.value.all.add(d),i.value.checked.add(d),i.value.unfolded.union_(Se.allParentsOf(d)),r.value="")};return(d,g)=>(m(),y("div",ta,[n("div",na,[aa,n("div",sa,[D(wt,{tagStatus:i.value,"onUpdate:tagStatus":g[0]||(g[0]=u=>i.value=u)},null,8,["tagStatus"])])]),n("div",oa,[N(n("input",{type:"text",placeholder:"New tag","onUpdate:modelValue":g[1]||(g[1]=u=>r.value=u),onKeyup:Ke(l,["enter"])},null,544),[[J,r.value]]),n("button",{class:ue(`green${r.value?" to-be-confirmed":""}`),onClick:l},"ADD",2)])]))}}),ra=q(ia,[["__scopeId","data-v-8779a0ab"]]);async function la(s){const t=`https://export.arxiv.org/api/query?id_list=${s}`,a=await(await fetch(t,{method:"GET"})).text();let r=new Wt.XMLParser().parse(a).feed.entry;function l(d){return Array.isArray(d.author)?d.author.map(g=>g.name):d.author?[d.author.name]:[]}if(r){const d=r.id.split("/").pop().split("v")[0],g=r.id,u=r.title,p=r.summary,h=l(r),v=r.updated,f=r.published;return{id:d,link:g,title:u,abstract:p,authors:h,updatedTime:v,publishedTime:f}}else throw new Error("Failed to fetch paper from arxiv")}function ua(s){return`@article{${s.id},
  author = {${s.authors.join(" and ")}},
  title = {${s.title}},
  journal = {arXiv preprint arXiv:${s.id}},
  year = {${s.publishedTime.split("-")[0]}},
  abstract = {${s.abstract}}
  }`.replace(/  /g,"")}const ut=(s,{entry:t="",title:e="",authors:a=[""],year:i=new Date().getFullYear()}={})=>(t||(t=`${i}_${Math.random().toString(36).substring(7)}`),s=="article"?`@article{${t},
        author = {${a.join(" and ")}},
        title = {${e}},
        journal = {},
        year = {${i}},
        abstract = {},
        volume = {},
        number = {},
        pages = {},
        month = {},
        doi = {},
        }`.replace(/  /g,""):s=="inproceedings"?`@inproceedings{${t},
        author = {${a.join(" and ")},
        title = {${e}},
        booktitle = {},
        year = {${i}},
        abstract = {},
        editor = {},
        volume = {},
        number = {},
        series = {},
        pages = {},
        }`.replace(/  /g,""):s=="webpage"?`@misc{${t},
        title = "{${e}}",
        author = "{${a.join(" and ")}}",
        year = {${i}},
        url = "{}",
        note = "{}"
        }`.replace(/  /g,""):s=="misc"?`@misc{${t},
        author = {${a.join(" and ")}},
        title = {${e}},
        year = {${i}},
        url = {},
        }`.replace(/  /g,""):"");class We{static async fromArxiv(t){let e=t.toLowerCase();e.startsWith("arxiv:")?e=e.split("arxiv:")[1]:e.includes("arxiv.org/abs/")?e=e.split("arxiv.org/abs/")[1]:e.includes("arxiv.org/pdf/")&&(e=e.split("arxiv.org/pdf/")[1].split(".pdf")[0]);const a=await la(e);return{bibtex:ua(a),url:a.link}}static async fromWebpage(t){var d;const a=await(await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(t)}`)).text(),r=(d=new DOMParser().parseFromString(a,"text/html").querySelector("title"))==null?void 0:d.innerText;return{bibtex:`@misc{${t},
            author = {},
            title = {${r}},
            url = {${t}},
            year = {${new Date().getFullYear()}},
            }`.replace(/  /g,""),url:t}}static async fromDoi(t){const e=`https://api.crossref.org/works/${t}/transform/application/x-bibtex`;return{bibtex:await(await fetch(e,{method:"GET"})).text(),url:`https://doi.org/${t}`}}}const ca={key:0,id:"arrow"},da=["onKeydown","onClick"],ha=L({__name:"Menu",props:{show:{type:Boolean},menuItems:{},position:{},blocker:{type:Boolean,default:!1},middleTop:{type:Boolean,default:!1},zIndex:{default:100},arrow:{type:Boolean,default:!1}},emits:["update:show"],setup(s,{emit:t}){const e=s,a=t,i=A({get:()=>e.show,set:r=>{a("update:show",r)}});function o(){i.value=!1}return(r,l)=>(m(),y(j,null,[r.blocker?(m(),y("div",{key:0,id:"blocker",onClick:o,style:Y({zIndex:e.zIndex-1})},null,4)):R("",!0),n("div",{id:"floatingMenu",style:Y({left:e.position.x+"px",top:e.position.y+"px",visibility:i.value?"visible":"hidden",transform:e.middleTop?"translate(-50%, 0)":"",zIndex:e.zIndex})},[e.arrow?(m(),y("div",ca)):R("",!0),(m(!0),y(j,null,ee(e.menuItems,(d,g)=>(m(),y("div",{class:ue(`non-selectable floatingMenuItem${g!==e.menuItems.length-1?"":" floatingMenuItemLast"}`),tabindex:"0",onKeydown:Ke(u=>{d.action(),o()},["enter"]),onClick:u=>{d.action(),o()}},T(d.name),43,da))),256))],4)],64))}}),pa=q(ha,[["__scopeId","data-v-c6b659c7"]]),be=L({name:"file-select-button",props:{asLink:{type:Boolean,default:!1},text:{type:String,default:"Upload"},action:{type:Function,required:!0},style:{type:Object,default:()=>({})}},setup(s,t){const e=w(null),a=o=>{const r=o.target;if(r.files&&r.files.length>0){const l=r.files[0];s.action(l)}};function i(){e.value.click()}return t.expose({click:i}),()=>D(j,null,[D("input",{type:"file",id:"upload-file",onChange:a,ref:e,style:{display:"none"}},null),s.asLink?D("a",{class:"btn upload-btn",rel:"noopener noreferrer",onClick:()=>e.value.click(),style:s.style},[s.text]):D("button",{type:"button",class:"btn upload-btn",onClick:()=>e.value.click(),style:s.style},[s.text])])}}),Ye=L({name:"editable-paragraph",props:{contentEditable:{type:Boolean,default:!0},style:{type:Object,default:()=>({})}},emits:["finish","change"],setup(s,t){const e=w(null),a=h=>{e.value.innerText=h},i=h=>{e.value.contentEditable=h.toString()},o=h=>e.value.contains(h),r=function(){return document.activeElement===e.value},l=A({get(){return e.value.innerText},set(h){e.value.innerText=h}});t.expose({setText:a,setEditable:i,contains:o,innerText:l,hasFocus:r});const d=()=>{t.emit("change",e.value.innerText)},g=()=>{t.emit("finish",e.value.innerText)},u=h=>{if(h.key==="Enter")if(h.ctrlKey||h.metaKey){h.preventDefault();const v=window.getSelection(),f=v==null?void 0:v.getRangeAt(0);if(f){const x=document.createElement("br");f.insertNode(x),f.setStartAfter(x),f.setEndAfter(x),v==null||v.removeAllRanges(),v==null||v.addRange(f)}}else e.value.blur()},p=h=>{var f;h.preventDefault();const v=(f=h.clipboardData)==null?void 0:f.getData("text/plain");document.execCommand("insertText",!1,v)};return()=>D("p",{class:"editable-paragraph",contenteditable:s.contentEditable,ref:e,onInput:d,onBlur:g,onKeydown:u,style:s.style,onPaste:p},[t.slots.default&&t.slots.default()])}}),kt=L({name:"menu-attached",props:{menuItems:{type:Array,required:!0}},setup(s,t){const e=w(!1),a=w(null),i=w({x:0,y:0});return te(e,o=>{if(o){const r=a.value.getBoundingClientRect();i.value={x:r.left+r.width/2,y:r.bottom+5}}else i.value={x:0,y:0}}),()=>D("div",null,[D("div",{ref:a,onClick:()=>e.value=!e.value,onKeydown:o=>{o.key==="Enter"&&(o.preventDefault(),e.value=!e.value)}},[t.slots.default&&t.slots.default()]),D(pa,{show:e.value,"onUpdate:show":o=>e.value=o,menuItems:s.menuItems,position:i.value,middleTop:!0,arrow:!0},null)])}}),fa=L({name:"CircularImage",props:{href:{type:String,required:!0},size:{type:String,required:!0},alt:{type:String,default:""}},emits:["click"],setup(s,t){const e={width:`${s.size}`,height:`${s.size}`,borderRadius:"50%",border:"1px solid var(--color-border)",overflow:"hidden"};return()=>D("img",{src:s.href,alt:s.alt,style:e,onClick:()=>t.emit("click")},null)}});function ct(s){function t(u,p){var v;const h=(v=u.split(".").pop())==null?void 0:v.toLowerCase();for(const f of p)if(h===f)return!0;return!1}function e(u){return!!(u.type.startsWith("image/")||t(u.name,["jpg","jpeg","png","gif","bmp","svg","webp"]))}function a(u){return!!(u.type==="application/pdf"||t(u.name,["pdf"]))}function i(u){return!!(u.type==="text/html"||t(u.name,["html"]))}function o(u){return!!(u.type==="text/plain"||t(u.name,["txt","bib","bibtex","nbib","enw","ris"]))}function r(u){return!!(a(u)||i(u)||e(u))}const l=[],d=[],g=[];for(let u=0;u<s.length;u++)o(s[u])?l.push(s[u]):r(s[u])?d.push(s[u]):g.push(s[u]);return{citation:l,document:d,unknown:g}}const me=s=>(ne("data-v-c574aaf8"),s=s(),ae(),s),ma={style:{display:"flex",flexDirection:"column",gap:"10px",padding:"10px",width:"100%",height:"100%"}},va={style:{margin:"10px"}},ga=me(()=>n("legend",null,"Source",-1)),_a={class:"bibsource-container"},ya=me(()=>n("legend",{for:"bibsource-arxiv"},"arxiv",-1)),wa={class:"bibsource-container"},ba=me(()=>n("legend",{for:"bibsource-doi"},"doi",-1)),ka={class:"bibsource-container"},$a=me(()=>n("legend",{for:"bibsource-webpage"},"webpage",-1)),Sa=["placeholder"],xa={key:0},Ca={id:"inputDiv"},Da={id:"inputLeft"},Pa={id:"bibtexArea"},Ia={class:"horizontal"},Ta=me(()=>n("label",{for:"bibtex"},"Bibtex",-1)),Ua={id:"bibtexSource",class:"horizontal"},Aa={id:"urlArea"},Ma=me(()=>n("label",{for:"url"},"URL: ",-1)),La={id:"inputRight"},Ba={key:0,style:{display:"flex","justify-content":"center","align-items":"center","padding-inline":"15px"}},Ra=me(()=>n("div",{class:"hr"},null,-1)),Ea={style:{"margin-top":"5px","text-wrap":"nowrap","white-space":"nowrap","margin-inline":"5px"}},qa=me(()=>n("div",{class:"hr"},null,-1)),Oa={key:1},Fa=me(()=>n("div",{style:{display:"flex","flex-direction":"column","align-items":"center","justify-content":"center",height:"430px",width:"590px",border:"5px dashed var(--color-border)","border-radius":"10px",margin:"15px"}},[n("div",{style:{"font-size":"20px","font-weight":"bold","margin-bottom":"10px"}},"Drop to insert citation or document"),n("div",{style:{"font-size":"12px",opacity:"0.5"}},"(only support bibtex/enw/nbib)")],-1)),za=[Fa],Ha=L({__name:"DataEditor",setup(s,{expose:t}){const e=F(),a=G().conn,i=w(!1),o=w(null),r=w(""),l=w(""),d=w(null),g=w({all:new O,checked:new O,unfolded:new O});function u(){const z={uuid:o.value?o.value.summary.uuid:null,bibtex:r.value,tags:Array.from(g.value.checked),url:l.value,file:d.value};v(),e.showPopup("Saving entry...","info"),a.updateDatapoint(z.uuid,z.bibtex,z.tags,z.url).then(U=>{z.file?(e.showPopup("Uploading document...","info"),a.uploadDocument(U.uuid,z.file).then(M=>{e.showPopup("Saved","success")},()=>e.showPopup("Failed to upload document","error"))):e.showPopup("Saved","success")},()=>e.showPopup("Failed to save","error"))}const p=w("");function h({datapoint:z=null,bibtex:U=null,url:M=null,tags:oe=null}){e.dataEditorOpened||(e.dataEditorOpened=!0,z!==null&&(o.value=z,r.value=z.summary.bibtex,l.value=z.summary.url,oe===null&&(oe=new O(z.summary.tags))),U!==null&&(r.value=U),M!==null&&(l.value=M),oe!==null?(Array.isArray(oe)&&(oe=new O(oe)),g.value={all:new O(e.tagStatus.all).union(oe),checked:oe,unfolded:oe.allParents()}):g.value={all:new O(e.tagStatus.all),checked:new O(e.tagStatus.checked),unfolded:new O(e.tagStatus.unfolded)},i.value=!0)}function v(){i.value=!1,o.value=null,r.value="",l.value="",g.value={all:new O(e.tagStatus.all),checked:new O(e.tagStatus.checked),unfolded:new O(e.tagStatus.unfolded)},d.value=null,p.value="",de.value=!1,e.dataEditorOpened=!1}function f(){return i.value}function x(z){if(o.value)return e.showPopup("Document can only be added to new entry","error"),!1;if(!ct([z]).document)return e.showPopup("Unsupported file","error"),!1;if(d.value=z,console.log("file selected"),r.value.trim().length===0){console.log("try to extract bibtex from file");const U=z.name,M=z.lastModified,oe=ut(c.value,{title:U,year:new Date(M).getFullYear()});r.value=oe}return!0}function $(z){let U=!1;if(!z||z.length===0)return U;const M=ct(z);if((M.citation.length>1||M.document.length>1)&&e.showPopup("Only one citation and one document are allowed","error"),M.citation.length==0&&M.document.length==0&&(console.log("[Error] Got files: ",z),e.showPopup("Unsupported file type","error")),M.citation.length>0){const oe=M.citation[0];if(oe.size<64*1024){const tt=new FileReader;tt.onload=Pt=>{var nt;const It=(nt=Pt.target)==null?void 0:nt.result;r.value=It},tt.readAsText(oe),U=!0}else e.showPopup("Text file too large","error")}return M.document.length>0&&(U=x(M.document[0])),U}t({show:h,close:v,isShown:f,loadFiles:$});const S=w(!1),c=w("article"),_=A(()=>ut(c.value)),C=w(!1),k=w("arxiv"),b={arxiv:z=>We.fromArxiv(z),doi:z=>We.fromDoi(z),webpage:z=>We.fromWebpage(z)},I={arxiv:"e.g. 2106.00001",doi:"e.g. 10.1145/344779.344937",webpage:"e.g. https://news.mit.edu/2021/xxx"},W=w("");function se(z){e.showPopup("Fetching from BibTeX source...","info"),C.value=!1,W.value="",b[k.value](z).then(U=>{e.showPopup("Obtained bibtex from source","success"),r.value=U.bibtex,l.value=U.url},()=>{e.showPopup("Failed to fetch from source","error")})}const de=w(!1),Fe=w(null),Le=z=>{z.preventDefault(),de.value=!0},$e=z=>{z.preventDefault(),de.value=!1},_e=z=>{var M;z.preventDefault();const U=(M=z.dataTransfer)==null?void 0:M.files;U&&$(U),de.value=!1};return(z,U)=>(m(),y(j,null,[D(we,{show:S.value,"onUpdate:show":U[4]||(U[4]=M=>S.value=M),onOnAccept:U[5]||(U[5]=()=>{r.value=_.value,S.value=!1}),onOnCancel:U[6]||(U[6]=M=>S.value=!1),"z-index":102,title:"Select template"},{default:E(()=>[n("div",ma,[D(ye,{onOnCheck:U[0]||(U[0]=M=>c.value="article"),checked:c.value=="article"},{default:E(()=>[B("Article")]),_:1},8,["checked"]),D(ye,{onOnCheck:U[1]||(U[1]=M=>c.value="inproceedings"),checked:c.value=="inproceedings"},{default:E(()=>[B("Inproceedings")]),_:1},8,["checked"]),D(ye,{onOnCheck:U[2]||(U[2]=M=>c.value="webpage"),checked:c.value=="webpage"},{default:E(()=>[B("Webpage")]),_:1},8,["checked"]),D(ye,{onOnCheck:U[3]||(U[3]=M=>c.value="misc"),checked:c.value=="misc"},{default:E(()=>[B("Misc")]),_:1},8,["checked"])])]),_:1},8,["show"]),D(we,{show:C.value,"onUpdate:show":U[11]||(U[11]=M=>C.value=M),onOnCancel:U[12]||(U[12]=M=>C.value=!1),onOnAccept:U[13]||(U[13]=()=>{se(W.value)}),"z-index":102,title:"Source input"},{default:E(()=>[n("div",va,[n("fieldset",{style:Y({display:"flex",flexDirection:"row",gap:"10px",border:"1px solid var(--color-border)"})},[ga,n("div",_a,[N(n("input",{type:"radio",id:"bibsource-arxiv",name:"bibSource",value:"arxiv","onUpdate:modelValue":U[7]||(U[7]=M=>k.value=M)},null,512),[[ze,k.value]]),ya]),n("div",wa,[N(n("input",{type:"radio",id:"bibsource-doi",name:"bibSource",value:"doi","onUpdate:modelValue":U[8]||(U[8]=M=>k.value=M)},null,512),[[ze,k.value]]),ba]),n("div",ka,[N(n("input",{type:"radio",id:"bibsource-webpage",name:"bibSource",value:"webpage","onUpdate:modelValue":U[9]||(U[9]=M=>k.value=M)},null,512),[[ze,k.value]]),$a])],4),N(n("input",{type:"text","onUpdate:modelValue":U[10]||(U[10]=M=>W.value=M),placeholder:I[k.value],style:{width:"100%",marginTop:"10px"}},null,8,Sa),[[J,W.value]])])]),_:1},8,["show"]),D(we,{show:i.value,"onUpdate:show":U[21]||(U[21]=M=>i.value=M),title:o.value?o.value.authorAbbr():"new","show-cancel":!1,onOnAccept:u,onOnCance:v,onOnClose:v},{default:E(()=>[n("div",{id:"data-editor-main",ref_key:"dataEditorComponent",ref:Fe,onDragover:Le,onDrop:_e,onDragend:$e},[de.value?(m(),y("div",Oa,za)):(m(),y("div",xa,[n("div",Ca,[n("div",Da,[n("div",Pa,[n("div",Ia,[Ta,n("div",Ua,[n("div",{class:"button",onClick:U[14]||(U[14]=M=>S.value=!0)},"template"),n("div",{class:"button",onClick:U[15]||(U[15]=M=>C.value=!0)},"from-source")])]),N(n("textarea",{id:"bibtex","onUpdate:modelValue":U[16]||(U[16]=M=>r.value=M),placeholder:"bibtex / enw / nbib",class:"scrollable wrapword",style:{resize:"none"}},null,512),[[J,r.value]])]),n("div",Aa,[Ma,N(n("input",{id:"url","onUpdate:modelValue":U[17]||(U[17]=M=>l.value=M),placeholder:"url",type:"text"},null,512),[[J,l.value]])])]),n("div",La,[D(ra,{"tag-status":g.value,"onUpdate:tagStatus":U[18]||(U[18]=M=>g.value=M),"tag-input-value":p.value,"onUpdate:tagInputValue":U[19]||(U[19]=M=>p.value=M)},null,8,["tag-status","tag-input-value"])])]),o.value===null?(m(),y("div",Ba,[Ra,n("div",Ea,[B(T(d.value?d.value.name:"")+" ",1),d.value?(m(),y("a",{key:1,onClick:U[20]||(U[20]=M=>d.value=null),style:{cursor:"pointer",padding:"3px","border-radius":"5px"}}," (Remove) ")):(m(),V(P(be),{key:0,text:"Select document",action:x,"as-link":!0,style:{cursor:"pointer",padding:"3px","border-radius":"5px"}}))]),qa])):R("",!0)]))],544)]),_:1},8,["show","title"])],64))}}),Xe=q(Ha,[["__scopeId","data-v-c574aaf8"]]),ke=s=>(ne("data-v-7b94ae74"),s=s(),ae(),s),Na={class:"layout"},Wa={id:"info"},ja=ke(()=>n("td",null,[n("b",null,"Authors")],-1)),Ka={id:"authorTD"},Va=["onClick"],Za={key:0,id:"otherPubTR"},Ga={colspan:"2"},Ja={id:"authorPapers"},Qa=ke(()=>n("td",null,[n("b",null,"Publication")],-1)),Ya=ke(()=>n("td",null,[n("b",null,"Year")],-1)),Xa=ke(()=>n("td",null,[n("b",null,"Tags")],-1)),es=ke(()=>n("td",null,[n("b",null,"Type")],-1)),ts={id:"shortSummary"},ns={id:"shortSummaryTitle"},as=ke(()=>n("b",null,"AI Summary",-1)),ss=ke(()=>n("summary",null,[n("b",null,"Related Articles")],-1)),os=L({__name:"DataSummary",props:{datapoint:{}},setup(s){const t=s,e=K(),a=w([]),i=w([]),o=A(()=>Object.fromEntries(a.value.map((c,_)=>[c.summary.uuid,i.value[_].toPrecision(3)]))),r=G().conn,l=w(null),d=w("");function g(c=!1){d.value="Loading...";let _="";r.reqAISummary(t.datapoint.summary.uuid,C=>{C.replace(/\\n/g,"<br>"),_+=C,d.value=_},()=>{u(),console.log("finished")},c)}async function u(){let c=null;if(t.datapoint.supp.abstract?c=t.datapoint.supp.abstract:c=await t.datapoint.fetchAbstract(),!c)if(d.value&&!d.value.startsWith("Error")&&!d.value.startsWith("Loading"))c=d.value;else throw new Error("No content to search for related articles");if(c=="")return;const _=await r.search("searchFeature",{pattern:c,n_return:9}),C=await e.database.agetMany(Object.keys(_),!1),k=new Array;for(const b of C)if(_[b.summary.uuid]){const I=_[b.summary.uuid].score;k.push(I)}[a.value,i.value]=_t(C,k,!1),a.value&&a.value[0].summary.uuid==t.datapoint.summary.uuid&&(a.value.shift(),i.value.shift())}const p=w(""),h=w([]),v=w({});async function f(){const c=t.datapoint.authors,_=await Promise.all(c.map(C=>e.database.agetByAuthor(C)));v.value={};for(let C=0;C<c.length;C++)v.value[c[C]]=_[C]}const x=A(()=>{const c={};for(const _ in v.value)v.value[_]&&v.value[_].length>1?c[_]=v.value[_].length-1:c[_]=null;return c});function $(c){h.value=v.value[c],h.value||(h.value=[]),h.value=h.value.filter(_=>_.summary.uuid!=t.datapoint.summary.uuid),p.value===c?p.value="":p.value=c}fe(()=>{f(),g(!1)});const S=A(()=>{const b=(Math.min(Math.max(window.innerWidth-600,0)/1800,1)-.5)*Math.PI,I=(Math.sin(b)+1)*.5*1200,W=Math.round(I);return`${window.innerWidth-W}px`});return(c,_)=>(m(),y("div",{id:"main",style:Y({width:S.value})},[n("h2",null,T(c.datapoint.summary.title),1),n("div",Na,[n("div",Wa,[n("table",null,[n("tr",null,[ja,n("td",Ka,[(m(!0),y(j,null,ee(c.datapoint.summary.authors,C=>(m(),y("div",null,[n("span",null,T(C),1),x.value[C]!==null?(m(),y("a",{key:0,onClick:()=>$(C)}," ("+T(x.value[C])+") ",9,Va)):R("",!0)]))),256))])]),D(Ie,{name:"slideDown"},{default:E(()=>[p.value?(m(),y("tr",Za,[n("td",Ga,[n("b",null,T(`Other publications from ${p.value.toUpperCase()}:`),1),n("div",Ja,[D(Te,{uids:h.value.map(C=>C.summary.uuid)},null,8,["uids"])])])])):R("",!0)]),_:1}),n("tr",null,[Qa,n("td",null,T(c.datapoint.summary.publication),1)]),n("tr",null,[Ya,n("td",null,T(c.datapoint.summary.year),1)]),n("tr",null,[Xa,n("td",null,T(c.datapoint.summary.tags.toString()),1)]),n("tr",null,[es,n("td",null,T(c.datapoint.docType()+`${c.datapoint.summary.has_file?" ("+c.datapoint.summary.doc_size.toString()+"M)":""}`),1)])])]),n("div",ts,[n("div",ns,[as,n("div",{class:"button",onClick:_[0]||(_[0]=C=>g(!0))},"↻")]),n("p",{id:"aiSummary",ref_key:"aiSummaryParagraph",ref:l},T(d.value),513)]),n("details",null,[ss,D(Te,{uids:a.value.map(C=>C.summary.uuid),scores:o.value},null,8,["uids","scores"])])])],4))}}),is=q(os,[["__scopeId","data-v-7b94ae74"]]),rs=s=>(ne("data-v-b4af7028"),s=s(),ae(),s),ls={id:"citations",style:{textAlign:"left"}},us=["onClick"],cs={class:"citation-text",style:{overflowX:"hidden",whiteSpace:"nowrap"}},ds={key:0},hs={key:0,id:"moreMain"},ps={class:"row",id:"buttons"},fs=["href"],ms={key:0,class:"row",id:"actions"},vs={id:"abstract"},gs=rs(()=>n("summary",null,"Abstract",-1)),_s=L({__name:"FileRowMore",props:{datapoint:{},show:{type:Boolean}},setup(s,{expose:t}){const e=s,a=F(),i=w(null),o=async c=>{c.target instanceof HTMLDetailsElement&&!c.target.open||(i.value.setEditable(!1),i.value.innerText="Loading...",e.datapoint.fetchAbstract().then(_=>{i.value.innerText=_,i.value.setEditable(!0)},()=>{i.value.innerText="Failed to load abstract."}))},r=async c=>{c&&(await e.datapoint.uploadAbstract(c),await e.datapoint.update())},l=w(!1);function d(c,_){return[c,`${_.length>80?_.slice(0,80)+"...":_}`,_]}function g(c){Ze(c).then(_=>{_?a.showPopup("Copied to clipboard.","info"):a.showPopup("Failed to copy to clipboard.","error")})}const u=w(!1);function p(c){a.showPopup("uploading..."),e.datapoint.uploadDocument(c).then(_=>{e.datapoint.update(_),a.showPopup("Document uploaded","success")},()=>a.showPopup("Failed to upload document","error"))}function h(){window.confirm(`Free document? 
${e.datapoint.toString()}`)&&e.datapoint.freeDocument().then(c=>{e.datapoint.update(c),a.showPopup("Document deleted","info")},()=>a.showPopup("Failed to free document","error"))}function v(){const c=e.datapoint.summary.uuid;window.confirm(`[IMPORTANT] Delete? 
${e.datapoint.toString()}`)&&G().conn.deleteDatapoint(c).then(_=>{a.showPopup("Deleted")})}const f=w(null);function x(){f.value.show({datapoint:e.datapoint})}const $=A(()=>i.value===null?!f.value.isShown():!f.value.isShown()&&!i.value.hasFocus());t({editThisDatapoint:x,deleteThisDatapoint:v,shouldEnableEditDatapoint:$});const S=w(!1);return(c,_)=>{const C=dt("router-link");return m(),y(j,null,[D(xe,{show:S.value,"onUpdate:show":_[0]||(_[0]=k=>S.value=k),title:"Summary"},{default:E(()=>[D(is,{datapoint:c.datapoint},null,8,["datapoint"])]),_:1},8,["show"]),D(xe,{show:l.value,"onUpdate:show":_[1]||(_[1]=k=>l.value=k),title:"Citations"},{default:E(()=>[(m(!0),y(j,null,ee([d("Title",`${c.datapoint.summary.title}`),d("Author-year",`${c.datapoint.authorAbbr()} (${c.datapoint.summary.year})`),d("APA",`${c.datapoint.authorAbbr()} (${c.datapoint.summary.year}). ${c.datapoint.summary.title}. ${c.datapoint.summary.publication}.`),d("Bibtex",c.datapoint.summary.bibtex),d("DocURL",c.datapoint.getRawDocURL()),d("Markdown",`[${c.datapoint.authorAbbr()} (${c.datapoint.summary.year})](${c.datapoint.getRawDocURL()})`),d("UUID",`${c.datapoint.summary.uuid}`)],(k,b)=>(m(),y("div",ls,[n("div",{onClick:()=>{g(k[2]),l.value=!1},style:{cursor:"pointer",display:"flex",flexDirection:"row"}},[n("div",{class:"citation-type",style:Y({marginLeft:"10px",marginRight:"10px",borderRadius:"5px",backgroundColor:"var(--color-background-mute)",padding:"3px",fontWeight:"bold",display:"flex",alignItems:"center",justifyContent:"center"})},T(k[0]),5),n("p",cs,T(k[1]),1)],8,us),b!==6?(m(),y("hr",ds)):R("",!0)]))),256))]),_:1},8,["show"]),D(Xe,{ref_key:"dataEditor",ref:f},null,512),D(Ie,{name:"expand-transition"},{default:E(()=>[c.show?(m(),y("div",hs,[n("div",ps,[D(C,{to:`/reader/${e.datapoint.summary.uuid}`},{default:E(()=>[B("Reader")]),_:1},8,["to"]),c.datapoint.url?(m(),y("a",{key:0,href:c.datapoint.getRawDocURL(),target:"_blank"},"Link",8,fs)):R("",!0),n("a",{rel:"noopener noreferrer",onClick:_[2]||(_[2]=()=>S.value=!S.value)},"Summary"),n("a",{rel:"noopener noreferrer",onClick:_[3]||(_[3]=()=>l.value=!l.value)},"Cite"),n("a",{rel:"noopener noreferrer",onClick:_[4]||(_[4]=()=>u.value=!u.value)},"Actions")]),D(Ie,{name:"actions"},{default:E(()=>[u.value?(m(),y("div",ms,[n("a",{rel:"noopener noreferrer",class:"btn",onClick:x},"Edit"),c.datapoint.summary.has_file?(m(),y("a",{key:1,rel:"noopener noreferrer",onClick:h,class:"danger btn"},"Free document")):(m(),V(P(be),{key:0,action:k=>p(k),text:"Upload document","as-link":!0},null,8,["action"])),n("a",{rel:"noopener noreferrer",onClick:v,class:"danger btn"},"Delete")])):R("",!0)]),_:1}),n("div",vs,[n("details",{onToggle:o},[gs,D(P(Ye),{id:"abstractParagraph",ref_key:"abstractParagraph",ref:i,style:{minHeight:"20px"},onFinish:_[5]||(_[5]=k=>r(k))},null,512)],32)])])):R("",!0)]),_:1})],64)}}}),ys=q(_s,[["__scopeId","data-v-b4af7028"]]),ws="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M200-120v-640q0-33%2023.5-56.5T280-840h400q33%200%2056.5%2023.5T760-760v640L480-240%20200-120Zm80-122%20200-86%20200%2086v-518H280v518Zm0-518h400-400Z'/%3e%3c/svg%3e",bs="data:image/svg+xml,%3c?xml%20version='1.0'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%20width='24px'%20height='24px'%3e%3cpath%20d='M%206%202%20C%205.861875%202%205.7278809%202.0143848%205.5976562%202.0410156%20C%204.686084%202.2274316%204%203.033125%204%204%20L%204%2022%20L%2012%2019%20L%2020%2022%20L%2020%204%20C%2020%203.8625%2019.985742%203.7275391%2019.958984%203.5976562%20C%2019.799199%202.8163086%2019.183691%202.2008008%2018.402344%202.0410156%20C%2018.272119%202.0143848%2018.138125%202%2018%202%20L%206%202%20z'/%3e%3c/svg%3e",ks={class:"left",style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"flex-start",flexWrap:"nowrap",gap:"0.25rem"}},$s={id:"marks"},Ss=["src"],xs=["src"],Cs={class:"row text"},Ds={style:{borderRadius:"10px",marginLeft:"5px",display:"flex",flexDirection:"column"}},Ps={id:"title",style:{display:"flex",fontSize:"1rem"}},Is={class:"right row"},Ts={id:"statusDiv",style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"2px"}},Us={class:"status"},As={key:0,src:qn,alt:"",class:"icon"},Ms={key:1,src:Qe,alt:"",class:"icon placeholder"},Ls={class:"status"},Bs={key:0,src:On,alt:"",class:"icon"},Rs={key:1,src:Fn,alt:"",class:"icon"},Es={key:2,src:zn,alt:"",class:"icon"},qs={key:3,src:Qe,alt:"",class:"icon placeholder"},Os={class:"status"},Fs={key:0,src:Hn,alt:"",class:"icon"},zs={key:1,src:Nn,alt:"",class:"icon"},Hs={key:2,src:Qe,alt:"",class:"icon placeholder"},Ns=12,Ws=1,js=L({__name:"FileRow",props:{datapoint:{},unfoldedIds:{},hoveredIds:{},line_number:{default:0}},emits:["update:unfoldedIds","update:hoveredIds"],setup(s,{emit:t}){const e=s,a=t,i=A({get:()=>e.unfoldedIds,set:_=>a("update:unfoldedIds",_)}),o=A({get:()=>e.hoveredIds,set:_=>a("update:hoveredIds",_)}),r=A(()=>i.value.includes(e.datapoint.summary.uuid)),l=w(null),d=w(null),g=w(null),u=w(null);let p=!1;function h(_){if(lt(_.target,l.value)){if(_.target.id=="authorYear"){const C=e.datapoint.getOpenDocURL();C!==""&&tn(C),p=!0}if(!lt(_.target,g.value)){if(p){p=!1;return}r.value?i.value=i.value.filter(C=>C!==e.datapoint.summary.uuid):i.value=[e.datapoint.summary.uuid]}}}const v=A(()=>e.datapoint.yearAuthor("-")),f=w(!1);te(f,_=>{_?o.value.push(e.datapoint.summary.uuid):o.value=o.value.filter(C=>C!==e.datapoint.summary.uuid)});const x=A(()=>f.value?"var(--color-background-theme-highlight)":i.value.includes(e.datapoint.summary.uuid)?"var(--color-background-theme)":e.line_number%2==0?"var(--color-background-ssoft)":"var(--color-background)");function $(_){const C=e.datapoint.summary.tags.slice();_?C.push("* Bookmark"):C.splice(C.indexOf("* Bookmark"),1);const k=e.datapoint.summary.uuid;G().conn.updateDatapoint(k,null,C).then(b=>{e.datapoint.update(b),F().updateShownData()},()=>F().showPopup("Failed to save","error")),p=!0}function S(){var _;return i.value.includes(e.datapoint.summary.uuid)&&f.value&&document.activeElement===document.body&&((_=u.value)==null?void 0:_.shouldEnableEditDatapoint)}function c(_){var C,k;_.code==="Space"&&S()&&((C=u.value)==null||C.editThisDatapoint(),_.preventDefault()),(_.code==="Delete"||_.code==="Backspace")&&S()&&((k=u.value)==null||k.deleteThisDatapoint(),_.preventDefault())}return te(()=>i.value,_=>{_.includes(e.datapoint.summary.uuid)?window.addEventListener("keydown",c):window.removeEventListener("keydown",c)}),(_,C)=>(m(),y("div",{id:"fileRow",class:ue(`${r.value?" unfolded":""}`),onClick:h,onMouseover:C[2]||(C[2]=k=>f.value=!0),onMouseleave:C[3]||(C[3]=k=>f.value=!1),ref_key:"dataCard",ref:l,style:Y({backgroundColor:x.value})},[n("div",{id:"init",class:"row",ref_key:"initDiv",ref:d},[n("div",ks,[n("div",$s,[_.datapoint.summary.tags.includes("* Bookmark")?(m(),y("img",{key:0,src:P(bs),alt:"",class:"icon redIcon",onClick:C[0]||(C[0]=()=>$(!1)),style:{height:"1rem"}},null,8,Ss)):(m(),y("img",{key:1,src:P(ws),alt:"",class:"icon",onClick:C[1]||(C[1]=()=>$(!0)),style:{height:"1rem"}},null,8,xs))]),n("div",Cs,[n("div",Ds,[n("div",Ps,T(_.datapoint.summary.title),1),n("div",{style:Y({marginTop:"0px",padding:"0px",color:"var(--color-text-soft)",fontSize:"0.75rem"})},T(v.value+", "+_.datapoint.publication),5)]),pe(_.$slots,"default",{},void 0,!0)])]),n("div",Is,[n("div",Ts,[n("div",Us,[_.datapoint.summary.has_abstract?(m(),y("img",As)):(m(),y("img",Ms))]),n("div",Ls,[_.datapoint.docType()=="pdf"?(m(),y("img",Bs)):_.datapoint.docType()=="html"?(m(),y("img",Rs)):_.datapoint.docType()=="url"?(m(),y("img",Es)):(m(),y("img",qs))]),n("div",Os,[_.datapoint.summary.note_linecount>Ns?(m(),y("img",Fs)):_.datapoint.summary.note_linecount>Ws?(m(),y("img",zs)):(m(),y("img",Hs))])])])],512),n("div",{id:"more",ref_key:"moreDiv",ref:g},[D(ys,{datapoint:_.datapoint,show:r.value,ref_key:"moreComponent",ref:u},null,8,["datapoint","show"])],512)],38))}}),Ks=q(js,[["__scopeId","data-v-c34c40db"]]),Vs={id:"datacard-container-main"},Zs={key:0,class:"relatedArticleScore"},Gs={key:1,id:"datacard-container-footer"},Js=["disabled"],Qs={style:{"margin-left":"10px","margin-right":"10px",display:"flex",gap:"5px"}},Ys=["disabled"],Xs=L({__name:"FileRowContainer",props:{uids:{},unfoldedIds:{default:null},hoveredIds:{default:null},scores:{default:null},compact:{type:Boolean,default:!0}},emits:["update:datapoints","update:unfoldedIds","update:hoveredIds"],setup(s,{emit:t}){const e=s,a=t,i=w([]),o=A({get:()=>e.unfoldedIds==null?i.value:e.unfoldedIds,set:c=>{e.unfoldedIds==null?i.value=c:a("update:unfoldedIds",c)}}),r=w([]),l=A({get:()=>e.hoveredIds==null?r.value:e.hoveredIds,set:c=>{e.hoveredIds==null?r.value=c:a("update:hoveredIds",c)}}),d=w(null),g=w(null),u=w(0),p=H(),h=w([]),v=w(!1);function f(){const c=u.value*p.numItemsPerPage,_=Math.min(c+p.numItemsPerPage,e.uids.length),C=e.uids.slice(c,_),k=K().database;let b=!0;(async()=>(await new Promise(I=>setTimeout(I,500)),b&&(v.value=!1)))(),k.agetMany(C).then(I=>{h.value=I,b=!1,v.value=!0})}te([()=>e.uids,()=>u.value,()=>p.numItemsPerPage],()=>{e.uids.length<u.value*p.numItemsPerPage&&(u.value=0),f()}),f();const x=()=>{var c;u.value>=Math.ceil(e.uids.length/p.numItemsPerPage)-1||(u.value++,g.value.setText(""+(u.value+1)),(c=d.value)==null||c.scrollTo({top:0,behavior:"auto"}))},$=()=>{var c;u.value!=0&&(u.value--,g.value.setText(""+(u.value+1)),(c=d.value)==null||c.scrollTo({top:0,behavior:"auto"}))},S=c=>{const _=c.target;_.scrollTop==0||_.scrollTop+_.clientHeight>=_.scrollHeight};return(c,_)=>(m(),y("div",Vs,[n("div",{id:"datacard-container",style:Y({gap:c.compact?"0px":"5px"}),ref_key:"datacardContainer",ref:d,onScroll:S,class:"scrollable"},[(m(!0),y(j,null,ee(h.value,(C,k)=>(m(),V(Ks,{datapoint:C,"unfolded-ids":o.value,"onUpdate:unfoldedIds":_[0]||(_[0]=b=>o.value=b),"hovered-ids":l.value,"onUpdate:hoveredIds":_[1]||(_[1]=b=>l.value=b),line_number:k,compact:c.compact},{default:E(()=>[e.scores!=null&&e.scores[C.summary.uuid]!=null?(m(),y("label",Zs,T(e.scores[C.summary.uuid]),1)):R("",!0)]),_:2},1032,["datapoint","unfolded-ids","hovered-ids","line_number","compact"]))),256))],36),v.value?R("",!0):(m(),V(Ie,{key:0,name:"fade"},{default:E(()=>[D(gt,{text:"Loading data..."})]),_:1})),c.uids.length>P(p).numItemsPerPage?(m(),y("div",Gs,[n("button",{onClick:$,disabled:u.value==0},"Prev",8,Js),n("span",Qs,[D(P(Ye),{ref_key:"pageIndicatorEditableParagrah",ref:g,onFinish:_[2]||(_[2]=C=>{parseInt(C)>0&&parseInt(C)<=Math.ceil(c.uids.length/P(p).numItemsPerPage)&&(u.value=parseInt(C)-1)})},{default:E(()=>[B(T(u.value+1),1)]),_:1},512),B(" / "),n("p",null,T(Math.ceil(c.uids.length/P(p).numItemsPerPage)),1)]),n("button",{onClick:x,disabled:u.value>=Math.ceil(c.uids.length/P(p).numItemsPerPage)-1},"Next",8,Ys)])):R("",!0)]))}}),Te=q(Xs,[["__scopeId","data-v-703bfd64"]]),eo=["title"],to=["src","alt"],no={for:"icon",class:"iconLabel non-selectable"},ao=L({__name:"ToolbarIcon",props:{iconSrc:{},labelText:{},title:{default:""},shortcut:{default:null}},emits:["onClick","click"],setup(s,{expose:t,emit:e}){const a=s,i=A(()=>a.title+(a.shortcut===null?"":` (${a.shortcut})`)),o=e,r=w(null);t({getBoundingClientRect:()=>{var p;return(p=r.value)==null?void 0:p.getBoundingClientRect()}});function d(){o("onClick"),o("click")}function g(p){if(p===null)return null;const h=p.toLowerCase().split("+");return v=>{h.includes("ctrl")&&!v.ctrlKey||h.includes("alt")&&!v.altKey||h.includes("shift")&&!v.shiftKey||h.includes("meta")&&!v.metaKey||h.includes(v.key.toLowerCase())&&(console.log("shortcut triggered: "+p+" | "+a.labelText),d(),v.preventDefault())}}const u=g(a.shortcut);return ht(()=>{u!==null&&window.addEventListener("keydown",u)}),pt(()=>{u!==null&&window.removeEventListener("keydown",u)}),(p,h)=>(m(),y("span",{class:"hoverMaxout105 button non-selecable",onClick:d,onKeydown:Ke(d,["enter"]),tabindex:0,title:`${i.value}`,ref_key:"button",ref:r},[n("img",{id:"icon",class:"icon",src:p.iconSrc,alt:p.labelText.toUpperCase()+"_ICON"},null,8,to),n("label",no,T(p.labelText),1)],40,eo))}}),ve=q(ao,[["__scopeId","data-v-f0fccbdf"]]);let so=window.location.protocol,$t;$t=`${so}//${window.location.hostname}:${window.location.port}`;const oo=`${$t}/docs/userManual_zh/index.html`;console.log("production mode");function Ue(){const s=H().backendPort;return`${H().backendHost}:${s}`}const io={name:"Li, Mengxun",email:"mengxunli@whu.edu.cn"},Be=["SweetiePie","CutiePatootie","CuddleBug","FluffyPaws","HoneyBee","SnuggleMuffin","SugarPlum","AngelFace","PawsomePuppy","TeddyBearHugs","PrettyKitty","LoveBug","BabyDoll","SunshineSmiles","FuzzyWuzzy","BumbleBee","CupcakeQueen","DoodleDaisy","PurrfectPaws","CuddlyKoala","SweetPea","BunnyHop","SparklePony","HappyPanda","DreamyDove","FluffyCloud","CherryBlossom","AngelicWhisper","SnickerDoodle","LuckyLadybug","BlossomButterfly","SugarCubes","CottonCandyDreams","HoneyBunches","FurryFriend","BabyBlueEyes","SweetCheeks","PawsitiveVibes","SnugglyBear","LovelyLlama","PurrfectlyAdorable","TwinkleToes","CuddleBunny","CookieCrumbs","SunnySmiles","FluffyKitten","DarlingDeer","ButterflyKisses","FuzzyWuzzyPanda","SweetDreamer","SillyGoose","DaisyDoodle","CupcakeCutie","BuzzyBee","SnoozySnail","CharmingChick","CandyCane","BerryBlossom","Dimples","CocoaCuddles","CheerfulCherub","PetalPaws","BubblyBumble","AngelWings","JollyJellybean","WhiskerWonder","SprinkleSmiles","GigglyGiraffe","DancingDaisy","SunnySideUp","SnugglySloth","CuteQuokka","PeachyPaws","BouncyBunny","DazzlingDimples","ChirpyChickadee","CandyHeart","CupcakeSprinkle","BuzzyButterfly","SnoozyPanda","CharmingCorgi","CottonCandyCloud","BerryBlush","DimpleDoll","CocoaCuddler","CheerfulChipmunk","PetalWhiskers","BubblyButterfly","AngelFeathers","JollyJumper","WhiskerWanderer","SprinkleSweets","GigglyGazelle","DancingDolphin","SunnySmiles","SnugglySquirrel","CuteKangaroo","PeachyPup","BouncyBear","DazzlingDarling","ChirpyCockatiel","CandyCharm","CupcakeDelight","BuzzyBee","SnoozySloth","CharmingChinchilla","CottonCandyDream","BerryBlossom","DimpleDaisy","CocoaCuddles","CheerfulCheek","PetalPurr","BubblyBumblebee","AngelWhispers","JollyJester","WhiskerWonder","SprinkleSunshine","GigglyGiraffe","DancingDandelion","SunnySideUp","SnugglySheep","CuteKoala","PeachyPanda","BouncyBunny","DazzlingDaisy","ChirpyChickadee","CandyCane","CupcakeCutie","BuzzyButterfly","SnoozySnail","CharmingCherub","CottonCandyCloud","BerryBlush","DimpleDoll","CocoaCuddler","CheerfulChipmunk","PetalWhiskers","BubblyButterfly","AngelFeathers","JollyJumper","WhiskerWanderer","SprinkleSweets","GigglyGazelle","DancingDolphin","SunnySmiles","SnugglySquirrel","CuteKangaroo","PeachyPup","BouncyBear","DazzlingDarling","ChirpyCockatiel","CandyCharm","CupcakeDelight","BuzzyBee","SnoozySloth","CharmingChinchilla","CottonCandyDream","BerryBlossom","DimpleDaisy","CocoaCuddles","CheerfulCheek","PetalPurr","BubblyBumblebee","AngelWhispers","JollyJester","WhiskerWonder","SprinkleSunshine","GigglyGiraffe","DancingDandelion","SunnySideUp","SnugglySheep","CuteKoala","PeachyPanda","BouncyBunny","DazzlingDaisy"],ro="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M200-120q-33%200-56.5-23.5T120-200v-560q0-33%2023.5-56.5T200-840h357l-80%2080H200v560h560v-278l80-80v358q0%2033-23.5%2056.5T760-120H200Zm280-360ZM360-360v-170l367-367q12-12%2027-18t30-6q16%200%2030.5%206t26.5%2018l56%2057q11%2012%2017%2026.5t6%2029.5q0%2015-5.5%2029.5T897-728L530-360H360Zm481-424-56-56%2056%2056ZM440-440h56l232-232-28-28-29-28-231%20231v57Zm260-260-29-28%2029%2028%2028%2028-28-28Z'/%3e%3c/svg%3e",lo={data(){return{usedSpace:0,totalSpace:1,unit:"MB"}},computed:{fillPercentage(){return`${Math.min(this.usedSpace/this.totalSpace,1)*100}%`}},mounted(){this.usedSpace=0,this.totalSpace=1,this.unit="MB",this.fetchDiskUsage()},methods:{fetchDiskUsage(){G().conn.reqDatabaseUsage().then(s=>{const t=(s.disk_usage/1024/1024).toFixed(1),e=(s.disk_limit/1024/1024).toFixed(1);e>1024?(this.unit="GB",this.usedSpace=(t/1024).toFixed(1),this.totalSpace=(e/1024).toFixed(1)):(this.unit="MB",this.usedSpace=t,this.totalSpace=e)},()=>{console.log("failed to fetch disk usage")})}}},uo={id:"disk-usage-main"},co={class:"disk-usage-bar"},ho={class:"disk-usage-text"};function po(s,t,e,a,i,o){return m(),y("div",uo,[n("div",co,[n("div",{class:"disk-usage-fill",style:Y({width:o.fillPercentage})},null,4)]),n("div",ho," Space: "+T(i.usedSpace)+" / "+T(i.totalSpace)+" "+T(i.unit),1)])}const fo=q(lo,[["render",po],["__scopeId","data-v-6a56d11b"]]),et=s=>(ne("data-v-7202375c"),s=s(),ae(),s),mo={id:"usercard-main"},vo={id:"user-settings"},go=et(()=>n("hr",null,null,-1)),_o=et(()=>n("summary",null,"Change password",-1)),yo={id:"password-container"},wo={id:"info"},bo={id:"user-desc"},ko={id:"name-edit"},$o={id:"name"},So=["src"],xo={key:0,class:"admin_hint"},Co=et(()=>n("div",{style:{height:"0.2rem"}},null,-1)),Do=L({__name:"UserCard",props:{userInfo:{},avatarSize:{default:"168px"}},emits:["update:userInfo"],setup(s,{emit:t}){const e=s,a=G().conn,i=t,o=A(()=>K().user.id===e.userInfo.id),r=w(null),l=w(d());function d(){return`${Ue()}/user-avatar/${e.userInfo.username}?t=${Date.now()}&size=256`}function g($){if(!$.type.startsWith("image/")){F().showPopup("Please select an image file","error");return}F().showPopup("Uploading avatar..."),a.uploadUserAvatar(e.userInfo.username,$).then(S=>{l.value=d(),i("update:userInfo",S)},S=>{F().showPopup(S,"error")})}const u=w(!1),p=w(""),h=w(""),v=w(""),f=w("");function x(){if(p.value===""||p.value===e.userInfo.name||p.value!==e.userInfo.name&&a.updateUserNickname(p.value).then($=>{i("update:userInfo",$),u.value=!1},$=>{F().showPopup($,"error")}),v.value!==""||f.value!==""){if(v.value===""){F().showPopup("Please enter the new password","error");return}if(v.value!==f.value){F().showPopup("The new passwords do not match","error");return}if(H().encKey!==he(e.userInfo.username+he(h.value))){F().showPopup("The old password is incorrect","error");return}a.updateUserPassword(v.value).then($=>{const S=he(e.userInfo.username+he(v.value));H().setEncKey(S),h.value="",v.value="",f.value="",u.value=!1},$=>{F().showPopup($,"error")})}}return($,S)=>(m(),y("div",mo,[D(we,{show:u.value,"onUpdate:show":S[4]||(S[4]=c=>u.value=c),title:"User settings",onOnCancel:S[5]||(S[5]=c=>u.value=!1),onOnAccept:x},{default:E(()=>[n("div",vo,[n("b",null,T(e.userInfo.username),1),N(n("input",{type:"text","onUpdate:modelValue":S[0]||(S[0]=c=>p.value=c),placeholder:"Nickname",class:"input"},null,512),[[J,p.value]]),go,n("details",null,[_o,n("div",yo,[N(n("input",{type:"password","onUpdate:modelValue":S[1]||(S[1]=c=>h.value=c),placeholder:"Old password",class:"input"},null,512),[[J,h.value]]),N(n("input",{type:"password","onUpdate:modelValue":S[2]||(S[2]=c=>v.value=c),placeholder:"New password",class:"input"},null,512),[[J,v.value]]),N(n("input",{type:"password","onUpdate:modelValue":S[3]||(S[3]=c=>f.value=c),placeholder:"Confirm new password",class:"input"},null,512),[[J,f.value]])])])])]),_:1},8,["show"]),n("div",wo,[n("div",{id:"avatar",style:Y(o.value?{cursor:"pointer",borderRadius:"50%"}:{})},[D(P(fa),{href:l.value,size:$.avatarSize,onClick:S[6]||(S[6]=c=>{var _;return o.value?(_=r.value)==null?void 0:_.click():()=>{}})},null,8,["href","size"]),D(P(be),{text:"Change avatar",action:g,ref_key:"avatarUploadBtn",ref:r,style:{display:"none"}},null,512)],4),n("div",bo,[n("div",ko,[n("h1",$o,T(e.userInfo.name),1),o.value?(m(),y("img",{key:0,src:P(ro),alt:"",class:"icon",id:"edit-settings-icon",onClick:S[7]||(S[7]=c=>u.value=!0)},null,8,So)):R("",!0)]),n("p",{onClick:S[8]||(S[8]=c=>u.value=!0),style:{cursor:"pointer"}},[B(T(e.userInfo.username)+" ",1),e.userInfo.is_admin?(m(),y("label",xo,"admin")):R("",!0)]),D(fo),Co])]),n("p",{id:"credential",onClick:S[9]||(S[9]=()=>{P(Ze)(P(H)().encKey).then(()=>{P(F)().showPopup("Secret copied to clipboard","info")})})},"-- Credential:"+T(P(H)().encKey.substring(0,12))+" --",1)]))}}),Po=q(Do,[["__scopeId","data-v-7202375c"]]),Io={props:{title:{type:String,required:!0},description:{type:String,required:!0}}},To={class:"settings-container"},Uo={class:"settings-header"},Ao={class:"widget"};function Mo(s,t,e,a,i,o){return m(),y("div",To,[n("div",Uo,[n("label",null,T(e.title),1),n("p",null,T(e.description),1)]),n("div",Ao,[pe(s.$slots,"default",{},void 0,!0)])])}const Oe=q(Io,[["render",Mo],["__scopeId","data-v-f00f1fc8"]]),Lo=n("option",{value:"auto"},"Auto",-1),Bo=n("option",{value:"light"},"Light",-1),Ro=n("option",{value:"dark"},"Dark",-1),Eo=[Lo,Bo,Ro],qo=L({__name:"ConfigTheme",setup(s){const t=w("auto");function e(){t.value=Z.getThemeMode()}function a(i){i==="auto"?(Z.clear(),Z.setDefaultDarkMode()):i==="light"?Z.setDarkMode(!1):i==="dark"&&Z.setDarkMode(!0),e()}return e(),(i,o)=>(m(),V(Oe,{title:"Theme",description:"Change the theme of the app"},{default:E(()=>[N(n("select",{"onUpdate:modelValue":o[0]||(o[0]=r=>t.value=r),onChange:o[1]||(o[1]=r=>a(t.value)),style:{width:"80px",textAlign:"center",padding:"0.2rem",justifySelf:"flex-end"}},Eo,544),[[Ve,t.value]])]),_:1}))}}),Oo={class:"switch-toggle"},Fo=L({__name:"SwitchToggle",props:{checked:{type:Boolean}},emits:["update:checked"],setup(s,{emit:t}){const a=w(s.checked),i=t,o=w(null);return(r,l)=>(m(),y("div",Oo,[N(n("input",{type:"checkbox",id:"toggle","onUpdate:modelValue":l[0]||(l[0]=d=>a.value=d),onChange:l[1]||(l[1]=()=>{i("update:checked",a.value)}),ref_key:"checkerRef",ref:o},null,544),[[Bt,a.value]]),n("label",{class:"switch",onClick:l[2]||(l[2]=d=>{var g;return(g=o.value)==null?void 0:g.click()})})]))}}),Ae=q(Fo,[["__scopeId","data-v-58ea3d44"]]),zo=L({__name:"ConfigShowTags",setup(s){const t=H(),e=A({get:()=>t.showTagPanel,set:a=>t.setShowTagPanel(a)});return(a,i)=>(m(),V(Oe,{title:"Tag Display",description:"Show tag panel on the home page"},{default:E(()=>[D(Ae,{checked:e.value,"onUpdate:checked":i[0]||(i[0]=o=>e.value=o)},null,8,["checked"])]),_:1}))}}),Ho=L({__name:"ConfigShowScatterPlot",setup(s){const t=H(),e=A({get:()=>t.show3DScatterPlot,set:a=>t.setShow3DScatterPlot(a)});return(a,i)=>(m(),V(Oe,{title:"Scatter Plot",description:"Show scatter plot on the home page"},{default:E(()=>[D(Ae,{checked:e.value,"onUpdate:checked":i[0]||(i[0]=o=>e.value=o)},null,8,["checked"])]),_:1}))}}),No=["value"],Wo=L({__name:"ConfigPageCapacity",setup(s){const t=A({get:()=>H().numItemsPerPage,set:a=>H().setNumItemsPerPage(a)}),e=[10,20,50,100,200,500];return(a,i)=>(m(),V(Oe,{title:"Page Capacity",description:"Smaller number can improve performance"},{default:E(()=>[N(n("select",{"onUpdate:modelValue":i[0]||(i[0]=o=>t.value=o),style:{width:"80px",textAlign:"center",padding:"0.2rem",justifySelf:"flex-end"}},[(m(),y(j,null,ee(e,o=>n("option",{value:o,key:o},T(o),9,No)),64))],512),[[Ve,t.value]])]),_:1}))}}),jo={style:{display:"flex",flexDirection:"column",gap:"0.5rem",padding:"0.5rem",width:"100%",height:"100%",overflowY:"auto"}},Ko={style:{display:"flex",justifyContent:"center",alignItems:"center"}},Vo=n("hr",null,null,-1),Zo=L({__name:"SettingsWindow",setup(s){const t=K().user;return(e,a)=>(m(),y("div",jo,[n("div",Ko,[D(Po,{"user-info":P(t),"avatar-size":"120px"},null,8,["user-info"])]),Vo,D(qo),D(Wo),D(zo),D(Ho)]))}}),Go="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M180%20936q-24%200-42-18t-18-42V276q0-24%2018-42t42-18h291v60H180v600h291v60H180Zm486-185-43-43%20102-102H375v-60h348L621%20444l43-43%20176%20176-174%20174Z'/%3e%3c/svg%3e",Jo="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='m263-263%20290-143%20143-290-290%20143-143%20290Zm217-177q-17%200-28.5-11.5T440-480q0-17%2011.5-28.5T480-520q17%200%2028.5%2011.5T520-480q0%2017-11.5%2028.5T480-440Zm0%20360q-82%200-155-31.5t-127.5-86Q143-252%20111.5-325T80-480q0-83%2031.5-156t86-127Q252-817%20325-848.5T480-880q83%200%20156%2031.5T763-763q54%2054%2085.5%20127T880-480q0%2082-31.5%20155T763-197.5q-54%2054.5-127%2086T480-80Zm0-60q142%200%20241-99.5T820-480q0-142-99-241t-241-99q-141%200-240.5%2099T140-480q0%20141%2099.5%20240.5T480-140Zm0-340Z'/%3e%3c/svg%3e",Qo="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M240-200h120v-240h240v240h120v-360L480-740%20240-560v360Zm-80%2080v-480l320-240%20320%20240v480H520v-240h-80v240H160Zm320-350Z'/%3e%3c/svg%3e",Yo="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M440-120v-240h80v80h320v80H520v80h-80Zm-320-80v-80h240v80H120Zm160-160v-80H120v-80h160v-80h80v240h-80Zm160-80v-80h400v80H440Zm160-160v-240h80v80h160v80H680v80h-80Zm-480-80v-80h400v80H120Z'/%3e%3c/svg%3e",Xo={class:"button"},ei={key:0,id:"navigator"},ti={class:"nav-toggle"},ni=L({__name:"Toolbar",props:{returnHome:{type:Boolean,default:!0},compact:{type:Boolean,default:!0},showNavigator:{type:Boolean,default:!0}},setup(s){const t=s,e=ge();function a(){rn()}const i=w(null);let o=0;window.addEventListener("scroll",function(){const g=window.scrollY||document.documentElement.scrollTop;g<=o||o<10?i.value&&i.value.classList.contains("hidden")&&i.value.classList.remove("hidden"):i.value&&!i.value.classList.contains("hidden")&&i.value.classList.add("hidden"),o=g});const r=w(!1),l=ft(),d=A(()=>l.path.split("/")[1]);return(g,u)=>(m(),y(j,null,[D(xe,{show:r.value,"onUpdate:show":u[0]||(u[0]=p=>r.value=p),title:"Settings"},{default:E(()=>[D(Zo)]),_:1},8,["show"]),n("div",{class:ue(`main-toolbar ${t.compact?"compact-layout":"normal-layout shadow"}`),ref_key:"mainDiv",ref:i},[n("div",Xo,[t.returnHome?(m(),V(ve,{key:0,iconSrc:P(Qo),labelText:"Home",shortcut:"ctrl+h",onOnClick:u[1]||(u[1]=()=>{P(e).push("/")}),title:"home"},null,8,["iconSrc"])):(m(),V(ve,{key:1,iconSrc:P(Go),labelText:"Logout",shortcut:"ctrl+q",onOnClick:a,title:"logout"},null,8,["iconSrc"])),D(ve,{iconSrc:P(Yo),labelText:"Settings",shortcut:"ctrl+c",onOnClick:u[2]||(u[2]=()=>{r.value=!0}),title:"Open settings"},null,8,["iconSrc"]),g.showNavigator?R("",!0):(m(),V(P(kt),{key:2,menuItems:[{name:"Home",action:()=>{P(e).push("/")}},{name:"Dashboard",action:()=>{P(e).push(`/dashboard/${P(K)().user.username}`)}},{name:"Arxiv daily",action:()=>{P(e).push("/feed")}},{name:"About",action:()=>{P(e).push("/about")}}]},{default:E(()=>[D(ve,{iconSrc:P(Jo),labelText:"Explore",shortcut:"ctrl+e",title:"look around"},null,8,["iconSrc"])]),_:1},8,["menuItems"]))]),g.showNavigator?(m(),y("div",ei,[n("div",ti,[n("div",{class:ue(`button ${d.value==="home"||!d.value?"active-nav":""}`),onClick:u[3]||(u[3]=()=>{P(e).push("/")})},"Home",2),n("div",{class:ue(`button ${d.value==="feed"?"active-nav":""}`),onClick:u[4]||(u[4]=()=>{P(e).push("/feed")})},"Feed",2),n("div",{class:ue(`button ${d.value==="about"?"active-nav":""}`),onClick:u[5]||(u[5]=()=>{P(e).push("/about")})},"About",2)])])):R("",!0),pe(g.$slots,"default",{},void 0,!0)],2)],64))}}),Me=q(ni,[["__scopeId","data-v-55da3674"]]),ai="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='M453-280h60v-166h167v-60H513v-174h-60v174H280v60h173v166Zm27.266%20200q-82.734%200-155.5-31.5t-127.266-86q-54.5-54.5-86-127.341Q80-397.681%2080-480.5q0-82.819%2031.5-155.659Q143-709%20197.5-763t127.341-85.5Q397.681-880%20480.5-880q82.819%200%20155.659%2031.5Q709-817%20763-763t85.5%20127Q880-563%20880-480.266q0%2082.734-31.5%20155.5T763-197.684q-54%2054.316-127%2086Q563-80%20480.266-80Zm.234-60Q622-140%20721-239.5t99-241Q820-622%20721.188-721%20622.375-820%20480-820q-141%200-240.5%2098.812Q140-622.375%20140-480q0%20141%2099.5%20240.5t241%2099.5Zm-.5-340Z'/%3e%3c/svg%3e",St="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='M480-160q-133%200-226.5-93.5T160-480q0-133%2093.5-226.5T480-800q85%200%20149%2034.5T740-671v-129h60v254H546v-60h168q-38-60-97-97t-137-37q-109%200-184.5%2075.5T220-480q0%20109%2075.5%20184.5T480-220q83%200%20152-47.5T728-393h62q-29%20105-115%20169t-195%2064Z'/%3e%3c/svg%3e",si=L({__name:"Plot3d",props:{data:{}},setup(s,{expose:t}){const e=w(null),a=s,i=A(()=>a.data.map(f=>({x:f.x,y:f.y,z:f.z,mode:"markers",type:"scatter3d",hoverinfo:"text",hoverlabel:{bgcolor:"#181818",font:{color:"white"}},text:f.text,marker:{size:3.5,opacity:f.opacity,color:f.color}}))),o={autosize:!0,margin:{l:0,r:0,b:0,t:0},showlegend:!1,scene:{xaxis:{title:"",showticklabels:!1,tickfont:{size:10}},yaxis:{title:"",showticklabels:!1,tickfont:{size:10}},zaxis:{title:"",showticklabels:!1,tickfont:{size:10}}},paper_bgcolor:"#f6f6f6",plot_bgcolor:"#f6f6f6"},r={...o,paper_bgcolor:"#151515",plot_bgcolor:"#151515",font:{color:"white"}},l=w(Z.isDarkMode()?"dark":"light");Z.registerThemeChangeCallback(()=>{l.value=Z.isDarkMode()?"dark":"light",p()});const d=A(()=>l.value==="dark"?r:o),g={modeBarButtonsToRemove:["toImage","sendDataToCloud","resetCameraLastSave3d","resetCameraDefault3d"],displaylogo:!1,responsive:!0};let u=null;function p(){if(!e.value)return;He.react(e.value,i.value,d.value,g),e.value.layout.scene&&u&&He.relayout(e.value,"scene.camera",u)}return t({update:p}),fe(()=>{He.newPlot(e.value,i.value,d.value,g).then(()=>{e.value.on("plotly_relayout",h=>{if(console.log("plotly_relayout",h),!h["scene.camera"])return;const v=h["scene.camera"];u=Pe(v)})}),e.value.on("plotly_click",function(h){h.points||console.log("Not clicking on any data.");const v=h.points[0].x,f=h.points[0].y,x=h.points[0].z,$=h.points[0].pointNumber;console.log(`You clicked on ${v}, ${f}, ${x} (point ${$})}`)}),te(i,()=>{p()})}),(h,v)=>(m(),y("div",{id:"ploty-chart",ref_key:"plotlyChart",ref:e},null,512))}}),oi=q(si,[["__scopeId","data-v-e21cc654"]]),ii={id:"main-filtervis"},ri={key:0,id:"plot3dDiv"},li={key:0,id:"loadingDiv",class:"full"},ui={key:1,class:"status"},ci=L({__name:"FilterVis",setup(s){const t=K(),e=w(null),a=F(),i=H(),o=w(null),r=A(()=>{if(o.value===null)return{};const h=t.database.allKeys(),v={};for(const f of h)o.value[f]&&(v[f]=o.value[f]);return v});async function l(h,v="rgb(100, 100, 200)"){const f=r.value;if(!f)h=[];else for(let b=h.length-1;b>=0;b--)f[h[b]]===void 0&&h.splice(b,1);const x=h.length,$=await t.database.agetMany(h),S=new Float32Array(x),c=new Float32Array(x),_=new Float32Array(x),C=new Array(x);for(const[b,I]of h.entries()){let W=f[I];if(W==null)throw new Error("uid not found in feats: "+I);S[b]=W[0],c[b]=W[1],_[b]=W[2];const se=$[b];C[b]=`${se.authorYear()}<br>${se.summary.title}`}let k;if(typeof v=="string")k=v;else if(v instanceof Array)if(typeof v[0]=="string")k=v;else{const b=v,I=Math.max(...b),W=Math.min(...b),se={0:Z.isDarkMode()?[50,50,50]:[220,220,220],1:[50,200,150]};k=b.map(Fe=>{const Le=(Fe-W)/(I-W),$e=Array(3);for(let _e=0;_e<3;_e++)$e[_e]=Math.round(se[0][_e]*(1-Le)+se[1][_e]*Le);return`rgb(${$e[0]}, ${$e[1]}, ${$e[2]})`})}else throw new Error("Invalid color type");return{x:S,y:c,z:_,opacity:.75,color:k,text:C}}const d=w(null);async function g(){const h=a.shownDataScores;let v;h?v=await l(Pe(a.shownDataUIDs),h):v=await l(Pe(a.shownDataUIDs));const x=t.database.allKeys().filter(c=>a.shownDataUIDs.indexOf(c)==-1),$=await l(x,Z.isDarkMode()?"rgb(50, 50, 50)":"rgb(220, 220, 220)"),S=await l(Pe(a.unfoldedDataUIDs),"rgb(255, 0, 0)");d.value=[v,$,S]}const u=A(()=>Object.keys(r.value).length>0);async function p(){o.value=null;const h=G().conn,v=(await h.status()).n_data;let f;v<50?f=-1:v<100?f=5:v<300?f=8:v<500?f=12:f=15,console.log("dataset size: ",v,"perp: ",f),o.value=await h.reqDatabaseFeatureTSNE("doc_feature",3,f)}return te(()=>[a.shownDataUIDs,a.unfoldedDataUIDs],()=>{g()}),te(()=>i.show3DScatterPlot,h=>{h&&p().then(()=>{g()})}),fe(()=>{i.show3DScatterPlot&&p().then(()=>{g()})}),(h,v)=>(m(),y("div",ii,[P(i).show3DScatterPlot?(m(),y("div",ri,[D(oi,{data:d.value?d.value:[],ref_key:"plot3DRef",ref:e},null,8,["data"]),!u.value||!r.value?(m(),y("div",li,[o.value===null?(m(),V(qe,{key:0})):(m(),y("p",ui,"Data not ready"))])):R("",!0)])):R("",!0)]))}}),di=q(ci,[["__scopeId","data-v-b8368217"]]),hi={id:"searchbar"},pi={id:"searchbar-container"},fi=["value"],mi=L({__name:"Searchbar",setup(s){const t=F(),e=["title","author","year","note","publication","feature","uuid"],a=w(""),i=w(null);function o(){const d={searchBy:i.value.value,content:a.value};t.searchState=d,console.log(d),t.updateShownData()}const r=vt(o,300);function l(d){return d.charAt(0).toUpperCase()+d.slice(1)}return(d,g)=>(m(),y("div",hi,[n("div",pi,[n("select",{ref_key:"searchSelector",ref:i,name:"search_type",id:"searchType",onChange:o},[(m(),y(j,null,ee(e,u=>n("option",{value:u},T(l(u)),9,fi)),64))],544),N(n("input",{type:"text",id:"searchbar-input",placeholder:"Search","onUpdate:modelValue":g[0]||(g[0]=u=>a.value=u),onInput:g[1]||(g[1]=(...u)=>P(r)&&P(r)(...u))},null,544),[[J,a.value]])])]))}}),vi=q(mi,[["__scopeId","data-v-18d7d1fa"]]),gi=s=>(ne("data-v-92d73f7f"),s=s(),ae(),s),_i={id:"main-home",class:"gradIn"},yi={class:"horizontal fullHeight"},wi={key:0,id:"left-panel"},bi={id:"right-panel",class:"panel1"},ki={class:"fullWidth"},$i={style:{display:"flex","justify-content":"space-between"}},Si={style:{"flex-grow":"1"}},xi={style:{display:"flex","flex-grow":"0","margin-right":"5px","margin-block":"5px"}},Ci={key:1,id:"blankPlaceholder"},Di={key:0,style:{"font-size":"xx-large","font-weight":"bold","user-select":"none"}},Pi=gi(()=>n("br",null,null,-1)),Ii={name:"Home",inheritAttrs:!1,customOptions:{}},Ti=L({...Ii,setup(s){const t=F(),e=K(),a=H();window.innerWidth<768&&a.setShowTagPanel(!1);const o=ge().currentRoute.value.query.tags;o!=null&&(t.tagStatus.checked=new O(o.split("&&")),t.tagStatus.unfolded=t.tagStatus.checked.allParents());const r=w(null);function l(){r.value.show({datapoint:null})}function d(u){var h;u.preventDefault();const p=(h=u.dataTransfer)==null?void 0:h.files;p&&(l(),r.value.loadFiles(p)||r.value.close())}function g(){t.reloadDatabase(),G().wsConn.resetReconnect()}return(u,p)=>(m(),y(j,null,[D(Xe,{ref_key:"dataEditor",ref:r},null,512),D(Me,{"return-home":!1,compact:!0}),n("div",_i,[n("div",yi,[D(Ie,{name:"left-in"},{default:E(()=>[P(a).showTagPanel?(m(),y("div",wi,[D(En,{onOnCheck:p[0]||(p[0]=()=>P(t).updateShownData())})])):R("",!0)]),_:1}),n("div",bi,[n("div",ki,[D(di)]),n("div",{class:"scrollable",id:"fileSelector",onDragover:p[2]||(p[2]=h=>h.preventDefault()),onDrop:d},[n("div",$i,[n("div",Si,[D(vi)]),n("div",xi,[D(ve,{iconSrc:P(ai),labelText:"New",title:"Add new data to database",onClick:l,shortcut:"ctrl+n"},null,8,["iconSrc"]),D(ve,{iconSrc:P(St),labelText:"Reload",title:"Reload database",onClick:g},null,8,["iconSrc"])])]),P(t).shownDataUIDs.length>0?(m(),V(Te,{key:0,uids:P(t).shownDataUIDs,unfoldedIds:P(t).unfoldedDataUIDs,"onUpdate:unfoldedIds":p[1]||(p[1]=h=>P(t).unfoldedDataUIDs=h)},null,8,["uids","unfoldedIds"])):(m(),y("div",Ci,[P(e).database.initialized?(m(),y("p",Di,[B(" Nothing to show "),n("p",{style:{"font-size":"medium"}},[B(" Add your first enty by clicking the "),n("b",null,[n("a",{onClick:l,style:{cursor:"pointer","border-radius":"5px","padding-inline":"3px","background-color":"var(--color-background-soft)"}},"⊕ New")]),B(" button above."),Pi])])):(m(),V(qe,{key:1}))]))],32)])])])],64))}}),Ui=q(Ti,[["__scopeId","data-v-92d73f7f"]]);function Ai(s,t=!1){t&&(s*=1e3);const e=new Date(s);let a=e.getFullYear().toString();a.length!==4&&(a="0".repeat(4-a.length)+a);let i=(e.getMonth()+1).toString();i.length===1&&(i="0"+i);let o=e.getDate().toString();o.length===1&&(o="0"+o);let r=`${a}-${i}-${o} `;const l={hourCycle:"h23",hour:"2-digit",minute:"2-digit",second:"2-digit"};return r+=e.toLocaleTimeString([],l),r}const xt=s=>(ne("data-v-693996cb"),s=s(),ae(),s),Mi={id:"authorPapers"},Li={id:"feed-main",class:"slideInFast"},Bi={class:"articleBlock"},Ri={class:"titleBlock"},Ei={class:"titleId"},qi={class:"authors"},Oi=xt(()=>n("label",null,"[Authors] ",-1)),Fi={class:"authorSpan"},zi=["href"],Hi=["onClick"],Ni={key:1},Wi={class:"actions"},ji=["href"],Ki=["href"],Vi=xt(()=>n("summary",null,"Abstract",-1)),Zi={id:"relatedArticles"},Gi=L({__name:"ArticleBlock",props:{article:{}},setup(s){const t=s,e=K(),a=G().conn,i=w(null);async function o(){var $;($=i.value)==null||$.show({datapoint:null,bibtex:t.article.bibtex,tags:[],url:t.article.url})}const r=w({});async function l(){for(let $=0;$<t.article.authors.length;$++){const S=t.article.authors[$],c=t.article.authors_other_publications[$],_=await e.database.agetMany(c);r.value[S]=_}}l();const d=A(()=>{const $={};for(const S in r.value)r.value[S]?$[S]=r.value[S].length:$[S]=null;return $}),g=w(!1),u=w([]);function p($){u.value=r.value[$],u.value||(u.value=[]),g.value=!0}const h=w([]),v=w([]),f=A(()=>{const $={};for(let S=0;S<h.value.length;S++)$[h.value[S].summary.uuid]=v.value[S].toPrecision(4);return $});function x(){h.value.length>0||a.search("searchFeature",{pattern:t.article.abstract,n_return:8}).then($=>{var C;const S=new Array,c=new Array;for(const k of Object.keys($))S.push((C=$[k])==null?void 0:C.score),c.push(k);const _=_t(c,S);e.database.agetMany(_[0],!1).then(k=>{var I;h.value=k;const b=[];for(const W of k)b.push((I=$[W.summary.uuid])==null?void 0:I.score);v.value=b})})}return($,S)=>(m(),y(j,null,[D(Xe,{ref_key:"dataEditor",ref:i},null,512),D(xe,{show:g.value,"onUpdate:show":S[0]||(S[0]=c=>g.value=c),title:"Publications in the database",onOnClose:S[1]||(S[1]=c=>u.value=[])},{default:E(()=>[n("div",Mi,[D(Te,{uids:u.value.map(c=>c.summary.uuid)},null,8,["uids"])])]),_:1},8,["show"]),n("div",Li,[n("div",Bi,[n("div",Ri,[n("h2",null,T(t.article.title),1),n("label",Ei,T(t.article.uuid),1)]),n("div",qi,[Oi,(m(!0),y(j,null,ee(t.article.authors,(c,_)=>(m(),y("span",Fi,[n("a",{href:`https://arxiv.org/search/?query=${c}&searchtype=author`,target:"_blank"},T(c),9,zi),d.value[c]?(m(),y("a",{key:0,class:"pubCount",onClick:()=>p(c)},T(` (${d.value[c]})`),9,Hi)):R("",!0),_<t.article.authors.length-1?(m(),y("span",Ni,", ")):R("",!0)]))),256))]),n("div",Wi,[n("a",{href:$.article.url,target:"_blank"},"Link",8,ji),B(" | "),n("a",{href:`https://arxiv.org/pdf/${$.article.uuid}.pdf`,target:"_blank"},"PDF",8,Ki),B(" | "),n("a",{onClick:o},"Collect")]),n("p",null,"Published: "+T(P(Ai)(t.article.time_added,!0)),1),n("details",null,[Vi,n("p",null,T(t.article.abstract),1)]),n("details",null,[n("summary",{onClick:x},"Related articles"),n("div",Zi,[D(Te,{uids:h.value.map(c=>c.summary.uuid),scores:f.value},null,8,["uids","scores"])])])])])],64))}}),Ji=q(Gi,[["__scopeId","data-v-693996cb"]]),Ce=s=>(ne("data-v-29758fd8"),s=s(),ae(),s),Qi={id:"toolbar"},Yi={id:"main"},Xi=["src"],er={id:"settings"},tr=Ce(()=>n("option",{value:"arxiv"},"ALL",-1)),nr=Ce(()=>n("option",{value:"arxiv->cs.CV"},"cs.CV",-1)),ar=Ce(()=>n("option",{value:"arxiv->cs.AI"},"cs.AI",-1)),sr=Ce(()=>n("option",{value:"arxiv->stat.ML"},"stat.ML",-1)),or=[tr,nr,ar,sr],ir={key:0,id:"loadingPlaceholder"},rr=Ce(()=>n("b",null,"Fetching...",-1)),lr={key:1,id:"loadingPlaceholder"},ur=Ce(()=>n("b",null,"No articles found",-1)),cr=[ur],dr=L({__name:"Feed",setup(s){const t=G().conn,e=w("arxiv"),a=w(!1),i=w(""),o=w(null),r=w([]),l=A(function(){return[...r.value].sort(($,S)=>{if(o.value===null||!$.feature||!S.feature)return 0;{const c=new Float32Array($.feature),_=new Float32Array(S.feature),C=o.value,k=c.reduce((I,W,se)=>I+(W-C[se])**2,0),b=_.reduce((I,W,se)=>I+(W-C[se])**2,0);return k-b}})});function d(){if(i.value.trim()===""){o.value=null;return}t.featurize(i.value).then(x=>{o.value=new Float32Array(x)},()=>{console.log("failed to featurize")})}const g=vt(d,100),u=ge();let p=parseInt(u.currentRoute.value.query.maxResults)||100;p>200&&(window.alert("maxResults cannot be larger than 200"),p=200);let h=u.currentRoute.value.query.search||"";h!==""&&(i.value=h);const v=w(null);async function f(){r.value=[];async function x($,S){return await G().conn.fetchFeedList($,S)}a.value=!0;try{const $=await x(p,e.value);r.value=$,d()}finally{a.value=!1}}return fe(()=>{f().then(()=>v.value.classList.remove("spin"),()=>{v.value.classList.remove("spin"),window.alert("Failed to fetch articles")})}),(x,$)=>(m(),y(j,null,[n("div",Qi,[D(Me,{ref:"toolbar"},null,512)]),n("div",Yi,[n("h1",null,[B(" Arxiv daily "),n("img",{ref_key:"refreshButton",ref:v,src:P(St),alt:"",class:"icon spin",title:"refresh the page",onClick:$[0]||($[0]=S=>{const c=S.target;c.classList.contains("spin")||(c.classList.add("spin"),f().then(()=>c.classList.remove("spin")))})},null,8,Xi)]),n("div",er,[N(n("select",{name:"category",id:"category-select","onUpdate:modelValue":$[1]||($[1]=S=>e.value=S),onChange:f},or,544),[[Ve,e.value]]),N(n("input",{type:"text",placeholder:"Search",onInput:$[2]||($[2]=(...S)=>P(g)&&P(g)(...S)),"onUpdate:modelValue":$[3]||($[3]=S=>i.value=S),autocomplete:"off"},null,544),[[J,i.value]])]),l.value.length===0&&a.value?(m(),y("div",ir,[rr,D(qe)])):R("",!0),l.value.length===0&&!a.value?(m(),y("div",lr,cr)):R("",!0),(m(!0),y(j,null,ee(l.value,S=>(m(),V(Ji,{article:S},null,8,["article"]))),256))])],64))}}),hr=q(dr,[["__scopeId","data-v-29758fd8"]]),Ct=s=>(ne("data-v-dbb25d40"),s=s(),ae(),s),pr={class:"main"},fr={id:"login",class:"slideIn"},mr={class:"loginLine"},vr={class:"loginLine"},gr=["type"],_r=Ct(()=>n("summary",null,"Settings",-1)),yr={id:"settings"},wr=Ct(()=>n("label",{for:"backendHostInput"},"Backend: ",-1)),br={class:"options"},kr={key:0,class:"error"},$r=L({__name:"LoginInput",setup(s){const t=w(""),e=w(""),a=w(""),i=w(!0),o=w(!1),r=A(()=>o.value?"text":"password"),l=w("Login"),d=ge(),g=w(""),u=w("");d.isReady().then(()=>{Rt(()=>{g.value=H().backendHost,u.value=H().backendPort})});function p(){H().setBackendHost(g.value),H().setBackendPort(u.value),l.value="Connecting...";const h=un(t.value,e.value);G().conn.authUsr(h).then(f=>{Ge(h,f,i.value),a.value="";const x=d.currentRoute.value.query.from;x?(console.log("Redirecting to",x),d.push(x)):d.push("/"),l.value="Login"},f=>{a.value=f,l.value="Login"})}return(h,v)=>(m(),y("div",pr,[n("div",fr,[n("form",null,[n("div",mr,[N(n("input",{class:"key-input",type:"text",id:"username-input","onUpdate:modelValue":v[0]||(v[0]=f=>t.value=f),placeholder:"Username",autocomplete:"off"},null,512),[[J,t.value]])]),n("div",vr,[N(n("input",{class:"key-input",type:r.value,id:"password-input","onUpdate:modelValue":v[1]||(v[1]=f=>e.value=f),placeholder:"Password"},null,8,gr),[[Et,e.value]])]),n("details",null,[_r,n("div",yr,[wr,N(n("input",{type:"text",id:"backendHostInput","onUpdate:modelValue":v[2]||(v[2]=f=>g.value=f)},null,512),[[J,g.value]]),B(" : "),N(n("input",{type:"text",id:"port","onUpdate:modelValue":v[3]||(v[3]=f=>u.value=f)},null,512),[[J,u.value]]),n("div",br,[D(ye,{checked:i.value,onOnCheck:v[4]||(v[4]=()=>{i.value=!i.value})},{default:E(()=>[B("Stay login")]),_:1},8,["checked"]),D(ye,{checked:o.value,onOnCheck:v[5]||(v[5]=()=>{o.value=!o.value})},{default:E(()=>[B("Show key")]),_:1},8,["checked"])])])]),n("button",{type:"submit",onClick:qt(p,["prevent"])},T(l.value),1)]),a.value?(m(),y("p",kr,T(a.value),1)):R("",!0)])]))}}),Sr=q($r,[["__scopeId","data-v-dbb25d40"]]),xr={id:"main"},Cr={id:"container"},Dr={for:"login",id:"info"},Pr=["href"],Ir=L({__name:"Login",setup(s){Z.setDefaultDarkMode();function t(){alert(`Not implemented yet. 
Please contact the maintainer for registration.`)}return(e,a)=>(m(),y("div",xr,[n("div",Cr,[D(Sr),n("label",Dr,[B(" Need assistant? - "),n("a",{onClick:t},"Register"),B(" | "),n("a",{href:`mailto:${P(io).email}`},"Contact me",8,Pr)])])]))}}),Tr=q(Ir,[["__scopeId","data-v-a2e2514f"]]);class Ur{constructor(t){Q(this,"router");this.router=t}getURLParams(){const t={},e=this.router.currentRoute.value.query;for(const a in e)t[a]=e[a];return t}setURLParam(t,e){const a=this.getURLParams();a[t]=e,this.router.push({query:a})}updateURLWithParam(t,e){const a=this.getURLParams();return a[t]=e,this.router.resolve({query:a}).href}}function Ar(s,{router:t=null,datapoint:e=null}){const a=t?new Ur(t):null;if(e){const i=K().user;s=s.replace(new RegExp("./misc/","g"),`${Ue()}/misc/${e.summary.uuid}?_u=${i.id}&&fname=`),a&&(window.location.href.includes("/reader/")?s=s.replace(new RegExp("\\$\\{doc\\}#","g"),a.updateURLWithParam("docHashMark","")):s=s.replace(new RegExp("\\$\\{doc\\}#","g"),`${e.getOpenDocURL()}#`))}return s}const Mr={id:"noteEditor"},Lr={key:2,id:"save-hint"},Br={id:"btn-container"},Rr=["id"],Er={key:0,id:"misc-container",class:"hover-scrollable"},qr={key:0,style:{"font-weight":"bold",color:"var(--color-text-soft)",top:"0.5rem"}},Or=["href"],Fr={key:0,style:{color:"var(--color-text-soft)"}},zr={class:"misc-file-op-container"},Hr=["onClick"],Nr=["onClick"],Wr=["onClick"],jr=L({__name:"NoteEditor",props:{datapoint:{},theme:{default:"light"}},setup(s,{expose:t}){const e=s,a=ge(),i=w(""),o=A(()=>Ar(i.value,{router:a,datapoint:e.datapoint})),r=w(null),l=F(),d=w([]),g=w(""),u=A(()=>g.value===i.value?"":"Unsaved");async function p(){if(e.datapoint.isDummy())return;const k=await e.datapoint.fetchNote();g.value=k,i.value=k,k.trim().length>0&&(c.value=!0)}async function h(){d.value=await e.datapoint.listMiscFiles()}async function v(){e.datapoint.isDummy()||await Promise.all([p(),h()])}v(),te(()=>e.datapoint,()=>{v(),console.log("datapoint changed, fetching note and misc files...")});async function f(){await e.datapoint.uploadNote(i.value),g.value=i.value}const x=async k=>{await e.datapoint.deleteMiscFile(k),d.value=d.value.filter(b=>b.fname!==k),F().showPopup("File deleted","info")},$=async(k,b)=>{if(k.split(".").pop()!==b.split(".").pop()){F().showPopup("File extension must be the same","error");return}await e.datapoint.renameMiscFile(k,b),i.value=i.value.replace(k,b),h(),F().showPopup("File renamed","info")},S=async k=>{(await e.datapoint.uploadMisc(k)).map(I=>r.value.insert(()=>({targetValue:`![image](${I})`,select:!1,deviationStart:0,deviationEnd:0}))),f(),h()},c=w(!1);function _(k){return i.value.indexOf(k)>=0}function C(k){const b=window.prompt(k);if(!b)throw new Error("User cancelled");return b}return t({preview:c,fetchNote:p}),Xt("update_note",k=>{if(k.session_id===G().wsConn.sessionID)return;k.datapoint_summary.uuid===e.datapoint.uid&&v().then(()=>{F().showPopup("update from other clients","info")})}),(k,b)=>(m(),y("div",Mr,[n("div",{class:"editor",onDblclick:b[1]||(b[1]=I=>c.value=!1)},[c.value?(m(),V(P(Kt),{key:1,"model-value":o.value,theme:k.theme,"preview-theme":"vuepress"},null,8,["model-value","theme"])):(m(),V(P(jt),{key:0,ref_key:"mdEditor",ref:r,modelValue:i.value,"onUpdate:modelValue":b[0]||(b[0]=I=>i.value=I),preview:!1,language:"en-US",theme:k.theme,onOnSave:f,onOnUploadImg:S,toolbars:["bold","underline","italic","-","strikeThrough","title","quote","unorderedList","orderedList","task","-","link","-","revoke","next","save","=","catalog"]},null,8,["modelValue","theme"])),!c.value&&u.value?(m(),y("div",Lr,T(u.value),1)):R("",!0)],32),n("div",Br,[n("button",{onClick:b[2]||(b[2]=I=>c.value=!c.value)},T(c.value?"Edit":"Preview"),1),D(P(be),{action:I=>{e.datapoint.uploadMisc([I]).then(W=>{P(F)().showPopup("File uploaded","success"),h(),r.value.insert(()=>({targetValue:`[${I.name}](${W[0]})`,select:!1,deviationStart:0,deviationEnd:0}))})}},null,8,["action"])]),n("div",{id:"misc-toggle",onClick:b[3]||(b[3]=()=>{P(l).showMiscPanel=!P(l).showMiscPanel})},[n("div",{id:P(l).showMiscPanel?"triangle-down":"triangle"},null,8,Rr)]),P(l).showMiscPanel?(m(),y("div",Er,[d.value.length===0?(m(),y("div",qr," No attached files. ")):R("",!0),(m(!0),y(j,null,ee(d.value,I=>(m(),y("div",{key:I.fname,class:"misc-file"},[n("div",null,[n("a",{href:I.url,target:"_blank"},T(I.fname),9,Or),_(I.fname)?R("",!0):(m(),y("label",Fr," (no-ref) "))]),n("div",zr,[n("a",{style:{color:"var(--color-text-soft)",cursor:"pointer"},onClick:W=>{P(Ze)(I.fname),P(F)().showPopup("Copied")}}," copy ",8,Hr),n("a",{style:{color:"var(--color-text-soft)",cursor:"pointer"},onClick:W=>$(I.fname,C("New name"))}," rename ",8,Nr),_(I.fname)?R("",!0):(m(),y("a",{key:0,style:{color:"var(--color-danger)",cursor:"pointer"},onClick:W=>x(I.fname)}," delete ",8,Wr))])]))),128))])):R("",!0)]))}}),Kr=q(jr,[["__scopeId","data-v-68fe428a"]]),Vr=s=>(ne("data-v-42acbd7b"),s=s(),ae(),s),Zr={id:"body"},Gr=["src"],Jr=Vr(()=>n("div",{style:{color:"var(--color-text-soft)","font-weight":"bold","font-size":"large"}},"No file, drag and drop to  ",-1)),Qr=L({__name:"ReaderBody",props:{datapoint:{},layoutType:{}},setup(s,{expose:t}){const e=s,a=ge(),i=A(()=>{const C=a.currentRoute.value.query.docHashMark;return C||""}),o=w(null),r=w(null),l=w(null),d=w(!1),g=w(null);t({noteEditor:g});function u(_){l.value&&l.value.contains(_.target)&&(d.value=!0)}function p(){d.value=!1}const h=A({get:()=>F().preferredReaderLeftPanelWidthPerc,set:_=>{F().preferredReaderLeftPanelWidthPerc=_}});function v(_){if(d.value&&o.value&&r.value&&l.value){const k=("touches"in _?_.touches[0].clientX:_.clientX)-o.value.getBoundingClientRect().left;o.value.style.width=`${k}px`,r.value.style.width=`calc(100% - ${k}px)`,h.value=k/(k+r.value.getBoundingClientRect().width),h.value=Math.max(.1,Math.min(.9,h.value))}}window.addEventListener("mousedown",u),window.addEventListener("touchstart",u),window.addEventListener("mouseup",p),window.addEventListener("touchend",p),window.addEventListener("mousemove",v),window.addEventListener("touchmove",v);const f=A(()=>e.layoutType==0||e.layoutType==2),x=A(()=>e.layoutType==1||e.layoutType==2);function $(_){_==2&&(o.value.style.width=`${h.value*100}%`,r.value.style.width=`${(1-h.value)*100}%`),H().setReaderLayoutType(_)}te(()=>e.layoutType,(_,C)=>{console.log("layoutType changed:",C,"->",_),$(_)});const S=w(Z.isDarkMode()?"dark":"light");Z.registerThemeChangeCallback(()=>S.value=Z.isDarkMode()?"dark":"light");const c=A(()=>`${e.datapoint.getOpenDocURL({extraPDFViewerParams:{"color-mode":S.value},urlHashMark:i.value})}`);return fe(()=>{$(e.layoutType)}),(_,C)=>(m(),y("div",Zr,[N(n("div",{class:"pane",id:"left-pane",ref_key:"leftPane",ref:o},[_.datapoint.summary.has_file?(m(),y("iframe",{key:0,src:c.value,title:"doc",frameborder:"0",style:Y({"pointer-events":d.value?"none":"auto"})},null,12,Gr)):(m(),y("div",{key:1,style:{display:"flex","justify-content":"center","align-items":"center",height:"100%",width:"100%"},onDragover:C[0]||(C[0]=k=>k.preventDefault()),onDrop:C[1]||(C[1]=k=>{var I;k.preventDefault();const b=(I=k.dataTransfer)==null?void 0:I.files;b&&b.length==1&&_.datapoint.uploadDocument(b[0]).then(()=>{P(F)().showPopup("File uploaded")})})},[Jr,D(P(be),{action:k=>_.datapoint.uploadDocument(k),text:"upload","as-link":!0,style:{"font-weight":"bold","font-size":"large",cursor:"pointer"}},null,8,["action"])],32))],512),[[je,f.value]]),_.layoutType==2?(m(),y("div",{key:0,id:"splitter",ref_key:"splitter",ref:l,onMousedown:u,onTouchstart:u},null,544)):R("",!0),N(n("div",{class:"pane",id:"right-pane",ref_key:"rightPane",ref:r},[D(Kr,{datapoint:_.datapoint,theme:S.value,ref_key:"noteEditor",ref:g},null,8,["datapoint","theme"])],512),[[je,x.value]])]))}}),Yr=q(Qr,[["__scopeId","data-v-42acbd7b"]]),Xr="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='M180-120q-24%200-42-18t-18-42v-600q0-24%2018-42t42-18h210q24%200%2042%2018t18%2042v600q0%2024-18%2042t-42%2018H180Zm390%200q-24%200-42-18t-18-42v-600q0-24%2018-42t42-18h210q24%200%2042%2018t18%2042v600q0%2024-18%2042t-42%2018H570Zm210-660H570v600h210v-600ZM570-180h210-210Z'/%3e%3c/svg%3e",el="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='M220-160q-24%200-42-18t-18-42v-143h60v143h520v-143h60v143q0%2024-18%2042t-42%2018H220Zm230-153v-371L330-564l-43-43%20193-193%20193%20193-43%2043-120-120v371h-60Z'/%3e%3c/svg%3e",tl={id:"toolbarOps"},nl={id:"recently-read"},al={id:"main-reader",class:"gradIn"},sl={name:"Reader",inheritAttrs:!1,customOptions:{}},ol=L({...sl,setup(s){const t=K(),e=F(),a=ft(),i=ge(),o=w(t.database.getDummy());async function r(){const f=await t.database.aget(a.params.id);f&&(o.value=f),e.addRecentlyReadDataUID(f.uid),t.database.agetMany(e.recentlyReadDataUIDs).then(x=>{d(x)}),console.log("Reader: updated datapoint",f.summary.title,"uid",f.uid)}te(()=>a.params.id,()=>{r()});const l=w([]);function d(f){const x=[];for(const $ of f)$.summary.uuid!==a.params.id&&x.push({name:$.authorYear(),action:()=>{i.push("/reader/"+$.summary.uuid)}});console.log("Reader: updated recent read menu items",x),l.value=x}const g=w(H().readerLayoutType);window.innerWidth<800&&(g.value=0);function u(){if(window.innerWidth<800)g.value=(g.value+1)%2;else switch(g.value){case 0:g.value=2;break;case 1:g.value=2;break;case 2:g.value=0;break}}const p=w(null);function h(f){function x(){o.value.uploadDocument(f).then($=>{o.value.update($),e.showPopup("Document uploaded","success")},()=>e.showPopup("Failed to upload document","error"))}o.value.summary.has_file?o.value.freeDocument().then($=>{o.value.update($),x()},()=>e.showPopup("Failed to free document","error")):x()}const v=w(null);return fe(()=>{console.log("Reader mounted"),r()}),(f,x)=>(m(),y(j,null,[D(P(be),{action:h,ref_key:"fileSelectionBtn",ref:p,style:{display:"none"}},null,512),D(Me,{compact:!0,"show-navigator":!1},{default:E(()=>[n("div",tl,[D(ve,{iconSrc:P(Xr),labelText:"layout",shortcut:"ctrl+r",onOnClick:u,title:"change layout"},null,8,["iconSrc"]),D(ve,{iconSrc:P(el),labelText:"replace",shortcut:"ctrl+u",onOnClick:x[0]||(x[0]=()=>p.value.click()),title:"upload a new document"},null,8,["iconSrc"]),D(P(kt),{"menu-items":l.value},{default:E(()=>[n("div",nl,T(`${o.value.authorAbbr()} (${o.value.summary.year})`),1)]),_:1},8,["menu-items"])])]),_:1}),n("div",al,[D(Yr,{datapoint:o.value,layoutType:g.value,ref_key:"readerBody",ref:v},null,8,["datapoint","layoutType"])])],64))}}),il=q(ol,[["__scopeId","data-v-65a770f6"]]),rl="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M160-400v-80h280v80H160Zm0-160v-80h440v80H160Zm0-160v-80h440v80H160Zm360%20560v-123l221-220q9-9%2020-13t22-4q12%200%2023%204.5t20%2013.5l37%2037q8%209%2012.5%2020t4.5%2022q0%2011-4%2022.5T863-380L643-160H520Zm300-263-37-37%2037%2037ZM580-220h38l121-122-18-19-19-18-122%20121v38Zm141-141-19-18%2037%2037-18-19Z'/%3e%3c/svg%3e",X=s=>(ne("data-v-43baa4c1"),s=s(),ae(),s),ll={id:"users-widget-main"},ul={id:"user-editor-main"},cl={class:"horizontal"},dl=["src"],hl={id:"user-editor"},pl={class:"horizontal"},fl={class:"horizonal",style:{display:"flex","align-items":"center",gap:"0.5rem"}},ml=X(()=>n("b",null,"Administrator ",-1)),vl={class:"full-width left-align"},gl=X(()=>n("b",null,"Max Storage (MB):",-1)),_l=X(()=>n("br",null,null,-1)),yl={key:0,class:"full-width left-align"},wl=X(()=>n("b",null,"Mandatory Tags:",-1)),bl={id:"mandatory-tag-edit"},kl={id:"delete-user-dialog-main"},$l=X(()=>n("p",{style:{color:"var(--color-danger)"}}," All data under this user will be deleted! ",-1)),Sl=X(()=>n("hr",{style:{"margin-block":"1rem"}},null,-1)),xl={id:"create-user-main"},Cl={id:"create-user-table"},Dl=X(()=>n("td",null,"Username:",-1)),Pl=X(()=>n("td",null,"Name:",-1)),Il=X(()=>n("td",null,"Password:",-1)),Tl=X(()=>n("td",null,"Max Storage (MB):",-1)),Ul=X(()=>n("td",null,"Mandatory Tags:",-1)),Al=X(()=>n("td",null,"Administrator:",-1)),Ml={style:{display:"flex","align-items":"center","padding-block":"0.25rem"}},Ll={id:"user-widget-header"},Bl=X(()=>n("div",null,[n("b",null," Users ")],-1)),Rl={key:0},El=X(()=>n("th",null," Avatar ",-1)),ql=X(()=>n("th",null," Username ",-1)),Ol=X(()=>n("th",null," Name ",-1)),Fl=X(()=>n("th",null," Storage ",-1)),zl=X(()=>n("th",null," Accessibility ",-1)),Hl={class:"user-line"},Nl={key:0},Wl=["onClick"],jl=["src"],Kl={class:"center full-width full-height"},Vl=["src"],Zl={class:"username"},Gl={style:{"text-align":"right"}},Jl={key:1,class:"admin_hint"},Ql={key:0,colspan:"5"},Yl=L({__name:"UsersWidget",setup(s){const t=w([]),e=A(()=>K().user.is_admin),a=G().conn,i=w(!1),o=w({});function r(k){if(!e.value)return;const b=JSON.parse(JSON.stringify(k));o.value=b,o.value.max_storage/=1024*1024,i.value=!0}function l(k){const b=k.split(";").map(I=>I.trim());b.length===1&&b[0]===""?o.value.mandatory_tags=[]:o.value.mandatory_tags=b}function d(){console.log(o.value),a.setUserAccess(o.value.username,o.value.is_admin,o.value.mandatory_tags,o.value.max_storage*1024*1024).then(k=>{i.value=!1},k=>{console.log(k),F().showPopup(k,"error")})}const g=w(!1),u=w("");function p(){if(u.value!==o.value.username){F().showPopup("Wrong input","error");return}a.deleteUser(o.value.username).then(k=>{F().showPopup(`User ${o.value.username} deleted`,"info"),g.value=!1,i.value=!1},k=>{console.log(k),F().showPopup(k,"error")})}const h=w(!1),v=w(""),f=w(Be[Math.floor(Math.random()*Be.length)]),x=w(""),$=w(!1),S=w(""),c=w(100);function _(){h.value=!1,v.value="",f.value=Be[Math.floor(Math.random()*Be.length)],x.value="",$.value=!1,S.value=""}function C(){if(v.value===""){F().showPopup("Please enter the username","error");return}const k=S.value.split(";").map(b=>b.trim());k.length===1&&k[0]===""&&k.splice(0,1),a.createUser(v.value,f.value,x.value,$.value,k,c.value).then(b=>{F().showPopup(`User ${v.value} created`,"success"),_()},b=>{console.log(b),F().showPopup(b,"error")})}return fe(()=>{a.reqUserList().then(k=>{t.value=k},k=>{console.log(k)})}),ie("add_user",k=>{const b=k.user_info;t.value.push(b)}),ie("update_user",k=>{const b=k.user_info;t.value.map((I,W)=>{I.id===b.id&&(t.value[W]=b)})}),ie("delete_user",k=>{const b=k.username;t.value=t.value.filter(I=>I.username!==b)}),(k,b)=>(m(),y("div",ll,[D(we,{show:i.value,"onUpdate:show":b[4]||(b[4]=I=>i.value=I),title:"editor",onOnAccept:d,onOnCancel:b[5]||(b[5]=()=>i.value=!1)},{default:E(()=>[n("div",ul,[n("div",cl,[n("img",{src:`${P(Ue)()}/user-avatar/${o.value.username}?size=128`,alt:"",class:"avatar-big"},null,8,dl),n("div",hl,[n("div",pl,[n("h2",null,T(o.value.name),1),B(" ("+T(o.value.username)+") ",1)]),n("div",fl,[ml,D(Ae,{checked:o.value.is_admin,"onUpdate:checked":b[0]||(b[0]=I=>o.value.is_admin=I)},null,8,["checked"])]),n("div",vl,[gl,_l,N(n("input",{type:"number","onUpdate:modelValue":b[1]||(b[1]=I=>o.value.max_storage=I)},null,512),[[J,o.value.max_storage]])]),o.value.is_admin?R("",!0):(m(),y("div",yl,[wl,n("div",bl,[D(P(Ye),{style:{width:"100%"},"content-editable":!o.value.is_admin,onFinish:b[2]||(b[2]=I=>l(I))},{default:E(()=>[B(T(o.value.mandatory_tags.join("; ")),1)]),_:1},8,["content-editable"])])]))])]),n("input",{id:"delete-user-button",type:"button",value:"Delete user",onClick:b[3]||(b[3]=()=>{g.value=!0})})])]),_:1},8,["show"]),D(we,{show:g.value,"onUpdate:show":b[7]||(b[7]=I=>g.value=I),title:"Delete user",onOnCancel:b[8]||(b[8]=()=>{g.value=!1,u.value=""}),onOnClose:b[9]||(b[9]=()=>{g.value=!1,u.value=""}),onOnAccept:p},{default:E(()=>[n("div",kl,[n("p",null,[B(" Are you sure to delete user "),n("b",null,T(o.value.name)+" ("+T(o.value.username)+")",1),B("? "),$l]),Sl,B(" Type "),n("b",null,T(o.value.username),1),B(" to confirm: "),N(n("input",{type:"text",id:"delete-user-input","onUpdate:modelValue":b[6]||(b[6]=I=>u.value=I),autocomplete:"off"},null,512),[[J,u.value]])])]),_:1},8,["show"]),D(we,{show:h.value,"onUpdate:show":b[16]||(b[16]=I=>h.value=I),onOnCancel:_,onOnAccept:C,onOnClose:_},{default:E(()=>[n("div",xl,[n("table",Cl,[n("tr",null,[Dl,n("td",null,[N(n("input",{type:"text","onUpdate:modelValue":b[10]||(b[10]=I=>v.value=I),autocomplete:"off",class:"create-user-input"},null,512),[[J,v.value]])])]),n("tr",null,[Pl,n("td",null,[N(n("input",{type:"text","onUpdate:modelValue":b[11]||(b[11]=I=>f.value=I),autocomplete:"off",class:"create-user-input"},null,512),[[J,f.value]])])]),n("tr",null,[Il,n("td",null,[N(n("input",{type:"text","onUpdate:modelValue":b[12]||(b[12]=I=>x.value=I),autocomplete:"off",class:"create-user-input"},null,512),[[J,x.value]])])]),n("tr",null,[Tl,n("td",null,[N(n("input",{type:"text","onUpdate:modelValue":b[13]||(b[13]=I=>c.value=I),autocomplete:"off",class:"create-user-input"},null,512),[[J,c.value]])])]),n("tr",null,[Ul,n("td",null,[N(n("input",{type:"text","onUpdate:modelValue":b[14]||(b[14]=I=>S.value=I),autocomplete:"off",class:"create-user-input",placeholder:"Separate with semicolon ';'"},null,512),[[J,S.value]])])]),n("tr",null,[Al,n("td",Ml,[D(Ae,{checked:$.value,"onUpdate:checked":b[15]||(b[15]=I=>$.value=I)},null,8,["checked"])])])])])]),_:1},8,["show"]),n("div",Ll,[Bl,e.value?(m(),y("div",{key:0,id:"add-user-div",onClick:b[17]||(b[17]=()=>h.value=!0)},"+")):R("",!0)]),n("table",null,[n("tr",null,[e.value?(m(),y("th",Rl)):R("",!0),El,ql,Ol,Fl,zl]),(m(!0),y(j,null,ee(t.value,I=>(m(),y("tr",Hl,[e.value?(m(),y("td",Nl,[n("div",{class:"edit-button",onClick:()=>r(I)},[n("img",{src:P(rl),alt:"",class:"icon"},null,8,jl)],8,Wl)])):R("",!0),n("td",null,[n("div",Kl,[n("img",{src:`${P(Ue)()}/user-avatar/${I.username}?size=60`,alt:"",class:"avatar"},null,8,Vl)])]),n("td",Zl,T(I.username),1),n("td",null,T(I.name),1),n("td",Gl,T(I.max_storage/1024/1024>1024?`${(I.max_storage/1024/1024/1024).toFixed(1)} G`:`${(I.max_storage/1024/1024).toFixed(0)} M`),1),n("td",null,[I.is_admin?(m(),y("label",Jl,"ADMIN")):(m(),V(bt,{key:0,tags:I.mandatory_tags,"max-width":200,"middle-align":!0},null,8,["tags"]))])]))),256)),n("tr",null,[t.value.length===0?(m(),y("td",Ql," No users ")):R("",!0)])])]))}}),Dt=q(Yl,[["__scopeId","data-v-43baa4c1"]]),re=s=>(ne("data-v-b2c44072"),s=s(),ae(),s),Xl={class:"toolbar"},eu={id:"about-main",class:"slideIn"},tu=re(()=>n("h1",null,"About",-1)),nu={id:"about-div",class:"content"},au=re(()=>n("br",null,null,-1)),su=re(()=>n("a",{href:"https://github.com/MenxLi/Lires",target:"_blank"},"GitHub - MenxLi/Lires",-1)),ou=re(()=>n("br",null,null,-1)),iu=["href"],ru=re(()=>n("br",null,null,-1)),lu=["href"],uu=re(()=>n("br",null,null,-1)),cu=re(()=>n("b",null,"Server status: ",-1)),du=re(()=>n("b",null,"Backend",-1)),hu=re(()=>n("b",null,"Version",-1)),pu=re(()=>n("b",null,"Uptime",-1)),fu=re(()=>n("b",null,"Connection count",-1)),mu={key:0},vu=re(()=>n("summary",null,"User management",-1)),gu={style:{border:"1px solid var(--color-border)","border-radius":"10px",display:"flex","justify-content":"center",margin:"10px",padding:"10px",width:"100%"}},_u={id:"versionHistory",class:"content"},yu={class:"block"},wu={key:0},bu={key:1},ku=L({__name:"About",setup(s){const t=w([]),e=w(!1),a=G().conn,i=()=>{a.changelog().then(u=>{t.value=u},u=>{console.error(u)})},o=w(-1),r=A(()=>{if(o.value===-1)return"N/A";const u=Math.floor(o.value/3600),p=Math.floor((o.value-u*3600)/60),h=Math.floor(o.value-u*3600-p*60);return`${u}h ${p}m ${h}s`}),l=w({backend:Ue(),version:"",uptime:r,_uptime:-1,numDocs:-1,numConnections:-1}),d=()=>{a.status().then(u=>{o.value=u.uptime,l.value.version=u.version,l.value.numDocs=u.n_data,l.value.numConnections=u.n_connections},u=>{console.error(u)})},g=A(()=>t.value.slice().reverse());return i(),d(),window.setInterval(()=>o.value++,1e3),ie("login",()=>l.value.numConnections++),ie("logout",()=>l.value.numConnections--),(u,p)=>(m(),y(j,null,[n("div",Xl,[D(Me)]),n("div",eu,[tu,n("div",nu,[n("p",null,[B(" Lires is a self-hosted web application for research literature management. "),au,B(" It is open source and available at "),su,B(". "),ou,B(" The user manual for web interface is available at "),n("a",{href:P(oo),target:"_blank"},"here",8,iu),B(". "),ru,B(" It also provides "),n("a",{href:P(H)().backend()+`/api/api.zip?key=${P(H)().encKey}`}," API ",8,lu),B(" for programmatic access. "),uu]),n("p",null,[cu,n("ul",null,[n("li",null,[du,B(": "+T(l.value.backend),1)]),n("li",null,[hu,B(": "+T(l.value.version),1)]),n("li",null,[pu,B(": "+T(l.value.uptime),1)]),n("li",null,[fu,B(": "+T(l.value.numConnections),1)])])]),n("a",{onClick:p[0]||(p[0]=h=>e.value=!0),style:{cursor:"pointer"}},"View change log"),P(K)().user.is_admin?(m(),y("details",mu,[vu,n("div",gu,[D(Dt)])])):R("",!0)]),D(xe,{show:e.value,"onUpdate:show":p[1]||(p[1]=h=>e.value=h),title:"Change log"},{default:E(()=>[n("div",_u,[(m(!0),y(j,null,ee(g.value.length,h=>(m(),y("div",yu,[n("h2",null,T(g.value[h-1][0].toString()),1),n("ul",null,[(m(!0),y(j,null,ee(g.value[h-1][1],v=>(m(),y("li",null,[typeof v=="string"?(m(),y("div",wu,T(v),1)):typeof v=="object"?(m(),y("div",bu,[B(T(Object.keys(v)[0])+" ",1),n("ul",null,[(m(!0),y(j,null,ee(v[Object.keys(v)[0]],f=>(m(),y("li",null,T(f),1))),256))])])):R("",!0)]))),256))])]))),256))])]),_:1},8,["show"])])],64))}}),$u=q(ku,[["__scopeId","data-v-b2c44072"]]),Su={},xu={id:"widget-container-main"};function Cu(s,t){return m(),y("div",xu,[pe(s.$slots,"default",{},void 0,!0)])}const Du=q(Su,[["render",Cu],["__scopeId","data-v-257ac3c4"]]),Pu={id:"main-dashboard",class:"slideIn"},Iu=L({__name:"Dashboard",setup(s){return(t,e)=>(m(),y(j,null,[D(Me),n("div",Pu,[D(Du,null,{default:E(()=>[D(Dt)]),_:1})])],64))}}),Tu=q(Iu,[["__scopeId","data-v-6b501763"]]),Uu={class:"editor-block"},Au={class:"editor-toolbar"},Mu={id:"editor-body"},Lu={key:0,id:"editor-input",class:"body-area"},Bu={key:1,id:"editor-preview",class:"body-area"},Ru=["innerHTML"],Eu=L({__name:"EditorBlock",props:at({preRenderFn:{type:Function,default:s=>s},theme:{default:"light"}},{text:{default:""},textModifiers:{},preview:{type:Boolean,default:!1},previewModifiers:{}}),emits:at(["on-input","on-save","on-upload-images"],["update:text","update:preview"]),setup(s,{expose:t,emit:e}){const a=s,i=st(s,"text"),o=st(s,"preview"),r=w(a.preRenderFn(i.value));te(()=>i.value,p=>{r.value=Vt().render(a.preRenderFn(p))});const l=e;function d(p){l("on-upload-images",[p])}const g=w(null);function u(p){const h=g.value.selectionStart,v=g.value.selectionEnd,f=p.substring(0,h),x=p.substring(v,p.length);p=f+p+x,g.value.value=p}return t({insert:u}),(p,h)=>(m(),y("div",Uu,[n("div",Au,[n("button",{onClick:h[0]||(h[0]=v=>l("on-save",i.value))},"Save"),n("button",{onClick:h[1]||(h[1]=v=>o.value=!o.value)},"Toggle Preview"),D(P(be),{action:d})]),n("div",Mu,[o.value?(m(),y("div",Bu,[n("div",{innerHTML:r.value},null,8,Ru)])):(m(),y("div",Lu,[N(n("textarea",{"onUpdate:modelValue":h[2]||(h[2]=v=>i.value=v),onInput:h[3]||(h[3]=v=>l("on-input",i.value)),ref_key:"textarea",ref:g},null,544),[[J,i.value]])]))])]))}}),qu=q(Eu,[["__scopeId","data-v-5cb2f3c3"]]),Ou={key:0,class:"test"},Fu={key:1},zu=L({__name:"_Test",setup(s){const e=w(""),a=w(!1);function i(){console.log("Note saved")}const o=async r=>{console.log("Images uploaded",r)};return(r,l)=>P(!1)?(m(),y("div",Ou,[D(Ae,{checked:a.value,"onUpdate:checked":l[0]||(l[0]=d=>a.value=d)},null,8,["checked"]),D(qu,{text:e.value,"onUpdate:text":l[1]||(l[1]=d=>e.value=d),preview:a.value,"onUpdate:preview":l[2]||(l[2]=d=>a.value=d),onOnSave:i,onOnUploadImages:o},null,8,["text","preview"])])):(m(),y("p",Fu," Test is not available in production "))}}),Hu=[{path:"/",component:Ui},{path:"/feed",component:hr},{path:"/login",component:Tr},{path:"/reader/:id",component:il},{path:"/about",component:$u},{path:"/dashboard/:username",component:Tu},{path:"/_test",component:zu}],Nu=zt({history:Ht(),routes:Hu}),Wu=Ft();Ot(yn).use(Wu).use(Nu).mount("#app");
