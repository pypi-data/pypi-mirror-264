Metadata-Version: 2.1
Name: esqt
Version: 0.11.0
Requires-Python: >=3.9
Description-Content-Type: text/markdown
Requires-Dist: elasticsearch ==6.8.2
Requires-Dist: typer >=0.10.0
Requires-Dist: uvicorn >=0.29.0

# esqt - Elasticsearch Query Tool

[![pypi](https://img.shields.io/pypi/v/esqt.svg)](https://pypi.python.org/pypi/esqt)

## CLI

```sh
pipx install esqt
```

---

## `s` - scan (search) / source

```sh
cat <<EOF | esqt s localhost -d - | jq -c
{
  "query": {
    "bool": {
      "filter": [
        {
          "terms": {
            "itemTimestamp": [
              1707006570
            ]
          }
        }
      ]
    }
  }
}

EOF
```

## `q` - perform_request (request path)

```sh
esqt q localhost -X GET -P _cat/indices -p 'pretty=&format=json&v&s=index' | jq
```

## `t` - streaming_bulk (bulk) / target

```sh
esqt s localhost -d __.conf.json | esqt t localhost -d - | jq -c
```

```py
# dev.py
import json
import typing as t

from esqt import ActionHandler

class MyHandler(ActionHandler):
    def handle_one(self, action: str):
        obj = json.loads(action)
        prefix = 'new-'
        if not t.cast(str, obj['_index']).startswith(prefix):
            self.print(f'prefixing {obj["_index"]!r}')
            obj['_index'] = prefix + obj['_index']
        return obj
```

```sh
esqt s localhost -d __.conf.json | esqt t localhost -d - -H dev:MyHandler | jq -c
```
