"use strict";(self.webpackChunklino_react=self.webpackChunklino_react||[]).push([[2617],{2756:(t,e,s)=>{s.r(e),s.d(e,{ABCComponent:()=>_,Labeled:()=>c,LeafComponentBase:()=>m,LeafComponentDelayedValue:()=>I,LeafComponentInput:()=>g,LeafComponentInputChoices:()=>R,maintainTableWidth:()=>d,name:()=>h});var i=s(5247),l=s(7881),n=s.n(l),a=s(6606),o=s(1151),r=s(3748);const h="LinoComponentUtils";let u;u={classNames:s.e(4166).then(s.t.bind(s,8041,23)),queryString:Promise.all([s.e(4166),s.e(2298)]).then(s.bind(s,9320)),prDropdown:Promise.all([s.e(7134),s.e(5573),s.e(7236),s.e(4600),s.e(4292),s.e(3454),s.e(5350)]).then(s.bind(s,5384)),prInputText:Promise.all([s.e(9109),s.e(5573),s.e(7236),s.e(4600),s.e(2123)]).then(s.bind(s,8016))};function p(t){return e=>{e.data.hasOwnProperty("master_data")&&t.props[o.URL_PARAM_WINDOW_TYPE]!==o.WINDOW_TYPE_TABLE&&Object.keys(e.data.master_data).includes(t.props.elem.name)&&t.setState({value:e.data.master_data[t.props.elem.name]})}}function d(t,e){let s;s=void 0!==t?t:this;let i=Object.keys(s.flexs);(void 0!==e?i.length===e:i.length>1)&&i.forEach((t=>{var e=document.getElementById(t).getElementsByClassName("p-datatable");if(1===e.length){(e=e[0]).getBoundingClientRect().width/document.getElementsByClassName("layout-topbar")[0].getBoundingClientRect().width>s.flexs[t]&&Array.from(e.querySelectorAll(".p-datatable table")).forEach((t=>{Array.from(t.classList).join(" ").includes("p-datatable")&&t.style.setProperty("table-layout","auto")}))}}))}(0,a.RegisterImportPool)(u);const c=t=>{const e=(0,a.getExReady)(u,["classNames"]);let s=t.label||t.elem.label;return e.ready?(0,r.jsxs)(i.Fragment,{children:[!t.hide_label&&s&&(0,r.jsxs)(i.Fragment,{children:[(0,r.jsxs)("label",{className:e.classNames.default("l-label",{"l-label--unfilled":!t.isFilled}),title:Object.assign({},t.elem.value||{}).quicktip||t.elem.help_text,children:[s,":"]}),t.helpText&&(0,r.jsx)("span",{style:{float:"right",cursor:"pointer"},title:t.helpText,children:"?"}),(0,r.jsx)("br",{})]}),t.children]}):null};c.propTypes={label:n().string,elem:n().object.isRequired,hide_label:n().bool,isFilled:n().bool,helpText:n().string,children:n().element.isRequired},c.defaultProps={hide_label:!1,isFilled:!1};class _{static getValueByName({name:t,props:e,context:s}){return e[o.URL_PARAM_WINDOW_TYPE]===o.WINDOW_TYPE_PARAMS?s.param_values[t]:e[o.URL_PARAM_WINDOW_TYPE]===o.WINDOW_TYPE_TABLE?s.rows[e.column.rowIndex][t]:e[o.URL_PARAM_WINDOW_TYPE]===o.WINDOW_TYPE_CARDS?s[t]:s.data[t]}}class m extends a.Component{constructor(t){super(t),this.filled=()=>!["",null,void 0].includes(this.getValue()),this.wrapperClasses=[],this.dataKey=t[o.URL_PARAM_WINDOW_TYPE]===o.WINDOW_TYPE_TABLE?t.elem.fields_index:t.elem.name,this.upController=t.urlParams.controller,this.filled=this.filled.bind(this),this.getValue=this.getValue.bind(this),this.getValueByName=this.getValueByName.bind(this),this.innerHTML=this.innerHTML.bind(this),this.setLeafRef=this.setLeafRef.bind(this)}getValueByName(t){return _.getValueByName({name:t,props:this.props,context:this.context})}getValue(){return this.getValueByName(this.dataKey)}innerHTML(t,e={}){let s=this.getValue()||" ";return s instanceof Object&&(s=JSON.stringify(s)),t?(0,r.jsx)("div",{style:e,dangerouslySetInnerHTML:{__html:s}}):(0,r.jsx)("div",{style:e,children:s})}setLeafRef({input:t=!1,type:e=""}={}){this.props[o.URL_PARAM_WINDOW_TYPE]===o.WINDOW_TYPE_DETAIL&&this.upController.dataContext.setLeafRef({name:"slave"===e?this.actorID:this.props.elem.name,ref:this,input:t,type:e})}}m.requiredModules=["classNames"],m.iPool=u,m.contextType=a.DataContextType,m.propTypesFromLinoLayout={column:n().object,editing_mode:n().bool,hide_label:n().bool,[o.URL_PARAM_WINDOW_TYPE]:n().oneOf([o.WINDOW_TYPE_TABLE,o.WINDOW_TYPE_DETAIL,o.WINDOW_TYPE_CARDS,o.WINDOW_TYPE_GALLERIA,o.WINDOW_TYPE_INSERT,o.WINDOW_TYPE_PARAMS,o.WINDOW_TYPE_UNKNOWN]),tabIndex:n().number.isRequired},m.propTypes={...m.propTypesFromLinoLayout,elem:n().object.isRequired,urlParams:n().object.isRequired},m.defaultProps={editing_mode:!1,hide_label:!1,[o.URL_PARAM_WINDOW_TYPE]:o.WINDOW_TYPE_UNKNOWN};class I extends m{constructor(t){super(t),this.liveUpdate=t=>{(null===t.mk||t.mk===this.state.mk&&t.mt===this.state.mt)&&this.update()},this.state={...this.state,value:null,data_url:null,mk:t.urlParams.pk,mt:this.upController.static.actorData.content_type},this.actorID=t.elem.actor_id||(t.elem.name.includes(".")?t.elem.name:`${t.urlParams.packId}.${t.elem.name}`),this.shouldComponentUpdate=this.shouldComponentUpdate.bind(this),this.getData=this.getData.bind(this),this.getValue=this.getValue.bind(this),this.update=this.update.bind(this)}async prepare(){await super.prepare();let t=super.getValue();this.upController.filled(t)&&(this.delayed=t.hasOwnProperty("delayed_value_url"))}onReady(){let t=super.getValue();this.delayed?(this.setLeafRef({type:"slave"}),this.getData(t.delayed_value_url),this.upController.globals.panels[this.actorID]=this):this.setState({value:t})}shouldComponentUpdate(t,e){return this.delayed?this.state.value!==e.value||null!==this.state.value&&super.getValue().delayed_value_url!==this.state.data_url:this.state.value!==super.getValue()}componentDidUpdate(t,e){this.delayed?this.state.data_url!==super.getValue().delayed_value_url&&(this.setState({value:null}),this.update()):this.setState({value:super.getValue()})}componentWillUnmount(){delete this.upController.globals.panels[this.actorID]}getValue(){return this.state.value}getData(t){this.upController.actionHandler.silentFetch({path:`${t}?${this.ex.queryString.default.stringify(this.upController.actionHandler.defaultStaticParams())}`}).then((e=>{this.setState({value:e.data,data_url:t})}))}update(){this.getData(super.getValue().delayed_value_url)}}I.requiredModules=["queryString"].concat(m.requiredModules);class g extends m{constructor(t){super(t),this.onKeyDown=t=>null,this.styleClasses=["disabled-input","l-card","unsaved-modification"],this.componentWillUnmount=this.componentWillUnmount.bind(this),this.disabled=this.disabled.bind(this),this.filled=this.filled.bind(this),this.focus=this.focus.bind(this),this.getCellStyleClasses=this.getCellStyleClasses.bind(this),this.getInput=this.getInput.bind(this),this.onChangeUpdate=this.onChangeUpdate.bind(this),this.onInputRef=this.onInputRef.bind(this),this.onRef=this.onRef.bind(this),this.setCellStyle=this.setCellStyle.bind(this),this.submit=this.submit.bind(this),this.tabIndexMatch=this.tabIndexMatch.bind(this),this.update=this.update.bind(this)}async prepare(){this.inputState={inputComponent:this.ex.prInputText.InputText,inputOnly:!1,inputProps:{},onChangeUpdateAssert:t=>!0,postOnChange:t=>null},window.addEventListener("message",p(this))}componentWillUnmount(){window.removeEventListener("message",p(this))}disabled(){if(this.props[o.URL_PARAM_WINDOW_TYPE]===o.WINDOW_TYPE_CARDS)return!0;if(this.props[o.URL_PARAM_WINDOW_TYPE]===o.WINDOW_TYPE_PARAMS)return!1;if(!this.props.elem.editable)return!0;if(this.props[o.URL_PARAM_WINDOW_TYPE]===o.WINDOW_TYPE_TABLE){let t=this.context.rows[this.props.column.rowIndex],e=t[t.length-1];return!(!e||!e.meta)&&(!!t[t.length-2]||(t[t.length-3][this.props.elem.name]||!1))}return!!this.context.data.disable_editing||(this.context.data.disabled_fields[this.props.elem.name]||!1)}focus(){let t=this.inputEl;t.focus?t.focus():t.focusInput?t.focusInput.focus():t.inputRef&&t.inputRef.current.focus()}getCellStyleClasses(){let t=[];return this.props[o.URL_PARAM_WINDOW_TYPE]===o.WINDOW_TYPE_TABLE?this.context.modifiedRows[this.props.column.rowIndex].includes(this.props.elem.fields_index)&&t.push("unsaved-modification"):(t.push("l-card"),this.props[o.URL_PARAM_WINDOW_TYPE]!==o.WINDOW_TYPE_CARDS&&(this.disabled()?t.push("disabled-input"):this.context.modified.includes(this.props.elem.name)&&t.push("unsaved-modification"))),t}getInput(){return(0,r.jsx)(this.inputState.inputComponent,{autoFocus:this.props[o.URL_PARAM_WINDOW_TYPE]===o.WINDOW_TYPE_TABLE||void 0,onChange:t=>{this.inputState.onChangeUpdateAssert(t)&&(this.onChangeUpdate(t),this.inputState.postOnChange(t))},ref:this.onInputRef,style:{width:"100%"},tabIndex:this.props.tabIndex,value:this.getValue()||"",...this.inputState.inputProps})}onChangeUpdate(t){this.update({[this.dataKey]:t.target.value}),this.setState({})}onInputRef(t){this.inputEl=t,t&&this.tabIndexMatch()&&this.focus()}onRef(t){const e=()=>{this.container.onclick=t=>{this.disabled()||(Object.assign(this.upController.globals,{currentInputRowIndex:Object.assign({rowIndex:0},this.props.column).rowIndex,currentInputTabIndex:this.props.tabIndex,currentInputWindowType:this.props[o.URL_PARAM_WINDOW_TYPE],currentInputAHRefName:this.upController.actionHandler.refName}),this.props[o.URL_PARAM_WINDOW_TYPE]!==o.WINDOW_TYPE_DETAIL||this.props.editing_mode||this.upController.history.replaceState({editing_mode:!0}))}};t&&(this.container=t,this.props[o.URL_PARAM_WINDOW_TYPE]===o.WINDOW_TYPE_TABLE?(this.container=t.closest("td"),e()):this.props[o.URL_PARAM_WINDOW_TYPE]===o.WINDOW_TYPE_DETAIL&&e()),this.setCellStyle(this.container)}setCellStyle(t){if(t){let e=this.getCellStyleClasses();this.styleClasses.forEach((e=>{t.classList.remove(e)})),e.forEach((e=>{t.classList.add(e)}))}}submit(){this.upController.actionHandler.submit({cellInfo:{rowIndex:this.props.column.rowIndex}})}tabIndexMatch(){return(this.props[o.URL_PARAM_WINDOW_TYPE]!==o.WINDOW_TYPE_TABLE||this.props.column.rowIndex===this.upController.globals.currentInputRowIndex)&&(this.props[o.URL_PARAM_WINDOW_TYPE]===this.upController.globals.currentInputWindowType&&this.upController.actionHandler.refName===this.upController.globals.currentInputAHRefName&&this.props.tabIndex===this.upController.globals.currentInputTabIndex)}update(t){this.upController.actionHandler.update({values:t,elem:this.props.elem,col:this.props.column,windowType:this.props[o.URL_PARAM_WINDOW_TYPE]})}render(){return this.state.ready?(this.container&&this.setCellStyle(this.container),(0,r.jsx)(c,{...this.props,elem:this.props.elem,isFilled:this.filled(),children:(0,r.jsx)("div",{className:this.ex.classNames.default(this.wrapperClasses),onKeyDown:this.onKeyDown,ref:this.onRef,children:this.inputState.inputOnly||this.props.editing_mode&&!this.disabled()?this.getInput():this.innerHTML()})})):null}}g.requiredModules=["prInputText"].concat(m.requiredModules);class R extends g{constructor(t){super(t),this.wrapperClasses.push("l-ChoiceListFieldElement"),this.state={...this.state,hidden_value:null},this.dataKeyHidden=t[o.URL_PARAM_WINDOW_TYPE]===o.WINDOW_TYPE_TABLE?t.elem.fields_index_hidden:t.elem.name+"Hidden",this.getInput=this.getInput.bind(this),this.getValue=this.getValue.bind(this),this.innerHTML=this.innerHTML.bind(this)}getValue(){return{text:super.getValue(),value:this.getValueByName(this.dataKeyHidden)}}getInput(){return(0,r.jsx)(this.ex.prDropdown.Dropdown,{onChange:t=>{t.originalEvent.ctrlKey||t.originalEvent.altKey||(this.update({[this.dataKey]:t.value,[this.dataKeyHidden]:t.value}),this.setState({}))},optionLabel:"text",options:this.options,ref:this.onInputRef,showClear:this.props.elem.field_options.allowBlank,style:{width:"100%"},tabIndex:this.props.tabIndex,value:this.getValue().value})}innerHTML(){let t=super.getValue()||" ";return(0,r.jsx)("div",{style:{whiteSpace:"nowrap"},children:t})}}R.requiredModules=["prDropdown"].concat(g.requiredModules)},2617:function(t,e,s){var i=this&&this.__createBinding||(Object.create?function(t,e,s,i){void 0===i&&(i=s);var l=Object.getOwnPropertyDescriptor(e,s);l&&!("get"in l?!e.__esModule:l.writable||l.configurable)||(l={enumerable:!0,get:function(){return e[s]}}),Object.defineProperty(t,i,l)}:function(t,e,s,i){void 0===i&&(i=s),t[i]=e[s]}),l=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),n=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var s in t)"default"!==s&&Object.prototype.hasOwnProperty.call(t,s)&&i(e,t,s);return l(e,t),e},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.QuickFilter=e.AutoComplete=e.name=void 0,e.name="AutoComplete";const o=a(s(5247)),r=a(s(7881)),h=s(6606),u=s(2756),p=n(s(1151));let d;d={queryString:Promise.resolve().then((()=>n(s(9320)))),prAutoComplete:Promise.resolve().then((()=>n(s(8282)))),AbortController:Promise.resolve().then((()=>n(s(1181))))};(0,h.RegisterImportPool)(d);class c extends u.LeafComponentInput{constructor(t){super(t),this.onKeyDown=t=>{if("ArrowDown"===t.key||"ArrowUp"===t.key){if(this.inputEl&&!this.inputEl.getOverlay())this.state.rows.length||this.getChoices(this.state[p.URL_PARAM_FILTER]),this.inputEl.show();else if(!this.state.lazyLoading){let t=this.scroller.getElementRef().current.querySelector("li.p-highlight");if(t){let{top:e,bottom:s}=this.scroller.getElementRef().current.getBoundingClientRect(),i=t.getBoundingClientRect();i.top<e?t.scrollIntoView(!0):i.bottom>s&&t.scrollIntoView(!1)}}t.stopPropagation()}},this.itemTemplate=(t,e)=>{let s="object"==typeof t?t.text:t;return o.default.createElement("div",null,s||" ")},this.getChoices=(t,e)=>{this.controller.abort(),this.controller=new this.ex.AbortController.default;let s=(e=e||this.state[p.URL_PARAM_LIMIT])===this.state[p.URL_PARAM_LIMIT]?this.state[p.URL_PARAM_START]:this.state[p.URL_PARAM_LIMIT];this.upController.actionHandler.silentFetch({path:this.choicesURL(t,s,e),signal:this.controller.signal}).then((s=>{let i=s.rows;this.state.rows.length&&(i=i.filter((t=>""!==t.text&&null!==t.value))),i=this.state.rows.concat(i),(this.props.elem.field_options||{}).allowCreate&&0===i.filter((e=>e.text==t)).length&&i.unshift({text:t,value:t}),this.setState({[p.URL_PARAM_FILTER]:t,[p.URL_PARAM_LIMIT]:e,count:s.count,lazyLoading:!1,rows:i})}))},this.state={...this.state,count:999,[p.URL_PARAM_FILTER]:"",[p.URL_PARAM_LIMIT]:15,[p.URL_PARAM_START]:0,lazyLoading:!1,rows:[],value:null},this.hasClearButton=!1,this.getChoices=this.getChoices.bind(this),this.getInput=this.getInput.bind(this),this.itemTemplate=this.itemTemplate.bind(this),this.onKeyDown=this.onKeyDown.bind(this)}onReady(){if(this.hasClearButton&&!this.clear)throw"clear NotImplemented";let t=this.getValue();this.setState({[p.URL_PARAM_FILTER]:t.text,[p.URL_PARAM_LIMIT]:this.props.urlParams[p.URL_PARAM_LIMIT],value:t}),this.controller=new this.ex.AbortController.default}getInput(t={}){return null===this.state.value?null:o.default.createElement(o.default.Fragment,null,o.default.createElement(this.ex.prAutoComplete.AutoComplete,{completeMethod:t=>{"click"===t.originalEvent.type&&this.state.rows.length?this.inputEl.show():(this.state.rows=[],this.getChoices(t.query,this.state[p.URL_PARAM_LIMIT]))},dropdown:!0,field:"text",itemTemplate:this.itemTemplate,onChange:t=>this.setState({value:Object.assign(this.state.value,{text:t.value,value:null}),rows:[],[p.URL_PARAM_LIMIT]:this.props.urlParams[p.URL_PARAM_LIMIT]}),onSelect:this.onSelect,onShow:()=>{this.clearButton&&(this.clearButton.style.visibility="hidden")},ref:this.onInputRef,scrollHeight:"200px",suggestions:this.state.rows,tabIndex:this.props.tabIndex,value:this.state.value.text,virtualScrollerOptions:{itemSize:35,lazy:!0,loading:this.state.lazyLoading,onScrollIndexChange:t=>{let e=this.state[p.URL_PARAM_LIMIT];e-t.first<15&&!this.state.lazyLoading&&this.state.count>e&&(this.setState({lazyLoading:!0}),this.getChoices(this.state[p.URL_PARAM_FILTER],e+15))},ref:t=>this.scroller=t,scrollHeight:"195px",style:{minWidth:"30ch"}},...t}),this.hasClearButton&&this.props.elem.field_options.allowBlank&&this.state.value.text&&o.default.createElement("i",{key:this.state.touch,ref:t=>this.clearButton=t,className:"pi pi-times l-fk-clear",onClick:this.clear,style:{visibility:"visible",cursor:"pointer"}}))}}e.AutoComplete=c,c.requiredModules=["prAutoComplete","AbortController"].concat(u.LeafComponentInput.requiredModules),c.iPool=Object.assign(d,u.LeafComponentInput.iPool.copy());class _ extends c{constructor(t){super(t),this.wrapperClasses=["l-grid-quickfilter"],this.styleClasses=[],this.choicesURL=this.choicesURL.bind(this),this.getInput=this.getInput.bind(this),this.getValue=this.getValue.bind(this),this.onSelect=this.onSelect.bind(this)}getInput(){return super.getInput({placeholder:"QuickSearch",style:{width:this.props.wide?"100%":void 0,marginRight:this.props.wide?"1ch":void 0,marginLeft:this.props.wide?"1ch":void 0}})}getValue(){return{text:this.props.urlParams[p.URL_PARAM_FILTER],value:null}}choicesURL(t,e,s){return`choices/${this.props.urlParams.packId}/${this.props.urlParams.actorId}?${this.ex.queryString.default.stringify(Object.assign(this.upController.actionHandler.defaultStaticParams(),{[p.URL_PARAM_FILTER]:t,[p.URL_PARAM_START]:e,[p.URL_PARAM_LIMIT]:s}))}`}onSelect(t){let e=t.value.value,s=this.upController;s.history.pushPath({pathname:`/api/${this.props.urlParams.packId}/${this.props.urlParams.actorId}/${e}`,params:s.actionHandler.defaultStaticParams()})}render(){return this.state.ready?this.getInput():null}}e.QuickFilter=_,_.requiredModules=["queryString"].concat(c.requiredModules),_.propTypes={...c.propTypes,wide:r.default.bool},_.defaultProps={...c.defaultProps,editing_mode:!0,elem:{},tabIndex:0,wide:!1,[p.URL_PARAM_WINDOW_TYPE]:p.WINDOW_TYPE_UNKNOWN}}}]);
//# sourceMappingURL=main.2617.0c37e88fb0d25da2f7d1.js.map