"use strict";(self.webpackChunkneopyter=self.webpackChunkneopyter||[]).push([[336],{336:(e,t,o)=>{o.r(t),o.d(t,{default:()=>C});var n=o(979),s=o(228),l=o(976),r=o(933),a=o(989),c=o(743),i=o(195),d=o(502),u=o(473);class p extends Error{constructor(e){super(e),this.name="RPCError"}}const h="https://github.com/msgpack-rpc/msgpack-rpc/blob/master/spec.md";var g;!function(e){e[e.Request=0]="Request",e[e.Response=1]="Response",e[e.Notification=2]="Notification"}(g||(g={}));class y{constructor(e){this.dispatcher=e}start(e,...t){this.transport=new e(this,...t)}async dispatchMethod(e,t){if(!this.dispatcher[e.method]){const o=new p(`Method not found ${e.method}`);throw e.type===g.Request&&t&&t({type:g.Response,msgid:e.msgid,error:o,result:void 0}),o}try{const o=await this.dispatcher[e.method](...e.params);e.type===g.Request&&t&&t({type:g.Response,msgid:e.msgid,result:o})}catch(o){console.error(o),e.type===g.Request&&t&&t({type:g.Response,msgid:e.msgid,error:o})}}}class m{constructor(e){this.server=e}async onRequest(e){await this.server.dispatchMethod(e,(e=>{this.sendData(function(e){return e.type===g.Request?(0,u.encode)([e.type,e.msgid,e.method,e.params]):e.type===g.Response?(0,u.encode)([e.type,e.msgid,e.error?e.error.toString():void 0,e.result]):(0,u.encode)([e.type,e.method,e.params])}(e))}))}async onNotify(e){this.server.dispatchMethod(e)}}class b extends m{constructor(e,t){super(e),this.url=t,this.websocket=new WebSocket(this.url),this.websocket.binaryType="arraybuffer",this.readableStream=new ReadableStream({start:e=>{this.websocket.addEventListener("open",(e=>{this.onOpen(e)})),this.websocket.addEventListener("message",(t=>{const o=function(e){const t=atob(e);return Uint8Array.from(t,(e=>e.codePointAt(0)))}(t.data);e.enqueue(o)})),this.websocket.addEventListener("error",(e=>{throw this.onError(e),e})),this.websocket.addEventListener("close",(t=>{this.onClose(t),e.close()}))}}),setTimeout((async()=>{for await(const e of async function*(e){const t=(0,u.decodeMultiStream)(e);for await(const e of t){if(!Array.isArray(e)||4!==e.length&&3!==e.length)throw new p(`Invalid msgpack-rpc message: ${JSON.stringify(e)}, please reference ${h}`);const t=e[0];if(0!==t&&1!==t&&2!==t)throw new p(`Invalid msgpack-rpc message: ${JSON.stringify(e)}, please reference ${h}`);t===g.Request?yield{type:g.Request,msgid:e[1],method:e[2],params:e[3]}:t===g.Response?yield{type:g.Response,msgid:e[1],error:e[2],result:e[3]}:yield{type:g.Notification,method:e[1],params:e[2]}}}(this.readableStream))this.onRead(e)}),0)}async onRead(e){switch(e.type){case g.Request:await this.onRequest(e);break;case g.Notification:await this.onNotify(e);break;default:throw new p(`Unknown message: ${e}`)}}sendData(e){this.websocket.send(function(e){const t=String.fromCodePoint(...e);return btoa(t)}(e))}onOpen(e){console.log(`Connection to neopyter jupyter server by websocket ${this.websocket.url}`)}onError(e){console.error("Websocket error",e)}onClose(e){console.log(`DisConnection to neopyter jupyter server by websocket ${this.websocket.url}`)}}var w=o(153);class k extends w.SidePanel{constructor(e){super(),this.settingRegistry=e,this.id="neopyter-status-sidepanel",this.watchSettings()}async updatePanel(){const e=n.ServerConnection.makeSettings(),t=s.URLExt.join(e.baseUrl,"neopyter","get_server_info"),o=await fetch(t);if(this.content.node.textContent="",!o.ok){const e=document.createElement("p");return this.content.node.appendChild(e),void(e.textContent="Access API failed")}const{code:l,message:r,data:a}=await o.json();if(0!==l){const e=document.createElement("p");return this.content.node.appendChild(e),void(e.textContent=r)}for(const e of a.addrs){const t=document.createElement("p");this.content.node.appendChild(t),t.textContent=e}}async watchSettings(){let e={};const t=async t=>{e=t.composite,console.log("updateSettings",e);const o=n.ServerConnection.makeSettings(),l=o.baseUrl,r=s.URLExt.join(l,"neopyter","update_settings"),a=await n.ServerConnection.makeRequest(r,{method:"POST",body:JSON.stringify(e)},o);console.log(await a.json()),this.updatePanel()},o=await this.settingRegistry.load("neopyter:labplugin");o.changed.connect((()=>{t(o)})),t(o)}async restartServer(){}}const f=new w.LabIcon({name:"neopyter:status-page",svgstr:'<svg t="1704342603868" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1462" width="200" height="200"><path d="M512.416 409.472a239.914667 239.914667 0 1 1 0 479.786667 239.914667 239.914667 0 0 1 0-479.786667zM6.645333 371.925333l128.853334 152.490667a27.264 27.264 0 0 0 38.954666 2.901333c208.426667-186.837333 468.053333-186.837333 675.84 0a27.392 27.392 0 0 0 39.082667-2.901333l128.256-152.490667a27.562667 27.562667 0 0 0-3.2-38.656c-302.933333-264.704-702.378667-264.704-1005.013333 0a27.733333 27.733333 0 0 0-2.773334 38.656z" p-id="1463"></path></svg>\n'}),C=[{id:"neopyter:labplugin",description:"A JupyterLab extension.",autoStart:!0,requires:[l.ILabShell,a.IDocumentManager,r.INotebookTracker,l.ILayoutRestorer,c.ISettingRegistry,i.ICompletionProviderManager],activate:(e,t,l,a,c,i,u)=>{const p=u,h=p.getProviders();console.log("JupyterLab extension neopyter is activated!"),console.log("provider",p.getProviders());const g=h.get("CompletionProvider:kernel"),m=new k(i);m.title.caption="Neopyter",m.title.icon=f,e.shell.add(m,"right"),c&&c.add(m,"@neopyter/graphsidebar");const w=n.ServerConnection.makeSettings(),C=s.URLExt.join(w.wsUrl,"neopyter","channel");let v=a.currentWidget;t.currentChanged.connect((()=>{t.currentWidget instanceof r.NotebookPanel&&(v=t.currentWidget)}));const S=e=>{var t;let o;e&&(o=l.findWidget(e));let n=null==o?void 0:o.content;n||(null==v?void 0:v.isUntitled)&&(o=v,n=o.content);const s=null===(t=null==n?void 0:n.model)||void 0===t?void 0:t.sharedModel;if(!o||!s||!n)throw`Don't open ${e} and current don't select untitled ipynb`;return{notebookPanel:o,notebook:n,sharedModel:s}},R=(e,t)=>{const{notebook:o,sharedModel:n}=S(e),s=n.getCell(t);return{notebook:o,sharedNotebookModel:n,sharedModel:s}},x={getVersion:async()=>(await o.e(330).then(o.t.bind(o,330,19))).version,echo:e=>`hello: ${e}`,executeCommand:async(t,o)=>{await e.commands.execute(t,o)}},M={getCurrentNotebook:()=>{const e=v;if(e){const t=l.contextForWidget(e);return null==t?void 0:t.localPath}},isFileOpen:e=>!!l.findWidget(e),isFileExist:async e=>{try{return!!await l.services.contents.get(e)}catch(e){return e.response.status,console.log(e),!1}},createNew:(e,t,o)=>l.createNew(e,t,o),openFile:e=>!!l.open(e),openOrReveal:e=>!!l.openOrReveal(e),activateNotebook:e=>{const{notebookPanel:o}=S(e);t.activateById(o.id),o.node.focus(),v=o},closeFile:async e=>await l.closeFile(e),selectAbove:()=>{const{notebook:e}=S();e&&r.NotebookActions.selectBelow(e)},selectBelow:()=>{const{notebook:e}=S();e&&r.NotebookActions.selectBelow(e)}},N={getCellNum:e=>S(e).sharedModel.cells.length,setCellNum:(e,t)=>{const{notebook:o,sharedModel:n}=S(e),s=n.cells.length;if(t>s)n.insertCells(s,d.range(0,t-s).map((()=>({cell_type:o.notebookConfig.defaultCell,metadata:"code"===o.notebookConfig.defaultCell?{trusted:!0}:{}}))));else for(;t<n.cells.length;)n.deleteCell(n.cells.length-1)},getCell:(e,t)=>{const{sharedModel:o}=R(e,t);return o.toJSON()},deleteCell:(e,t)=>S(e).sharedModel.deleteCell(t),insertCell:(e,t)=>{const{notebook:o,sharedModel:n}=S(e);return n.insertCell(t,{cell_type:o.notebookConfig.defaultCell,metadata:"code"===o.notebookConfig.defaultCell?{trusted:!0}:{}})},activateCell:(e,t)=>{const{notebook:o}=S(e);o.activeCellIndex=t},scrollToItem:(e,t,o,n)=>{const{notebook:s}=S(e);s.scrollToItem(t,o,n)},fullSync:(e,t)=>{const{notebook:o,sharedModel:n}=S(e);for(t.forEach(((e,t)=>{const s=n.getCell(t);s?void 0===e.cell_type||s.cell_type===e.cell_type?s.setSource(e.source):(n.deleteCell(t),n.insertCell(t,{cell_type:e.cell_type,source:e.source,metadata:s.getMetadata()})):n.insertCell(t,{cell_type:e.cell_type,source:e.source,metadata:"code"===o.notebookConfig.defaultCell?{trusted:!0}:{}})}));t.length<n.cells.length;)n.deleteCell(n.cells.length-1)},partialSync:(e,t,o,n)=>{const{notebook:s,sharedModel:l}=S(e);for(console.log(`partialSync: current cell num:${l.cells.length}, from:${t}(include), to:${o}(include), update to cell num:${n.length}`),n.forEach(((e,n)=>{const r=n+t,a=l.getCell(r);r<=o&&a?void 0===e.cell_type||a.cell_type===e.cell_type?a.setSource(e.source):(l.deleteCell(r),l.insertCell(r,{cell_type:e.cell_type,source:e.source,metadata:a.getMetadata()})):l.insertCell(r,{cell_type:e.cell_type,source:e.source,metadata:"code"===s.notebookConfig.defaultCell?{trusted:!0}:{}})}));o-t+1>n.length;)l.deleteCell(o),o-=1},save:async e=>{const{notebookPanel:t}=S(e),o=l.contextForWidget(t);return null==o||o.path,await(null==o?void 0:o.save())},runSelectedCell:async t=>await e.commands.execute("notebook:run-cell"),runAllAbove:async t=>await e.commands.execute("notebook:run-all-above"),runAllBelow:async t=>await e.commands.execute("notebook:run-all-below"),runAll:async t=>await e.commands.execute("notebook:run-all-cells"),restartKernel:async e=>{const{notebookPanel:t}=S(e);return await t.sessionContext.restartKernel()},restartRunAll:async t=>{const{notebookPanel:o}=S(t);return await o.sessionContext.restartKernel(),await e.commands.execute("notebook:run-all-cells")},setMode:(e,t)=>{const{notebookPanel:o}=S(e);o.content.mode=t},kernelComplete:async(e,t,o)=>{const{notebookPanel:n}=S(e);console.log("kernelComplete:",t,o);const s=await g.fetch({text:t,offset:o},{widget:n,session:n.sessionContext.session});return console.log(s),s.items}},P={setCellSource:(e,t,o)=>{const{sharedModel:n}=R(e,t);n.setSource(o)},setCellType:(e,t,o)=>{const{sharedNotebookModel:n,sharedModel:s}=R(e,t);s.cell_type!==o&&(n.deleteCell(t),n.insertCell(t,{cell_type:o,source:s.getSource(),metadata:s.getMetadata()}))}};Object.assign(x,M),Object.assign(x,N),Object.assign(x,P),new y(x).start(b,C)}}]}}]);