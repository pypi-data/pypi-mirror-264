"use strict";(self.webpackChunknucliadb_admin=self.webpackChunknucliadb_admin||[]).push([[64],{9064:(Ke,F,a)=>{a.r(F),a.d(F,{SyncModule:()=>je});var b=a(1368),C=a(2220),l=a(6504),_=a(6468),O=a(1828),u=a(3992),e=a(4496),k=a(4676),R=a(1632),A=a(4020),v=a(2064);const M=i=>({url:i});let X=(()=>{class i{constructor(t,n,s){this.sync=t,this.navigationService=n,this.router=s,this.localUrl=_.eA,this.serverUrl=new l.Ku(localStorage.getItem(_.uk)||"",{nonNullable:!0})}save(){this.sync.setSyncServer(this.serverUrl.value),this.back()}back(){this.navigationService.kbUrl.pipe((0,u.U)(1)).subscribe(t=>this.router.navigate([`${t}/upload`]))}static#e=this.\u0275fac=function(n){return new(n||i)(e.GI1(_.gH),e.GI1(O.wx),e.GI1(C.E5))};static#t=this.\u0275cmp=e.In1({type:i,selectors:[["nsy-server-setup"]],decls:18,vars:26,consts:[[1,"header"],["icon","chevron-left","aspect","basic",3,"paTooltip","click"],[1,"container"],[3,"innerHTML"],["placeholder","https://my.sync.server",3,"formControl","help"],["kind","primary",1,"save-button",3,"disabled","click"]],template:function(n,s){1&n&&(e.I0R(0,"div",0)(1,"pa-button",1),e.qCj("click",function(){return s.back()}),e.wVc(2,"translate"),e.OEk(3),e.wVc(4,"translate"),e.C$Y(),e.I0R(5,"h1"),e.OEk(6),e.wVc(7,"translate"),e.C$Y()(),e.I0R(8,"div",2),e.wR5(9,"p",3),e.wVc(10,"translate"),e.I0R(11,"pa-input",4),e.wVc(12,"translate"),e.OEk(13),e.wVc(14,"translate"),e.C$Y(),e.I0R(15,"pa-button",5),e.qCj("click",function(){return s.save()}),e.OEk(16),e.wVc(17,"translate"),e.C$Y()()),2&n&&(e.yG2(),e.E7m("paTooltip",e.kDX(2,9,"upload.server.back")),e.yG2(2),e.oRS(" ",e.kDX(4,11,"upload.server.back")," "),e.yG2(3),e.cNF(e.kDX(7,13,"upload.server.title")),e.yG2(3),e.E7m("innerHTML",e.kDX(10,15,"upload.server.description"),e.E3n),e.yG2(2),e.E7m("formControl",s.serverUrl)("help",e.g7$(12,17,"upload.server.help",e.S45(24,M,s.localUrl))),e.yG2(2),e.oRS(" ",e.kDX(14,20,"upload.server.url")," "),e.yG2(2),e.E7m("disabled",s.serverUrl.pristine),e.yG2(),e.oRS(" ",e.kDX(17,22,"generic.save")," "))},dependencies:[k.k,R.g,A.u,l.ue,l.ug,v.sD],styles:['@charset "UTF-8";.header[_ngcontent-%COMP%]{display:flex}p[_ngcontent-%COMP%]{margin-bottom:2rem}.container[_ngcontent-%COMP%]{max-width:40rem}.save-button[_ngcontent-%COMP%]{margin-top:1.5rem}'],changeDetection:0})}return i})();var h=a(7368),f=a(4704),w=a(5657),I=a(6684),V=a(3616),g=a(3394),U=a(3416),P=a(4555),Q=a(6576),G=a(9212),N=a(5568),T=a(2700),j=a(1056),x=a(9144),K=a(5672),L=a(7360),H=a(9040),W=a(6832),J=a(4180),q=a(874);const z=(i,o)=>o.index;function B(i,o){1&i&&(e.I0R(0,"div",4),e.wR5(1,"pa-icon",5),e.I0R(2,"div",6),e.OEk(3),e.wVc(4,"translate"),e.C$Y()()),2&i&&(e.yG2(3),e.oRS(" ",e.kDX(4,1,"upload.activity.no-folders")," "))}function Z(i,o){if(1&i){const t=e.KQA();e.I0R(0,"p"),e.OEk(1),e.wVc(2,"translate"),e.C$Y(),e.yuY(3,B,5,3,"div",2),e.wVc(4,"async"),e.wVc(5,"async"),e.I0R(6,"pa-button",3),e.qCj("click",function(){e.usT(t);const s=e.GaO();return e.CGJ(s.triggerSync())}),e.wVc(7,"async"),e.wVc(8,"async"),e.OEk(9),e.wVc(10,"translate"),e.C$Y()}if(2&i){const t=e.GaO();e.yG2(),e.cNF(e.kDX(2,4,"upload.activity.help")),e.yG2(2),e.C0Y(3,e.kDX(4,6,t.canSelectFiles)&&e.kDX(5,8,t.noFolderSelected)?3:-1),e.yG2(3),e.E7m("disabled",t.syncing||e.kDX(7,10,t.canSelectFiles)&&e.kDX(8,12,t.noFolderSelected)),e.yG2(3),e.oRS(" ",e.kDX(10,14,"upload.activity.sync-now")," ")}}function ee(i,o){if(1&i&&(e.I0R(0,"pa-table-row")(1,"pa-table-cell"),e.wR5(2,"pa-icon",7),e.C$Y(),e.I0R(3,"pa-table-cell"),e.wR5(4,"pa-datetime",8),e.C$Y(),e.I0R(5,"pa-table-cell"),e.OEk(6),e.C$Y()()),2&i){const t=o.$implicit;e.yG2(2),e.E7m("name",t.icon),e.yG2(2),e.E7m("datetime",t.date),e.yG2(2),e.cNF(t.message)}}let te=(()=>{class i{constructor(t,n,s,c){this.syncService=t,this.cdr=n,this.router=s,this.toast=c,this.unsubscribeAll=new w.E,this.since="",this.currentIndex=0,this.logs=[],this.syncing=!1,this.currentSync=this.syncService.getCurrentSync(),this.canSelectFiles=this.syncService.currentSourceId.pipe((0,f.k)(r=>this.syncService.canSelectFiles(r||""))),this.noFolderSelected=this.currentSync.pipe((0,f.k)(r=>!r.foldersToSync||0===r.foldersToSync.length)),this.disabled=this.currentSync.pipe((0,f.k)(r=>!!r.disabled))}ngOnInit(){this.router.events.pipe((0,I.I)(t=>t instanceof C.MT),(0,G.y)(()=>{this.since="",this.logs=[],this.cdr.markForCheck()}),(0,N.W)(null),(0,h.G)(()=>this.syncService.currentSourceId),(0,I.I)(t=>!!t),(0,h.G)(t=>(0,T.of)(t).pipe((0,j.G)({delay:1e4}))),(0,h.G)(t=>this.syncService.getLogs(t,this.since).pipe((0,x.a)(n=>(console.error("Error while fetching logs",n),(0,T.of)([]))))),(0,f.k)(t=>t.map((n,s)=>({index:s+this.currentIndex,date:n.createdAt,message:n.message,icon:"high"===n.level?"circle-cross":"medium"===n.level?"warning":"circle-check"}))),(0,V.a)(this.unsubscribeAll)).subscribe(t=>{this.since=t[0]?.date||this.since,this.currentIndex+=t.length,this.logs=t.concat(this.logs),this.cdr.markForCheck()})}ngOnDestroy(){this.unsubscribeAll.next(),this.unsubscribeAll.complete()}triggerSync(){this.syncing=!0,this.cdr.markForCheck(),this.syncService.triggerSyncs().subscribe({complete:()=>{this.syncing=!1,this.cdr.markForCheck()},error:()=>{this.toast.error("upload.activity.error"),this.syncing=!1,this.cdr.markForCheck()}})}static#e=this.\u0275fac=function(n){return new(n||i)(e.GI1(_.gH),e.GI1(e.kD9),e.GI1(C.E5),e.GI1(g.Q$))};static#t=this.\u0275cmp=e.In1({type:i,selectors:[["nsy-activity"]],decls:13,vars:9,consts:[["columns","48px 200px auto"],["header",""],["class","warning-container"],[3,"disabled","click"],[1,"warning-container"],["name","warning"],[1,"title-xxs"],[3,"name"],[3,"datetime"]],template:function(n,s){1&n&&(e.yuY(0,Z,11,16),e.wVc(1,"async"),e.I0R(2,"pa-table",0)(3,"pa-table-header"),e.wR5(4,"pa-table-cell",1),e.I0R(5,"pa-table-cell",1),e.OEk(6),e.wVc(7,"translate"),e.C$Y(),e.I0R(8,"pa-table-cell",1),e.OEk(9),e.wVc(10,"translate"),e.C$Y()(),e.c53(11,ee,7,3,"pa-table-row",null,z),e.C$Y()),2&n&&(e.C0Y(0,!1===e.kDX(1,3,s.disabled)?0:-1),e.yG2(6),e.cNF(e.kDX(7,5,"upload.activity.date")),e.yG2(3),e.cNF(e.kDX(10,7,"upload.activity.event")),e.yG2(2),e.oho(s.logs))},dependencies:[k.k,K.g,L.o,H.q,W.K,J.oB,q._,b.a,v.sD],styles:['@charset "UTF-8";.warning-container[_ngcontent-%COMP%]{display:flex;align-items:center;background:#ffdd1a;color:#000;margin-bottom:1rem;padding:1rem;gap:1rem}'],changeDetection:0})}return i})();var Y=a(1560);const ne=(i,o)=>o.id;function ie(i,o){if(1&i&&(e.I0R(0,"pa-input",5),e.wVc(1,"translate"),e.OEk(2),e.wVc(3,"translate"),e.C$Y()),2&i){const t=e.GaO().$implicit;e.E7m("help",t.help?e.kDX(1,4,t.help):void 0)("placeholder",t.placeholder)("formControlName",t.id),e.yG2(2),e.oRS(" ",e.kDX(3,6,t.label)," ")}}function se(i,o){if(1&i&&(e.I0R(0,"pa-textarea",6),e.wVc(1,"translate"),e.OEk(2),e.wVc(3,"translate"),e.C$Y()),2&i){const t=e.GaO().$implicit;e.E7m("help",t.help?e.kDX(1,3,t.help):void 0)("formControlName",t.id),e.yG2(2),e.oRS(" ",e.kDX(3,5,t.label)," ")}}function oe(i,o){if(1&i&&(e.I0R(0,"div",4),e.yuY(1,ie,4,8,"pa-input",5)(2,se,4,7,"pa-textarea",6),e.C$Y()),2&i){const t=o.$implicit;e.yG2(),e.C0Y(1,"text"===t.type?1:-1),e.yG2(),e.C0Y(2,"textarea"===t.type?2:-1)}}function ce(i,o){if(1&i){const t=e.KQA();e.I0R(0,"form",1),e.qCj("ngSubmit",function(){e.usT(t);const s=e.GaO();return e.CGJ(s.save())}),e.I0R(1,"pa-input",2),e.OEk(2),e.wVc(3,"translate"),e.C$Y(),e.c53(4,oe,3,2,"div",7,ne),e.I0R(6,"pa-button",3),e.OEk(7),e.wVc(8,"translate"),e.C$Y()()}if(2&i){const t=e.GaO();e.E7m("formGroup",t.form),e.yG2(2),e.oRS(" ",e.kDX(3,4,"upload.source.name")," "),e.yG2(2),e.oho(t.fields),e.yG2(2),e.E7m("disabled",!t.form.valid),e.yG2(),e.oRS(" ",e.kDX(8,6,"action.save")," ")}}let re=(()=>{class i{constructor(t,n,s,c){this.syncService=t,this.toast=n,this.formBuilder=s,this.cdr=c,this.done=new e._w7}ngOnInit(){this.syncService.getCurrentSync().pipe((0,I.I)(t=>!!t),(0,G.y)(t=>this.sync=t),(0,h.G)(t=>this.syncService.getConnector(t.connector.name,"").pipe((0,h.G)(n=>n.getParameters()),(0,f.k)(n=>({sync:t,fields:n}))))).subscribe(({sync:t,fields:n})=>this.showFields(t,n))}save(){this.sync&&this.syncService.updateSync(this.sync.id,{title:this.form?.value.title||"",connector:{...this.sync.connector,parameters:{...this.sync.connector.parameters,...this.form?.value.fields||{}}}}).subscribe({next:()=>{this.toast.success("upload.saved"),this.done.emit()},error:()=>{this.toast.error("upload.failed")}})}showFields(t,n){this.fields=n,this.form=this.formBuilder.group({title:["",l.AQ.required],fields:this.formBuilder.group(n.reduce((s,c)=>({...s,[c.id]:["",this.getFieldValidators(c)]}),{}))}),this.form.patchValue({fields:t.connector.parameters,title:t.title||t.id}),this.cdr.markForCheck()}getFieldValidators(t){const n=[];return t.required&&n.push(l.AQ.required),t.pattern&&n.push(l.AQ.pattern(t.pattern)),n}static#e=this.\u0275fac=function(n){return new(n||i)(e.GI1(_.gH),e.GI1(g.Q$),e.GI1(l.KE),e.GI1(e.kD9))};static#t=this.\u0275cmp=e.In1({type:i,selectors:[["nsy-edit-settings"]],outputs:{done:"done"},decls:1,vars:1,consts:[["qa","fields-form",3,"formGroup"],["qa","fields-form",3,"formGroup","ngSubmit"],["formControlName","title"],["qa","save-button","type","submit",3,"disabled"],["formGroupName","fields",1,"field"],[3,"help","placeholder","formControlName"],[3,"help","formControlName"],["formGroupName","fields","class","field"]],template:function(n,s){1&n&&e.yuY(0,ce,9,8,"form",0),2&n&&e.C0Y(0,s.fields&&s.form?0:-1)},dependencies:[l.sz,l.ue,l.u,l.uW,l.Wo,l.Kh,R.g,Y.a,k.k,v.sD],styles:['@charset "UTF-8";.field[_ngcontent-%COMP%]{margin:1rem 0}.field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:.5rem}pa-button[_ngcontent-%COMP%]{margin-top:1rem}'],changeDetection:0})}return i})();var ae=a(1112),le=a(7648),de=a(9336);a(1116);class pe{get selected(){return this._selected||(this._selected=Array.from(this._selection.values())),this._selected}constructor(o=!1,t,n=!0,s){this._multiple=o,this._emitChanges=n,this.compareWith=s,this._selection=new Set,this._deselectedToEmit=[],this._selectedToEmit=[],this.changed=new w.E,t&&t.length&&(o?t.forEach(c=>this._markSelected(c)):this._markSelected(t[0]),this._selectedToEmit.length=0)}select(...o){this._verifyValueAssignment(o),o.forEach(n=>this._markSelected(n));const t=this._hasQueuedChanges();return this._emitChangeEvent(),t}deselect(...o){this._verifyValueAssignment(o),o.forEach(n=>this._unmarkSelected(n));const t=this._hasQueuedChanges();return this._emitChangeEvent(),t}setSelection(...o){this._verifyValueAssignment(o);const t=this.selected,n=new Set(o);o.forEach(c=>this._markSelected(c)),t.filter(c=>!n.has(this._getConcreteValue(c,n))).forEach(c=>this._unmarkSelected(c));const s=this._hasQueuedChanges();return this._emitChangeEvent(),s}toggle(o){return this.isSelected(o)?this.deselect(o):this.select(o)}clear(o=!0){this._unmarkAll();const t=this._hasQueuedChanges();return o&&this._emitChangeEvent(),t}isSelected(o){return this._selection.has(this._getConcreteValue(o))}isEmpty(){return 0===this._selection.size}hasValue(){return!this.isEmpty()}sort(o){this._multiple&&this.selected&&this._selected.sort(o)}isMultipleSelection(){return this._multiple}_emitChangeEvent(){this._selected=null,(this._selectedToEmit.length||this._deselectedToEmit.length)&&(this.changed.next({source:this,added:this._selectedToEmit,removed:this._deselectedToEmit}),this._deselectedToEmit=[],this._selectedToEmit=[])}_markSelected(o){o=this._getConcreteValue(o),this.isSelected(o)||(this._multiple||this._unmarkAll(),this.isSelected(o)||this._selection.add(o),this._emitChanges&&this._selectedToEmit.push(o))}_unmarkSelected(o){o=this._getConcreteValue(o),this.isSelected(o)&&(this._selection.delete(o),this._emitChanges&&this._deselectedToEmit.push(o))}_unmarkAll(){this.isEmpty()||this._selection.forEach(o=>this._unmarkSelected(o))}_verifyValueAssignment(o){}_hasQueuedChanges(){return!(!this._deselectedToEmit.length&&!this._selectedToEmit.length)}_getConcreteValue(o,t){if(this.compareWith){t=t??this._selection;for(let n of t)if(this.compareWith(o,n))return n;return o}return o}}var $=a(3648),me=a(6920);const fe=(i,o)=>o.uuid;function ye(i,o){if(1&i){const t=e.KQA();e.I0R(0,"tr")(1,"td")(2,"pa-checkbox",3),e.qCj("valueChange",function(){const c=e.usT(t).$implicit,r=e.GaO();return e.CGJ(r.toggle(c))}),e.OEk(3),e.C$Y()()()}if(2&i){const t=o.$implicit,n=e.GaO();e.yG2(2),e.E7m("value",n.selection.isSelected(t)),e.yG2(),e.oRS(" ",t.title," ")}}function Ce(i,o){1&i&&e.wR5(0,"nsi-spinner")}let ge=(()=>{class i{constructor(t,n,s){this.syncService=t,this.toast=n,this.cdr=s,this.done=new e._w7,this.loading=!1,this.query="",this.selection=new pe(!0,[]),this.triggerSearch=new w.E,this.canSelectFiles=this.syncService.currentSourceId.pipe((0,f.k)(c=>this.syncService.canSelectFiles(c||""))),this.resources=this.triggerSearch.pipe((0,G.y)(()=>{this.loading=!0,this.cdr.markForCheck()}),(0,h.G)(()=>this.syncService.getFolders(this.query).pipe((0,x.a)(c=>(c&&this.toast.error("string"==typeof c?c:c.error?.message||c.error||c.message||"An error occurred"),(0,T.of)({items:[],nextPage:void 0})))).pipe((0,G.y)(()=>{this.loading=!1,this.cdr.markForCheck()}),(0,ae.K)((c,r)=>c.concat(r.items),[]))),(0,le.o)())}ngOnInit(){(0,de.y)([this.syncService.getCurrentSync().pipe((0,u.U)(1)),this.resources.pipe((0,u.U)(1))]).subscribe(([t,n])=>{t.foldersToSync?.forEach(s=>{const c=n.find(r=>r.uuid===s.uuid);c&&this.selection.select(c)}),this.cdr.detectChanges()})}ngAfterViewInit(){setTimeout(()=>{this.triggerSearch.next()},200)}save(){this.syncService.currentSourceId.pipe((0,u.U)(1),(0,h.G)(t=>this.syncService.updateSync(t||"",{foldersToSync:this.selection.selected},!0))).subscribe({next:()=>{this.toast.success("upload.saved"),this.done.emit()},error:()=>{this.toast.error("upload.failed")}})}toggle(t){this.selection.toggle(t),this.cdr.detectChanges()}static#e=this.\u0275fac=function(n){return new(n||i)(e.GI1(_.gH),e.GI1(g.Q$),e.GI1(e.kD9))};static#t=this.\u0275cmp=e.In1({type:i,selectors:[["nsy-edit-folders"]],outputs:{done:"done"},decls:10,vars:6,consts:[[1,"body"],[1,"actions"],["qa","save-button",3,"click"],[3,"value","valueChange"]],template:function(n,s){1&n&&(e.I0R(0,"div",0)(1,"table"),e.c53(2,ye,4,2,"tr",null,fe),e.wVc(4,"async"),e.C$Y()(),e.yuY(5,Ce,1,0,"nsi-spinner"),e.I0R(6,"div",1)(7,"pa-button",2),e.qCj("click",function(){return s.save()}),e.OEk(8),e.wVc(9,"translate"),e.C$Y()()),2&n&&(e.yG2(2),e.oho(e.kDX(4,2,s.resources)),e.yG2(3),e.C0Y(5,s.loading?5:-1),e.yG2(3),e.oRS(" ",e.kDX(9,4,"action.save")," "))},dependencies:[k.k,$.K,me.i,b.a,v.sD],styles:['@charset "UTF-8";.body[_ngcontent-%COMP%]{overflow-y:auto}table[_ngcontent-%COMP%]{border-spacing:0;margin-top:.5rem;width:calc(100% - 1rem)}td[_ngcontent-%COMP%]{align-items:center;border-bottom:1px solid hsl(0,0%,44%);display:flex;height:2rem;transition:color .16s ease-in-out}td[_ngcontent-%COMP%]   .disabled[_ngcontent-%COMP%]{color:#c4c4c4;padding-left:1.75rem}.parameters[_ngcontent-%COMP%], .actions[_ngcontent-%COMP%]{margin-top:2rem}'],changeDetection:0})}return i})();var Se=a(6936),_e=a(8532);function ve(i,o){if(1&i){const t=e.KQA();e.I0R(0,"label",0),e.OEk(1),e.wVc(2,"translate"),e.C$Y(),e.I0R(3,"div",1)(4,"nsi-labels-expander",2),e.qCj("updateSelection",function(s){e.usT(t);const c=e.GaO();return e.CGJ(c.updateLabelSelection(s))}),e.wVc(5,"async"),e.C$Y()(),e.I0R(6,"div",3)(7,"pa-button",4),e.qCj("click",function(){e.usT(t);const s=e.GaO();return e.CGJ(s.save())}),e.OEk(8),e.wVc(9,"translate"),e.C$Y()()}if(2&i){const t=e.GaO();e.yG2(),e.oRS(" ",e.kDX(2,4,"upload.labels")," "),e.yG2(3),e.E7m("labelSets",e.kDX(5,6,t.labelSets))("currentSelection",t.currentSelection),e.yG2(4),e.oRS(" ",e.kDX(9,8,"action.save")," ")}}function be(i,o){1&i&&(e.I0R(0,"div",5),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&i&&(e.yG2(),e.oRS(" ",e.kDX(2,1,"upload.no-labels")," "))}let ke=(()=>{class i{constructor(t,n,s,c){this.syncService=t,this.sdk=n,this.toast=s,this.cdr=c,this.done=new e._w7,this.labelSets=this.sdk.currentKb.pipe((0,u.U)(1),(0,h.G)(r=>r.getLabels()),(0,f.k)(r=>Object.entries(r).filter(([,d])=>0===d.kind.length||d.kind.includes(Se.MI.RESOURCES)).reduce((d,[m,p])=>({...d,[m]:p}),{}))),this.hasLabelSets=this.labelSets.pipe((0,f.k)(r=>Object.keys(r||{}).length>0)),this.currentSelection={},this.selectedLabels=[]}ngOnInit(){this.syncService.getCurrentSync().pipe((0,u.U)(1)).subscribe(t=>this.updateLabelSelection((t.labels||[]).reduce((n,s)=>({...n,[(0,g.gn)(s.labelset,s.label)]:!0}),{})))}save(){this.syncService.currentSourceId.pipe((0,u.U)(1),(0,h.G)(t=>this.syncService.updateSync(t||"",{labels:this.selectedLabels}))).subscribe({next:()=>{this.toast.success("upload.saved"),this.done.emit()},error:()=>{this.toast.error("upload.failed")}})}updateLabelSelection(t){this.currentSelection=t,this.selectedLabels=(0,g.OS)(t),this.cdr.detectChanges()}static#e=this.\u0275fac=function(n){return new(n||i)(e.GI1(_.gH),e.GI1(O.E3),e.GI1(g.Q$),e.GI1(e.kD9))};static#t=this.\u0275cmp=e.In1({type:i,selectors:[["nsy-edit-labels"]],outputs:{done:"done"},decls:3,vars:3,consts:[["for","label-expander",1,"body-m"],[1,"labels-container"],["id","label-expander",3,"labelSets","currentSelection","updateSelection"],[1,"actions"],["qa","save-button",3,"click"],[1,"body-m"]],template:function(n,s){1&n&&(e.yuY(0,ve,10,10),e.wVc(1,"async"),e.yuY(2,be,3,3)),2&n&&e.C0Y(0,e.kDX(1,1,s.hasLabelSets)?0:2)},dependencies:[k.k,_e.l,b.a,v.sD],styles:['@charset "UTF-8";.actions[_ngcontent-%COMP%]{margin-top:2rem}'],changeDetection:0})}return i})();var Ee=a(5116);let Ge=(()=>{class i{constructor(t,n,s){this.syncService=t,this.toast=n,this.cdr=s,this.done=new e._w7,this.filtersForm=new l.WC({fileExtensions:new l.Ku(""),exclude:new l.Ku(!1),fromDate:new l.Ku(""),toDate:new l.Ku("")})}ngOnInit(){this.syncService.getCurrentSync().pipe((0,u.U)(1)).subscribe(t=>{this.filtersForm.setValue({fileExtensions:t.filters?.fileExtensions?.extensions||"",exclude:t.filters?.fileExtensions?.exclude||!1,fromDate:t.filters?.modified?.from||"",toDate:t.filters?.modified?.to||""}),this.cdr.markForCheck()})}save(){const t={};this.filtersForm.value.fileExtensions&&(t.fileExtensions={extensions:this.filtersForm.value.fileExtensions,exclude:!!this.filtersForm.value.exclude}),(this.filtersForm.value.fromDate||this.filtersForm.value.toDate)&&(t.modified={from:this.filtersForm.value.fromDate||void 0,to:this.filtersForm.value.toDate||void 0}),this.syncService.currentSourceId.pipe((0,u.U)(1),(0,h.G)(n=>this.syncService.updateSync(n||"",{filters:t},!0))).subscribe({next:()=>{this.toast.success("upload.saved"),this.done.emit()},error:()=>{this.toast.error("upload.failed")}})}static#e=this.\u0275fac=function(n){return new(n||i)(e.GI1(_.gH),e.GI1(g.Q$),e.GI1(e.kD9))};static#t=this.\u0275cmp=e.In1({type:i,selectors:[["nsy-edit-filters"]],outputs:{done:"done"},decls:24,vars:19,consts:[[3,"formGroup","ngSubmit"],[1,"title-m"],[1,"field"],["formControlName","fileExtensions","help","upload.filters.extensions-help",3,"placeholder"],["help","upload.filters.exclude-help","formControlName","exclude"],["formControlName","fromDate","label","upload.filters.modified-from"],["formControlName","toDate","label","upload.filters.modified-to"],[1,"actions"],["qa","save-button",3,"click"]],template:function(n,s){1&n&&(e.I0R(0,"form",0),e.qCj("ngSubmit",function(){return s.save()}),e.I0R(1,"h3",1),e.OEk(2),e.wVc(3,"translate"),e.C$Y(),e.I0R(4,"div",2)(5,"pa-input",3),e.wVc(6,"translate"),e.OEk(7),e.wVc(8,"translate"),e.C$Y()(),e.I0R(9,"div",2)(10,"pa-checkbox",4),e.OEk(11),e.wVc(12,"translate"),e.C$Y()(),e.I0R(13,"div",2)(14,"h3",1),e.OEk(15),e.wVc(16,"translate"),e.C$Y(),e.wR5(17,"pa-date-picker",5),e.C$Y(),e.I0R(18,"div",2),e.wR5(19,"pa-date-picker",6),e.C$Y(),e.I0R(20,"div",7)(21,"pa-button",8),e.qCj("click",function(){return s.save()}),e.OEk(22),e.wVc(23,"translate"),e.C$Y()()()),2&n&&(e.E7m("formGroup",s.filtersForm),e.yG2(2),e.cNF(e.kDX(3,7,"upload.filters.extensions")),e.yG2(3),e.E7m("placeholder",e.kDX(6,9,"upload.filters.extensions-placeholder")),e.yG2(2),e.oRS(" ",e.kDX(8,11,"upload.filters.extensions")," "),e.yG2(4),e.oRS(" ",e.kDX(12,13,"upload.filters.exclude")," "),e.yG2(4),e.cNF(e.kDX(16,15,"upload.filters.modified")),e.yG2(7),e.oRS(" ",e.kDX(23,17,"action.save")," "))},dependencies:[l.sz,l.ue,l.u,l.uW,l.Wo,R.g,k.k,$.K,Ee.C,v.sD],styles:['@charset "UTF-8";h3[_ngcontent-%COMP%], .actions[_ngcontent-%COMP%]{margin-top:2rem}.field[_ngcontent-%COMP%]{margin:1rem 0}'],changeDetection:0})}return i})();function Ie(i,o){if(1&i){const t=e.KQA();e.I0R(0,"pa-tab",5),e.qCj("click",function(){e.usT(t);const s=e.GaO();return e.CGJ(s.selectedTab="folders")}),e.OEk(1),e.wVc(2,"translate"),e.C$Y()}if(2&i){const t=e.GaO();e.E7m("active","folders"===t.selectedTab),e.yG2(),e.oRS(" ",e.kDX(2,2,"upload.tabs.folders")," ")}}function Te(i,o){1&i&&(e.I0R(0,"section"),e.wR5(1,"nsy-activity"),e.C$Y())}function De(i,o){if(1&i){const t=e.KQA();e.I0R(0,"section")(1,"nsy-edit-folders",7),e.qCj("done",function(){e.usT(t);const s=e.GaO();return e.CGJ(s.done())}),e.C$Y()()}}function Oe(i,o){if(1&i){const t=e.KQA();e.I0R(0,"section")(1,"nsy-edit-filters",7),e.qCj("done",function(){e.usT(t);const s=e.GaO();return e.CGJ(s.done())}),e.C$Y()()}}function Re(i,o){if(1&i){const t=e.KQA();e.I0R(0,"section")(1,"nsy-edit-labels",7),e.qCj("done",function(){e.usT(t);const s=e.GaO();return e.CGJ(s.done())}),e.C$Y()()}}function we(i,o){if(1&i){const t=e.KQA();e.I0R(0,"section")(1,"nsy-edit-settings",7),e.qCj("done",function(){e.usT(t);const s=e.GaO();return e.CGJ(s.done())}),e.C$Y()()}}let Fe=(()=>{class i{constructor(t,n,s,c,r){this.syncService=t,this.router=n,this.toast=s,this.cdr=c,this.route=r,this.currentSync=this.syncService.getCurrentSync(),this.connector=this.currentSync.pipe((0,h.G)(d=>this.syncService.connectorsObs.pipe((0,f.k)(m=>m.find(p=>p.id===d.connector.name))))),this.canSelectFiles=this.syncService.getCurrentSync().pipe((0,f.k)(d=>this.syncService.canSelectFiles(d.id||""))),this.selectedTab="activity",this.enabled=this.currentSync.pipe((0,f.k)(d=>!d.disabled)),this.unsubscribeAll=new w.E}ngOnInit(){this.route.paramMap.subscribe(t=>{this.syncService.setCurrentSourceId(t.get("id")||"")}),this.router.events.pipe((0,I.I)(t=>t instanceof C.MT),(0,f.k)(t=>t.url.split("/upload/sync/")[1]?.split("/")[0]),(0,V.a)(this.unsubscribeAll)).subscribe(t=>{this.syncService.setCurrentSourceId(t),this.selectedTab="activity",this.cdr.markForCheck()}),this.currentSync.pipe((0,u.U)(1),(0,h.G)(t=>this.syncService.hasCurrentSourceAuth().pipe((0,I.I)(n=>!n),(0,h.G)(()=>this.syncService.getConnector(t.connector.name,t.id)),(0,h.G)(n=>this.syncService.authenticateToConnector(t.connector.name,n))))).subscribe({next:()=>{this.toast.success("upload.authentication.success"),this.router.navigate([],{queryParams:{}})},error:()=>this.toast.error("upload.authentication.failed")})}ngOnDestroy(){this.unsubscribeAll.next(),this.unsubscribeAll.complete()}delete(){this.syncService.currentSourceId.pipe((0,u.U)(1),(0,h.G)(t=>this.syncService.deleteSync(t||""))).subscribe({next:()=>{const t=this.router.url.split("/upload/")[0];this.router.navigate([`${t}/upload`])},error:()=>{this.toast.error("upload.deletion-failed")}})}done(){this.selectedTab="activity",this.cdr.markForCheck()}toggle(){this.currentSync.pipe((0,u.U)(1),(0,h.G)(t=>this.syncService.updateSync(t.id,{disabled:!t.disabled}))).subscribe({error:()=>{this.toast.error("upload.failed")}})}static#e=this.\u0275fac=function(n){return new(n||i)(e.GI1(_.gH),e.GI1(C.E5),e.GI1(g.Q$),e.GI1(e.kD9),e.GI1(C.gV))};static#t=this.\u0275cmp=e.In1({type:i,selectors:[["ng-component"]],decls:33,vars:39,consts:[[1,"header"],[3,"src","alt"],[1,"actions"],[3,"value","click"],["icon","trash","aspect","basic",3,"click"],[3,"active","click"],[3,"active"],[3,"done"]],template:function(n,s){if(1&n&&(e.I0R(0,"div",0)(1,"h2"),e.wR5(2,"img",1),e.wVc(3,"async"),e.wVc(4,"async"),e.OEk(5),e.wVc(6,"async"),e.C$Y(),e.I0R(7,"div",2)(8,"pa-toggle",3),e.qCj("click",function(){return s.toggle()}),e.wVc(9,"async"),e.OEk(10),e.wVc(11,"translate"),e.C$Y(),e.I0R(12,"pa-button",4),e.qCj("click",function(){return s.delete()}),e.C$Y()()(),e.I0R(13,"pa-tabs")(14,"pa-tab",5),e.qCj("click",function(){return s.selectedTab="activity"}),e.OEk(15),e.wVc(16,"translate"),e.C$Y(),e.yuY(17,Ie,3,4,"pa-tab",6),e.wVc(18,"async"),e.I0R(19,"pa-tab",5),e.qCj("click",function(){return s.selectedTab="filters"}),e.OEk(20),e.wVc(21,"translate"),e.C$Y(),e.I0R(22,"pa-tab",5),e.qCj("click",function(){return s.selectedTab="labels"}),e.OEk(23),e.wVc(24,"translate"),e.C$Y(),e.I0R(25,"pa-tab",5),e.qCj("click",function(){return s.selectedTab="settings"}),e.OEk(26),e.wVc(27,"translate"),e.C$Y()(),e.yuY(28,Te,2,0,"section")(29,De,2,0,"section")(30,Oe,2,0,"section")(31,Re,2,0,"section")(32,we,2,0,"section")),2&n){let c,r,d;e.yG2(2),e.E7m("src",null==(c=e.kDX(3,19,s.connector))?null:c.logo,e.K6U)("alt",(null==(r=e.kDX(4,21,s.connector))?null:r.title)+" logo"),e.yG2(3),e.oRS(" ",null==(d=e.kDX(6,23,s.currentSync))?null:d.title," "),e.yG2(3),e.E7m("value",e.kDX(9,25,s.enabled)),e.yG2(2),e.oRS(" ",e.kDX(11,27,"upload.active")," "),e.yG2(4),e.E7m("active","activity"===s.selectedTab),e.yG2(),e.oRS(" ",e.kDX(16,29,"upload.tabs.activity")," "),e.yG2(2),e.C0Y(17,e.kDX(18,31,s.canSelectFiles)?17:-1),e.yG2(2),e.E7m("active","filters"===s.selectedTab),e.yG2(),e.oRS(" ",e.kDX(21,33,"upload.tabs.filters")," "),e.yG2(2),e.E7m("active","labels"===s.selectedTab),e.yG2(),e.oRS(" ",e.kDX(24,35,"upload.tabs.labels")," "),e.yG2(2),e.E7m("active","settings"===s.selectedTab),e.yG2(),e.oRS(" ",e.kDX(27,37,"upload.tabs.settings")," "),e.yG2(2),e.C0Y(28,"activity"===s.selectedTab?28:-1),e.yG2(),e.C0Y(29,"folders"===s.selectedTab?29:-1),e.yG2(),e.C0Y(30,"filters"===s.selectedTab?30:-1),e.yG2(),e.C0Y(31,"labels"===s.selectedTab?31:-1),e.yG2(),e.C0Y(32,"settings"===s.selectedTab?32:-1)}},dependencies:[k.k,U.U,P.U,Q.Y,te,re,ge,ke,Ge,b.a,v.sD],styles:['@charset "UTF-8";.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:1rem}h2[_ngcontent-%COMP%]{display:flex}h2[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:2rem;margin-right:1rem}section[_ngcontent-%COMP%]{margin-top:2rem}.actions[_ngcontent-%COMP%]{align-items:center;display:flex;gap:1rem}'],changeDetection:0})}return i})();const Ve=(i,o)=>o.id;function xe(i,o){if(1&i&&(e.I0R(0,"pa-input",7),e.wVc(1,"translate"),e.OEk(2),e.wVc(3,"translate"),e.C$Y()),2&i){const t=e.GaO().$implicit;e.E7m("help",t.help?e.kDX(1,4,t.help):void 0)("placeholder",t.placeholder)("formControlName",t.id),e.yG2(2),e.oRS(" ",e.kDX(3,6,t.label)," ")}}function Ye(i,o){if(1&i&&(e.I0R(0,"pa-textarea",8),e.wVc(1,"translate"),e.OEk(2),e.wVc(3,"translate"),e.C$Y()),2&i){const t=e.GaO().$implicit;e.E7m("help",t.help?e.kDX(1,3,t.help):void 0)("formControlName",t.id),e.yG2(2),e.oRS(" ",e.kDX(3,5,t.label)," ")}}function $e(i,o){if(1&i&&(e.I0R(0,"div",6),e.yuY(1,xe,4,8,"pa-input",7)(2,Ye,4,7,"pa-textarea",8),e.C$Y()),2&i){const t=o.$implicit;e.yG2(),e.C0Y(1,"text"===t.type?1:-1),e.yG2(),e.C0Y(2,"textarea"===t.type?2:-1)}}function Ae(i,o){if(1&i){const t=e.KQA();e.I0R(0,"form",2),e.qCj("ngSubmit",function(){e.usT(t);const s=e.GaO();return e.CGJ(s.save())}),e.I0R(1,"div",3)(2,"pa-input",4),e.OEk(3),e.wVc(4,"translate"),e.C$Y()(),e.c53(5,$e,3,2,"div",9,Ve),e.I0R(7,"pa-button",5),e.OEk(8),e.wVc(9,"translate"),e.C$Y()()}if(2&i){const t=e.GaO();e.E7m("formGroup",t.form),e.yG2(3),e.oRS(" ",e.kDX(4,4,"upload.source.name")," "),e.yG2(2),e.oho(t.fields),e.yG2(2),e.E7m("disabled",!t.form.valid),e.yG2(),e.oRS(" ",e.kDX(9,6,"action.save")," ")}}const Me=new RegExp(/[^a-z0-9_-]/g),Xe=[{path:"",children:[{path:"setup/server",component:X},{path:"add/:connector",component:(()=>{class i{constructor(t,n,s,c,r,d,m){this.syncService=t,this.toast=n,this.formBuilder=s,this.cdr=c,this.router=r,this.route=d,this.sdk=m,this.connectorId=(this.sdk.nuclia.options.standalone?location.hash:location.pathname).split("/upload/sync/add/")[1]||"",this.connector=this.syncService.connectorsObs.pipe((0,f.k)(p=>p.find(S=>S.id===this.connectorId)))}ngOnInit(){this.syncService.getConnector(this.connectorId,"").pipe((0,u.U)(1),(0,h.G)(t=>t.getParameters())).subscribe(t=>this.showFields(t))}save(){const t=this.form?.value.title,n=this.form?.value.fields;let s=t?.toLowerCase().replace(Me,"-");this.sdk.currentKb.pipe((0,u.U)(1),(0,h.G)(c=>(s=`${c.id}-${s}`,this.syncService.addSync({id:s,connector:{name:this.connectorId||"",parameters:n},title:t}))),(0,G.y)(()=>this.syncService.setCurrentSourceId(s)),(0,h.G)(()=>this.syncService.getConnector(this.connectorId,s).pipe((0,u.U)(1))),(0,h.G)(c=>c.allowToSelectFolders?(0,T.of)(c):("function"==typeof c.handleParameters&&c.handleParameters(n),this.syncService.updateSync(s,{foldersToSync:c.getStaticFolders()}).pipe((0,h.G)(()=>this.syncService.getConnector(this.connectorId,s).pipe((0,u.U)(1)))))),(0,G.y)(c=>{if(c.hasServerSideAuth){let r=location.href.split("/upload/sync/add/")[0];this.sdk.nuclia.options.standalone&&(r=r.replace("#/","")),c.goToOAuth(`${r}/upload/sync/${s}`,!0)}else this.router.navigate([`../../${s}`],{relativeTo:this.route})})).subscribe({next:()=>{this.toast.success("upload.saved")},error:c=>{console.warn(c),this.toast.error("upload.failed")}})}showFields(t){this.fields=t,this.form=this.formBuilder.group({title:["",[l.AQ.required]],fields:this.formBuilder.group(t.reduce((n,s)=>({...n,[s.id]:["",this.getFieldValidators(s)]}),{}))}),this.cdr.markForCheck()}getFieldValidators(t){const n=[];return t.required&&n.push(l.AQ.required),t.pattern&&n.push(l.AQ.pattern(t.pattern)),n}static#e=this.\u0275fac=function(n){return new(n||i)(e.GI1(_.gH),e.GI1(g.Q$),e.GI1(l.KE),e.GI1(e.kD9),e.GI1(C.E5),e.GI1(C.gV),e.GI1(O.E3))};static#t=this.\u0275cmp=e.In1({type:i,selectors:[["ng-component"]],decls:7,vars:10,consts:[[3,"src","alt"],["qa","fields-form",3,"formGroup"],["qa","fields-form",3,"formGroup","ngSubmit"],[1,"field"],["formControlName","title"],["qa","save-button","type","submit",3,"disabled"],["formGroupName","fields",1,"field"],[3,"help","placeholder","formControlName"],[3,"help","formControlName"],["formGroupName","fields","class","field"]],template:function(n,s){if(1&n&&(e.I0R(0,"h2"),e.wR5(1,"img",0),e.wVc(2,"async"),e.wVc(3,"async"),e.OEk(4),e.wVc(5,"async"),e.C$Y(),e.yuY(6,Ae,10,8,"form",1)),2&n){let c,r,d;e.yG2(),e.E7m("src",null==(c=e.kDX(2,4,s.connector))?null:c.logo,e.K6U)("alt",(null==(r=e.kDX(3,6,s.connector))?null:r.title)+" logo"),e.yG2(3),e.oRS(" ",null==(d=e.kDX(5,8,s.connector))?null:d.title,"\n"),e.yG2(2),e.C0Y(6,s.fields&&s.form?6:-1)}},dependencies:[l.sz,l.ue,l.u,l.uW,l.Wo,l.Kh,R.g,Y.a,k.k,b.a,v.sD],styles:['@charset "UTF-8";h2[_ngcontent-%COMP%]{display:flex}h2[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:2rem;margin-right:1rem}.field[_ngcontent-%COMP%]{margin:1rem 0}.field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:.5rem}'],changeDetection:0})}return i})()},{path:":id",component:Fe}]}];let Ue=(()=>{class i{static#e=this.\u0275fac=function(n){return new(n||i)};static#t=this.\u0275mod=e.a4G({type:i});static#n=this.\u0275inj=e.s3X({imports:[C.qQ.forChild(Xe),C.qQ]})}return i})();var Pe=a(9132),y=a(6696);let Qe=(()=>{class i{static#e=this.\u0275fac=function(n){return new(n||i)};static#t=this.\u0275mod=e.a4G({type:i});static#n=this.\u0275inj=e.s3X({imports:[C.qQ,b.MD,v.O0,Pe.Y,l.y,l.sl,y.HV,y.qC,y.AL,y.Yh,y.aU,g.In,O.Cc,g.l2,y.Zj,y.sL,y.ek,y.I7]})}return i})(),Ne=(()=>{class i{static#e=this.\u0275fac=function(n){return new(n||i)};static#t=this.\u0275mod=e.a4G({type:i});static#n=this.\u0275inj=e.s3X({imports:[b.MD,v.O0,y.qC,y.HV,y.Yh,l.sl]})}return i})(),je=(()=>{class i{static#e=this.\u0275fac=function(n){return new(n||i)};static#t=this.\u0275mod=e.a4G({type:i});static#n=this.\u0275inj=e.s3X({imports:[b.MD,Ue,Qe,Ne]})}return i})()}}]);