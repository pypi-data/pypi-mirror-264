import{M as h,N as D,c as V,l as i,m as b,w as l,J as a,Q as c,a4 as j,$ as p,_ as f,O as _,S as m,V as C,r as v,v as E,o as A,a3 as k,K as I,q as R,P as U}from"./index-966f7f24.js";import{_ as Y,P as q}from"./PowerFlowCard-634571d6.js";import{C as $,h as S,p as B,f as T,B as M,j as N,L,k as W}from"./index-e716a86a.js";import{f as z}from"./utils-6f3c77d7.js";import{V as H,a as F,b as P}from"./VCard-f534a22a.js";import{V as J}from"./VToolbar-4fa32985.js";import{V as K}from"./VDivider-b2a222eb.js";import{a as O,V as y}from"./VTabs-03587c0f.js";import"./VImg-be0bd66e.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./VAvatar-0bab3ea1.js";import"./index-6b660d06.js";import"./VBtn-3f9939c9.js";import"./forwardRefs-efacd11c.js";import"./VProgressCircular-22d71813.js";import"./resizeObserver-b8ff4a76.js";import"./VSlideGroup-308a2eac.js";const Q={class:""},x={class:"mt-2 items-center rounded-md bg-subgroup p-2"},G={class:"text-left"},X={class:"float-right"},Z={key:0,class:"mt-2 items-center rounded-md bg-subgroup p-2"},ee=h({__name:"DeviceEnergyCard",props:{measurement:{},device:{},statistics:{},timeframe:{}},setup(g){const{t:s,d}=D(),n=g,r=V(()=>n.measurement.consumed_energy!=0?100*n.measurement.solar_consumed_energy/n.measurement.consumed_energy:0),o=V(()=>n.statistics?{labels:n.statistics.map(t=>d(new Date(t.measurement_date),{month:"numeric",day:"numeric"})),datasets:[{label:"Consumption",backgroundColor:"#2563eb",data:n.statistics.map(t=>{const u=t.device_measurements.find(w=>w.device_id==n.device.id);return u?u.consumed_energy:0})}]}:{labels:[],datasets:[]}),e={responsive:!0,maintainAspectRatio:!1,plugins:{datalabels:{display:!1}}};return $.register(S,B,T,M,N,L),(t,u)=>(i(),b(P,{class:"m-4 w-80 sm:w-96 p-4 rounded-md elevation-2"},{default:l(()=>[a(H,null,{default:l(()=>[c("span",{class:j(["mdi pr-2",t.device.icon])},null,2),c("span",Q,p(t.device.name),1)]),_:1}),a(F,null,{default:l(()=>[c("div",x,[c("div",G,[f(p(_(s)("consumption"))+" ",1),c("span",X,p(_(z)(t.measurement.consumed_energy,"kWh")),1)]),a(Y,{"self-sufficiency":r.value,"consumed-energy":t.measurement.consumed_energy,"consumed-solar-energy":t.measurement.solar_consumed_energy},null,8,["self-sufficiency","consumed-energy","consumed-solar-energy"])]),t.timeframe=="week"||t.timeframe=="month"?(i(),m("div",Z,[a(_(W),{data:o.value,options:e},null,8,["data"])])):C("",!0)]),_:1})]),_:1}))}}),ae=h({__name:"WeeklyStatistics",props:{data:{}},setup(g){const{d:s}=D(),d=V(()=>({labels:r.data.map(o=>s(new Date(o.measurement_date),{month:"numeric",day:"numeric"})),datasets:[{label:"Solar Production",backgroundColor:"#fbbf24",data:r.data.map(o=>o.solar_produced_energy)},{label:"Consumption",backgroundColor:"#2563eb",data:r.data.map(o=>o.consumed_energy)}]})),n={responsive:!0,maintainAspectRatio:!1,plugins:{datalabels:{display:!1}}};$.register(S,B,T,M,N,L);const r=g;return(o,e)=>(i(),b(_(W),{data:d.value,options:n},null,8,["data"]))}}),te=h({__name:"WeeklyStatisticsCard",props:{data:{}},setup(g){return(s,d)=>(i(),b(P,{class:"m-4 w-80 sm:w-96 p-4 rounded-md elevation-2"},{default:l(()=>[a(F,{class:"h-100 w-auto"},{default:l(()=>[a(ae,{data:s.data},null,8,["data"])]),_:1})]),_:1}))}}),se={class:"flex min-h-screen w-full justify-center"},ne={key:0,class:"grid w-full grid-cols-1 justify-items-center"},re=c("span",{class:"loading loading-dots loading-lg py-2"},null,-1),oe=[re],ie={key:1},le={key:0,class:"grid grid-cols-1 lg:grid-cols-2 p-4"},$e=h({__name:"Statistics",setup(g){const s=v(),d=v(),n=v(!1),r=v("today");E(r,()=>{const e=new Date;switch(r.value){case"week":e.setDate(e.getDate()-7);break;case"month":e.setMonth(e.getMonth()-1);break;case"year":e.setFullYear(e.getFullYear()-1);break}console.log("Load "+e.toString()),o(e)}),A(()=>{o(new Date)});const o=async function(e){n.value=!0,s.value=(await k.getHomeMeasurementDifference(e,new Date)).data,d.value=await k.getDailyMeasurements(e,new Date),n.value=!1};return(e,t)=>(i(),m("div",null,[a(J,{color:"transparent",title:_(U)("bp4")?e.$t("app.statistics"):""},{append:l(()=>[a(O,{modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=u=>r.value=u),"align-tabs":"end",height:"100%"},{default:l(()=>[a(y,{value:"today"},{default:l(()=>[f(p(e.$t("period.today")),1)]),_:1}),a(y,{value:"week"},{default:l(()=>[f(p(e.$t("period.week")),1)]),_:1}),a(y,{value:"month"},{default:l(()=>[f(p(e.$t("period.month")),1)]),_:1}),a(y,{value:"year"},{default:l(()=>[f(p(e.$t("period.year")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["title"]),a(K),c("div",se,[n.value?(i(),m("div",ne,oe)):(i(),m("div",ie,[s.value?(i(),m("div",le,[a(q,{"home-consumption-power":s.value.consumed_energy,"solar-power":s.value.solar_produced_energy,"grid-imported-energy":s.value.grid_imported_energy,"grid-exported-energy":s.value.grid_exported_energy,unit:"kWh"},null,8,["home-consumption-power","solar-power","grid-imported-energy","grid-exported-energy"]),r.value=="week"&&d.value!=null?(i(),b(te,{key:0,data:d.value},null,8,["data"])):C("",!0),(i(!0),m(I,null,R(s.value.device_measurements,(u,w)=>(i(),m("div",{key:w},[a(ee,{measurement:u,device:_(k).getDeviceInfo(u.device_id),statistics:d.value,timeframe:r.value},null,8,["measurement","device","statistics","timeframe"])]))),128))])):C("",!0)]))])]))}});export{$e as default};
